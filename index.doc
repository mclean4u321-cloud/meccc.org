<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MECCC Malaysia Ecological Civilization Communication Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
        }
        
        /* Emoji image styling */
        .emoji-image {
            display: inline-block !important;
            vertical-align: middle;
            margin: 0 2px;
            border-radius: 2px;
            transition: transform 0.2s ease;
        }
        
        .emoji-image:hover {
            transform: scale(1.1);
        }
        
        /* Large emoji images in cards and headers */
        .text-6xl .emoji-image,
        .text-5xl .emoji-image,
        .text-4xl .emoji-image {
            margin: 0 4px;
            border-radius: 4px;
        }
        
        /* Ensure emoji images don't break layout */
        .emoji-image + span {
            display: none;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            position: relative;
            overflow: hidden;
        }
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 226, 0.2) 0%, transparent 50%);
            pointer-events: none;
        }
        .hero-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }
        .hero-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"),
                radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(120, 219, 226, 0.3) 0%, transparent 50%);
            pointer-events: none;
        }
        .section-bg {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            position: relative;
            overflow: hidden;
        }
        .section-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M20 20c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10zm10 0c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10z'/%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
        }
        .card-hover {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -10px rgba(16, 185, 129, 0.3);
            background: rgba(255, 255, 255, 1);
        }
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .pulse-green {
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        }
        .modal-backdrop {
            backdrop-filter: blur(8px);
        }
        .sponsor-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid transparent;
            background-clip: padding-box;
            backdrop-filter: blur(10px);
        }
        .sponsor-card:hover {
            border-color: #10b981;
            transform: scale(1.02);
        }
        .logo-editor {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 10;
            min-width: 280px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }
        .logo-editor.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        .size-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        .size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }
        .size-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .nature-pattern {
            background-image: 
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2310b981' fill-opacity='0.1'%3E%3Cpath d='M30 30c0-11 9-20 20-20s20 9 20 20-9 20-20 20-20-9-20-20zm-20 0c0-11 9-20 20-20s20 9 20 20-9 20-20 20-20-9-20-20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        /* Text Edit Mode Styles */
        .text-edit-mode {
            position: relative;
        }
        
        .text-edit-mode .editable-text {
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            padding: 2px 4px;
            margin: -2px -4px;
        }
        
        .text-edit-mode .editable-text:hover {
            background-color: rgba(59, 130, 246, 0.1);
            border: 2px dashed #3b82f6;
        }
        
        .text-edit-mode .editable-text.selected {
            background-color: rgba(59, 130, 246, 0.2);
            border: 2px solid #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        
        .text-edit-mode .editable-text.editing {
            background-color: rgba(34, 197, 94, 0.1);
            border: 2px solid #22c55e;
        }
        
        .inline-editor {
            background: white !important;
            border: 2px solid #3b82f6 !important;
            border-radius: 6px !important;
            padding: 8px 12px !important;
            font-family: inherit;
            font-size: inherit;
            color: #1f2937 !important;
            font-weight: inherit;
            line-height: inherit;
            min-width: 120px !important;
            min-height: 32px !important;
            resize: none;
            outline: none !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2) !important;
            z-index: 9999 !important;
            position: relative !important;
            transition: all 0.2s ease !important;
        }
        
        .inline-editor:focus {
            border-color: #1d4ed8 !important;
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.3) !important;
        }
        

        
        .custom-text-element {
            position: relative;
            display: inline-block;
            margin: 4px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .custom-text-element:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .text-edit-mode .custom-text-element {
            border-color: #fbbf24;
        }
        
        .text-edit-mode .custom-text-element:hover {
            border-color: #f59e0b;
            background: rgba(251, 191, 36, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-full">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-2xl relative overflow-hidden">
        <!-- Header Background -->
        <div id="headerBg" class="absolute inset-0 bg-gradient-to-r from-green-600 to-blue-600"></div>
        
        <!-- Header Background Change Button (Admin Only) -->
        <button onclick="changeBannerBackground('header')" class="admin-only absolute top-4 right-4 z-20 bg-white bg-opacity-20 hover:bg-opacity-40 text-white rounded-full p-2 text-xs transition-all hidden">
            ğŸ–¼ï¸ æ›´æ¢HeaderèƒŒæ™¯
        </button>
        
        <div class="max-w-7xl mx-auto px-4 py-6 relative z-10">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <!-- MECCC Logo with Editor -->
                    <div class="relative" id="logoContainer">
                        <img id="mecccLogo" src="" alt="MECCC Logo" class="object-contain rounded-lg bg-white bg-opacity-20 p-2 hidden transition-all duration-300 cursor-pointer" onclick="toggleLogoEditor()" style="width: 64px; height: 64px;">
                        <div id="logoPlaceholder" class="h-16 w-16 bg-white bg-opacity-20 rounded-lg flex items-center justify-center cursor-pointer hover:bg-opacity-30 transition-all" onclick="triggerLogoUpload()">
                            <span class="text-2xl">ğŸ“·</span>
                        </div>
                        <input type="file" id="logoUpload" accept="image/*" class="hidden" onchange="handleLogoUpload(event)">
                        
                        <!-- Logo Editor Panel -->
                        <div id="logoEditor" class="logo-editor">
                            <h4 class="font-bold text-gray-800 mb-3">ğŸ¨ Logoç¼–è¾‘å™¨</h4>
                            
                            <!-- Size Control -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ å¤§å°è°ƒæ•´</label>
                                <input type="range" id="logoSizeSlider" class="size-slider" min="32" max="128" value="64" oninput="adjustLogoSize(this.value)">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>å°</span>
                                    <span id="sizeDisplay">64px</span>
                                    <span>å¤§</span>
                                </div>
                            </div>
                            
                            <!-- Shape Control -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ”² å½¢çŠ¶æ ·å¼</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <button onclick="setLogoShape('rounded-lg')" class="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 text-xs">åœ†è§’</button>
                                    <button onclick="setLogoShape('rounded-full')" class="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 text-xs">åœ†å½¢</button>
                                    <button onclick="setLogoShape('rounded-none')" class="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 text-xs">æ–¹å½¢</button>
                                </div>
                            </div>
                            
                            <!-- Background Control -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ¨ èƒŒæ™¯æ ·å¼</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="setLogoBg('bg-white bg-opacity-20')" class="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 text-xs">é€æ˜</button>
                                    <button onclick="setLogoBg('bg-white')" class="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 text-xs">ç™½è‰²</button>
                                    <button onclick="setLogoBg('bg-green-100')" class="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 text-xs">ç»¿è‰²</button>
                                    <button onclick="setLogoBg('bg-blue-100')" class="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 text-xs">è“è‰²</button>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="flex space-x-2">
                                <button onclick="triggerLogoUpload()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold">
                                    ğŸ“· æ›´æ¢
                                </button>
                                <button onclick="removeLogo()" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-semibold">
                                    ğŸ—‘ï¸ åˆ é™¤
                                </button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">MECCC Malaysia Ecological Civilization Communication Center</h1>
                        <p class="text-green-100 text-sm">Empowering Youth Through Environmental Action</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-sm text-green-100">ğŸŒ Global Ecological Communication</p>
                        <p class="text-xs text-green-200">Education is Action, Action is Culture</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="showMagazineModal()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg text-sm">
                            ğŸ“š E-Magazine
                        </button>
                        <button onclick="showSchoolLoginModal()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg text-sm">
                            ğŸ« School Portal
                        </button>
                        <button onclick="showAdminAccessModal()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg text-sm">
                            <span id="adminModeText">ğŸ”§ Admin Access</span>
                        </button>
                        <button onclick="toggleTextEditMode()" class="admin-only bg-yellow-500 bg-opacity-20 hover:bg-opacity-40 px-4 py-2 rounded-lg text-sm hidden">
                            <span id="textEditModeText">âœï¸ æ–‡å­—ç¼–è¾‘æ¨¡å¼</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-bg py-16 relative overflow-hidden">
        <!-- Hero Background -->
        <div id="heroBg" class="absolute inset-0 bg-gradient-to-br from-blue-500 to-purple-600"></div>
        
        <!-- Hero Background Change Button (Admin Only) -->
        <button onclick="changeBannerBackground('hero')" class="admin-only absolute top-4 right-4 z-20 bg-white bg-opacity-20 hover:bg-opacity-40 text-gray-800 rounded-full p-2 text-xs transition-all hidden">
            ğŸ–¼ï¸ æ›´æ¢HeroèƒŒæ™¯
        </button>
        
        <div class="max-w-7xl mx-auto px-4 text-center relative z-10">
            <h2 class="text-4xl font-bold text-gray-800 mb-4">
                ğŸŒ Education is Action, Action is Culture
            </h2>
            <p class="text-xl text-gray-600 mb-8">
                Join Malaysia's premier platform for youth environmental education and action
            </p>
            
            <!-- Main Action Buttons -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 max-w-7xl mx-auto">
                <!-- My Green Movement Button -->
                <div class="relative overflow-hidden rounded-xl shadow-lg transform hover:scale-105 transition-all">
                    <div id="greenMovementBg" class="absolute inset-0 bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 transition-all bg-cover bg-center"></div>
                    <button onclick="showEcoSubmissionModal()" class="relative z-10 w-full text-white p-6 text-center bg-black bg-opacity-20 hover:bg-opacity-10 transition-all">
                        <div class="text-5xl mb-3">ğŸ“</div>
                        <h4 class="text-xl font-bold mb-2">My Green Movement</h4>
                        <p class="text-green-100 text-sm">Share environmental insights</p>
                    </button>
                    <button onclick="changeButtonBackground('greenMovement')" class="admin-only absolute top-2 right-2 z-20 bg-white bg-opacity-20 hover:bg-opacity-40 text-white rounded-full p-2 text-xs transition-all hidden">
                        ğŸ–¼ï¸
                    </button>
                </div>
                
                <!-- E-Magazine Button -->
                <div class="relative overflow-hidden rounded-xl shadow-lg transform hover:scale-105 transition-all">
                    <div id="eMagazineBg" class="absolute inset-0 bg-gradient-to-br from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 transition-all bg-cover bg-center"></div>
                    <button onclick="showMagazineModal()" class="relative z-10 w-full text-white p-6 text-center bg-black bg-opacity-20 hover:bg-opacity-10 transition-all">
                        <div class="text-5xl mb-3">ğŸ“š</div>
                        <h4 class="text-xl font-bold mb-2">E-Magazine</h4>
                        <p class="text-orange-100 text-sm">Read & earn points</p>
                    </button>
                    <button onclick="changeButtonBackground('eMagazine')" class="admin-only absolute top-2 right-2 z-20 bg-white bg-opacity-20 hover:bg-opacity-40 text-white rounded-full p-2 text-xs transition-all hidden">
                        ğŸ–¼ï¸
                    </button>
                </div>
                
                <!-- Student Registration Button -->
                <div class="relative overflow-hidden rounded-xl shadow-lg transform hover:scale-105 transition-all">
                    <div id="studentRegBg" class="absolute inset-0 bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 transition-all bg-cover bg-center"></div>
                    <button onclick="showStudentRegistrationModal()" class="relative z-10 w-full text-white p-6 text-center bg-black bg-opacity-20 hover:bg-opacity-10 transition-all">
                        <div class="text-5xl mb-3">ğŸ“</div>
                        <h4 class="text-xl font-bold mb-2">Student Registration</h4>
                        <p class="text-blue-100 text-sm">Join as school student</p>
                    </button>
                    <button onclick="changeButtonBackground('studentReg')" class="admin-only absolute top-2 right-2 z-20 bg-white bg-opacity-20 hover:bg-opacity-40 text-white rounded-full p-2 text-xs transition-all hidden">
                        ğŸ–¼ï¸
                    </button>
                </div>
                
                <!-- Green Mover Button -->
                <div class="relative overflow-hidden rounded-xl shadow-lg transform hover:scale-105 transition-all">
                    <div id="greenMoverBg" class="absolute inset-0 bg-gradient-to-br from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 transition-all bg-cover bg-center"></div>
                    <button onclick="showGreenMoverModal()" class="relative z-10 w-full text-white p-6 text-center bg-black bg-opacity-20 hover:bg-opacity-10 transition-all">
                        <div class="text-5xl mb-3">ğŸŒŸ</div>
                        <h4 class="text-xl font-bold mb-2">Green Mover</h4>
                        <p class="text-purple-100 text-sm">Individual participation</p>
                    </button>
                    <button onclick="changeButtonBackground('greenMover')" class="admin-only absolute top-2 right-2 z-20 bg-white bg-opacity-20 hover:bg-opacity-40 text-white rounded-full p-2 text-xs transition-all hidden">
                        ğŸ–¼ï¸
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Core Features Section -->
    <section class="py-16 glass-effect nature-pattern relative overflow-hidden">
        <!-- Core Features Background -->
        <div id="coreFeaturesBg" class="absolute inset-0 bg-gradient-to-br from-green-100 to-blue-100"></div>
        
        <!-- Core Features Background Change Button (Admin Only) -->
        <button onclick="changeBannerBackground('coreFeatures')" class="admin-only absolute top-4 right-4 z-20 bg-white bg-opacity-60 hover:bg-opacity-80 text-gray-800 rounded-full p-2 text-xs transition-all hidden">
            ğŸ–¼ï¸ æ›´æ¢èƒŒæ™¯
        </button>
        
        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">
                ğŸ¯ Core Features
            </h2>
            <p class="text-center text-gray-600 mb-12">
                Simple and effective environmental education platform focusing on essential functions
            </p>
            
            <!-- Core Features Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 text-center">
                    <div class="text-5xl mb-3">ğŸ“</div>
                    <h3 class="text-xl font-bold text-green-800 mb-3">My Green Movement</h3>
                    <p class="text-gray-600 mb-4 text-sm">AI-guided environmental experiences with real-time mentoring</p>
                    <button onclick="showEcoSubmissionModal()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-semibold text-sm">
                        Start Submission
                    </button>
                </div>
                
                <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-6 text-center">
                    <div class="text-5xl mb-3">ğŸ“š</div>
                    <h3 class="text-xl font-bold text-orange-800 mb-3">E-Magazine Reading</h3>
                    <p class="text-gray-600 mb-4 text-sm">Read ecological magazines and earn points for reviews</p>
                    <button onclick="showMagazineModal()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-semibold text-sm">
                        Read & Review
                    </button>
                </div>
                
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                    <div class="text-5xl mb-3">ğŸ«</div>
                    <h3 class="text-xl font-bold text-blue-800 mb-3">School Competition</h3>
                    <p class="text-gray-600 mb-4 text-sm">Monthly rankings with PAJSK international scores</p>
                    <button onclick="showCompetitionModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold text-sm">
                        View Rankings
                    </button>
                </div>
                
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 text-center">
                    <div class="text-5xl mb-3">ğŸŒŸ</div>
                    <h3 class="text-xl font-bold text-purple-800 mb-3">Green Mover Program</h3>
                    <p class="text-gray-600 mb-4 text-sm">Individual environmental champions and advocates</p>
                    <button onclick="showGreenMoverModal()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-semibold text-sm">
                        Join Green Movers
                    </button>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="bg-gradient-to-r from-green-500 to-blue-600 rounded-xl text-white p-8 text-center">
                <h3 class="text-2xl font-bold mb-6">ğŸ“Š Platform Statistics</h3>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold">156</div>
                        <p class="text-xs">Students</p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold">23</div>
                        <p class="text-xs">Schools</p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold">42</div>
                        <p class="text-xs">Green Movers</p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold">89</div>
                        <p class="text-xs">Submissions</p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold">4.8</div>
                        <p class="text-xs">Avg Rating</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Competition Rankings Section -->
    <section class="py-16 section-bg relative overflow-hidden">
        <!-- Competition Rankings Background -->
        <div id="competitionBg" class="absolute inset-0 bg-gradient-to-br from-purple-200 to-pink-200"></div>
        
        <!-- Competition Rankings Background Change Button (Admin Only) -->
        <button onclick="changeBannerBackground('competition')" class="admin-only absolute top-4 right-4 z-20 bg-white bg-opacity-60 hover:bg-opacity-80 text-gray-800 rounded-full p-2 text-xs transition-all hidden">
            ğŸ–¼ï¸ æ›´æ¢èƒŒæ™¯
        </button>
        
        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">
                    ğŸ† Competition Rankings & Individual Honors
                </h2>
                <p class="text-gray-600 mb-6">
                    Monthly competitions for schools and individual Green Mover recognition
                </p>
                <div class="flex flex-wrap justify-center gap-4">
                    <button onclick="showCompetitionModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold">
                        School Rankings
                    </button>
                    <button onclick="showGreenMoverRankingsModal()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold">
                        Green Mover Honors
                    </button>
                </div>
            </div>
            
            <!-- Awards Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- School Awards -->
                <div>
                    <h3 class="text-2xl font-bold text-center text-gray-800 mb-6">ğŸ« School Competition Awards</h3>
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-xl p-4 border-2 border-yellow-300">
                            <div class="flex items-center space-x-3">
                                <div class="text-3xl">ğŸ¥‡</div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-yellow-800">Gold Award Schools</h4>
                                    <p class="text-sm text-gray-600">SMK Damansara Jaya (87.5 avg) â€¢ SJKC Chong Hwa (84.2 avg)</p>
                                    <p class="text-xs text-yellow-700 font-semibold">Prize: Cash Award + Equipment + ç”Ÿæ€æ–‡æ˜è®¤è¯å¥–çŠ¶ + PAJSKå›½é™…åˆ†æ•°</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-4 border-2 border-gray-300">
                            <div class="flex items-center space-x-3">
                                <div class="text-3xl">ğŸ¥ˆ</div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-800">Silver Award Schools</h4>
                                    <p class="text-sm text-gray-600">SMK Subang Jaya (76.8 avg) â€¢ SJKT Ladang Bukit Jalil (73.4 avg)</p>
                                    <p class="text-xs text-gray-700 font-semibold">Prize: Cash Award + Materials + ç”Ÿæ€æ–‡æ˜è®¤è¯å¥–çŠ¶ + PAJSKå›½é™…åˆ†æ•°</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-orange-50 to-orange-100 rounded-xl p-4 border-2 border-orange-300">
                            <div class="flex items-center space-x-3">
                                <div class="text-3xl">ğŸ¥‰</div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-orange-800">Bronze Award Schools</h4>
                                    <p class="text-sm text-gray-600">SMK Bandar Utama (68.9 avg) â€¢ SK Taman Desa (65.3 avg)</p>
                                    <p class="text-xs text-orange-700 font-semibold">Prize: Cash Award + Supplies + ç”Ÿæ€æ–‡æ˜è®¤è¯å¥–çŠ¶ + PAJSKå›½é™…åˆ†æ•°</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Green Mover Awards -->
                <div>
                    <h3 class="text-2xl font-bold text-center text-gray-800 mb-6">ğŸŒŸ Green Mover Individual Honors</h3>
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl p-4 border-2 border-purple-300">
                            <div class="flex items-center space-x-3">
                                <div class="text-3xl">ğŸ‘‘</div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-purple-800">Environmental Champion</h4>
                                    <p class="text-sm text-gray-600">Sarah Chen â€¢ 95.2 avg score â€¢ 28 submissions</p>
                                    <p class="text-xs text-purple-700 font-semibold">World Green Movement Award: Certificate + Medal + Media</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-50 to-green-100 rounded-xl p-4 border-2 border-green-300">
                            <div class="flex items-center space-x-3">
                                <div class="text-3xl">ğŸŒ±</div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-green-800">Eco Innovation Leader</h4>
                                    <p class="text-sm text-gray-600">Ahmad Rahman â€¢ 92.8 avg score â€¢ 22 submissions</p>
                                    <p class="text-xs text-green-700 font-semibold">World Green Movement Award: Certificate + Medal + Media</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 border-2 border-blue-300">
                            <div class="flex items-center space-x-3">
                                <div class="text-3xl">ğŸ’š</div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-blue-800">Community Impact Award</h4>
                                    <p class="text-sm text-gray-600">Priya Devi â€¢ 89.5 avg score â€¢ 19 submissions</p>
                                    <p class="text-xs text-blue-700 font-semibold">World Green Movement Award: Certificate + Medal + Media</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-6">
                            <button onclick="showGreenMoverRankingsModal()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-semibold text-sm">
                                View All Green Mover Rankings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Enterprise Partnership Section -->
    <section class="py-16 glass-effect relative overflow-hidden">
        <!-- Enterprise Partnership Background -->
        <div id="partnershipBg" class="absolute inset-0 bg-gradient-to-br from-gray-100 to-blue-100"></div>
        
        <!-- Enterprise Partnership Background Change Button (Admin Only) -->
        <button onclick="changeBannerBackground('partnership')" class="admin-only absolute top-4 right-4 z-20 bg-white bg-opacity-60 hover:bg-opacity-80 text-gray-800 rounded-full p-2 text-xs transition-all hidden">
            ğŸ–¼ï¸ æ›´æ¢èƒŒæ™¯
        </button>
        
        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">
                    ğŸ¤ Enterprise Partners
                </h2>
                <p class="text-gray-600">Supporting youth environmental education across Malaysia</p>
            </div>
            
            <!-- Current Sponsors -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12" id="sponsorsGrid">
                <!-- Sponsors will be loaded here -->
            </div>
            
            <!-- Partnership Benefits -->
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Become a Partner</h3>
                <p class="text-gray-600 mb-6">
                    Partner with us to support youth environmental education
                </p>
                <button onclick="showSponsorModal()" class="bg-gradient-to-r from-blue-500 to-green-500 hover:from-blue-600 hover:to-green-600 text-white py-3 px-8 rounded-lg font-semibold">
                    Learn More About Partnership
                </button>
            </div>
        </div>
    </section>

    <!-- Eco Submission Modal -->
    <div id="ecoSubmissionModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ“ My Green Movement</h3>
                    <button onclick="closeEcoSubmissionModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <form onsubmit="submitEcoArticle(event)" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="studentName" class="block text-sm font-medium text-gray-700 mb-2">Student Name</label>
                            <input type="text" id="studentName" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Enter your name">
                        </div>
                        <div>
                            <label for="schoolName" class="block text-sm font-medium text-gray-700 mb-2">School Name</label>
                            <input type="text" id="schoolName" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Enter your school name">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="grade" class="block text-sm font-medium text-gray-700 mb-2">Grade Level</label>
                            <select id="grade" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">Select Grade</option>
                                <option value="kindergarten">Kindergarten (å¹¼å„¿å›­)</option>
                                <option value="primary1">Primary 1 (å°å­¦ä¸€å¹´çº§)</option>
                                <option value="primary2">Primary 2 (å°å­¦äºŒå¹´çº§)</option>
                                <option value="primary3">Primary 3 (å°å­¦ä¸‰å¹´çº§)</option>
                                <option value="primary4">Primary 4 (å°å­¦å››å¹´çº§)</option>
                                <option value="primary5">Primary 5 (å°å­¦äº”å¹´çº§)</option>
                                <option value="primary6">Primary 6 (å°å­¦å…­å¹´çº§)</option>
                                <option value="secondary1">Secondary 1 (ä¸­å­¦ä¸€å¹´çº§)</option>
                                <option value="secondary2">Secondary 2 (ä¸­å­¦äºŒå¹´çº§)</option>
                                <option value="secondary3">Secondary 3 (ä¸­å­¦ä¸‰å¹´çº§)</option>
                                <option value="secondary4">Secondary 4 (ä¸­å­¦å››å¹´çº§)</option>
                                <option value="secondary5">Secondary 5 (ä¸­å­¦äº”å¹´çº§)</option>
                                <option value="form6">Form 6 (å¤§å­¦é¢„ç§‘)</option>
                                <option value="diploma">Diploma (æ–‡å‡­è¯¾ç¨‹)</option>
                                <option value="degree">Degree (å­¦å£«å­¦ä½)</option>
                                <option value="postgrad">Postgraduate (ç ”ç©¶ç”Ÿ)</option>
                            </select>
                        </div>
                        <div>
                            <label for="category" class="block text-sm font-medium text-gray-700 mb-2">Green Movement Category</label>
                            <select id="category" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">Select Category</option>
                                <option value="recycling">â™»ï¸ Waste Sorting & Recycling (åºŸç‰©åˆ†ç±»å›æ”¶)</option>
                                <option value="planting">ğŸŒ± Tree Planting & Gardening (æ¤æ ‘ç§æ¤)</option>
                                <option value="cleanup">ğŸ§¹ Environmental Cleanup (ç¯å¢ƒæ¸…æ´)</option>
                                <option value="conservation">ğŸ’¡ Energy/Water Conservation (èŠ‚èƒ½èŠ‚æ°´)</option>
                                <option value="transport">ğŸš² Green Transportation (ç»¿è‰²å‡ºè¡Œ)</option>
                                <option value="education">ğŸ“š Environmental Education (ç¯ä¿æ•™è‚²)</option>
                                <option value="innovation">ğŸ”¬ Eco Innovation Project (ç”Ÿæ€åˆ›æ–°)</option>
                                <option value="togetherness">ğŸ¤ Togetherness & Care (åˆä½œå…³æ€€)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-2">Experience Title</label>
                        <input type="text" id="title" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="e.g., My School Recycling Project Experience">
                    </div>
                    
                    <!-- Community Guidelines -->
                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
                        <h4 class="font-bold text-blue-800 mb-3">ğŸŒŸ Community Guidelines</h4>
                        <div class="space-y-2 text-sm text-blue-700">
                            <p><strong>âœ… æˆ‘ä»¬é¼“åŠ±çš„å†…å®¹ï¼š</strong></p>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li>çœŸå®çš„ç¯ä¿ä½“éªŒåˆ†äº«</li>
                                <li>ç§¯ææ­£é¢çš„ç¯ä¿è¡ŒåŠ¨</li>
                                <li>å›¢é˜Ÿåˆä½œå’Œäº’åŠ©ç²¾ç¥</li>
                                <li>ç¯ä¿çŸ¥è¯†å’ŒæŠ€èƒ½å­¦ä¹ </li>
                                <li>å¯¹ç¯å¢ƒä¿æŠ¤çš„æ€è€ƒå’Œæ„Ÿæ‚Ÿ</li>
                            </ul>
                            <div class="bg-blue-100 p-3 rounded-lg mt-3">
                                <p class="font-bold text-blue-800">ğŸ’¡ å†…å®¹å»ºè®®ï¼š</p>
                                <p class="text-blue-700">â€¢ åˆ†äº«æ‚¨çš„çœŸå®ä½“éªŒå’Œæ„Ÿå—</p>
                                <p class="text-blue-700">â€¢ ç”¨ç§¯ææ­£é¢çš„è¯­è¨€è¡¨è¾¾</p>
                                <p class="text-blue-700">â€¢ å±•ç°ç¯ä¿è¡ŒåŠ¨çš„ç§¯æå½±å“</p>
                            </div>
                            <p class="font-bold text-blue-800 mt-3">ğŸ¤– AIåŠ©æ‰‹ä¼šå¸®åŠ©æ‚¨æ”¹è¿›å†…å®¹è¡¨è¾¾</p>
                        </div>
                    </div>

                    <!-- Photo Upload Section -->
                    <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6">
                        <h4 class="font-bold text-green-800 mb-3">ğŸ“¸ è¡ŒåŠ¨è¯æ˜ç…§ç‰‡ (å¿…é¡»)</h4>
                        <p class="text-sm text-green-700 mb-4">ä¸Šä¼ æ˜¾ç¤ºæ‚¨çœŸå®å‚ä¸ç¯ä¿è¡ŒåŠ¨çš„ç…§ç‰‡ã€‚AIå°†éªŒè¯è¡ŒåŠ¨çœŸå®æ€§ã€åŸåˆ›æ€§å’Œå†…å®¹å®‰å…¨æ€§ã€‚</p>
                        
                        <div class="bg-blue-100 border border-blue-300 rounded-lg p-4 mb-4">
                            <h5 class="font-bold text-blue-800 mb-2">âœ… æœ‰æ•ˆè¡ŒåŠ¨è¯æ˜ç…§ç‰‡åº”åŒ…å«ï¼š</h5>
                            <ul class="text-sm text-blue-700 space-y-1">
                                <li>â€¢ <strong>äººå‘˜å‚ä¸ï¼š</strong>æ‚¨æœ¬äººæˆ–å›¢é˜Ÿæ­£åœ¨è¿›è¡Œç¯ä¿æ´»åŠ¨</li>
                                <li>â€¢ <strong>è¡ŒåŠ¨è¿‡ç¨‹ï¼š</strong>æ¸…æ™°æ˜¾ç¤ºç¯ä¿è¡ŒåŠ¨çš„å…·ä½“è¿‡ç¨‹</li>
                                <li>â€¢ <strong>ç›¸å…³å·¥å…·ï¼š</strong>ä½¿ç”¨çš„ç¯ä¿å·¥å…·ã€è®¾å¤‡æˆ–ææ–™</li>
                                <li>â€¢ <strong>ç±»åˆ«åŒ¹é…ï¼š</strong>ç…§ç‰‡å†…å®¹ä¸æ‰€é€‰ç¯ä¿ç±»åˆ«ç›¸ç¬¦</li>
                                <li>â€¢ <strong>åŸåˆ›æ‹æ‘„ï¼š</strong>æ‚¨äº²è‡ªæ‹æ‘„ï¼Œéç½‘ç»œä¸‹è½½å›¾ç‰‡</li>
                            </ul>
                        </div>
                        
                        <div class="bg-red-100 border border-red-300 rounded-lg p-4 mb-4">
                            <h5 class="font-bold text-red-800 mb-2">âŒ ä»¥ä¸‹ç…§ç‰‡å°†è¢«AIæ‹’ç»ï¼š</h5>
                            <ul class="text-sm text-red-700 space-y-1">
                                <li>â€¢ <strong>çº¯é£æ™¯ç…§ç‰‡ï¼š</strong>æ²¡æœ‰äººå‘˜å‚ä¸çš„è‡ªç„¶é£æ™¯</li>
                                <li>â€¢ <strong>æ— è¡ŒåŠ¨è¯æ®ï¼š</strong>é™æ€å±•ç¤ºï¼Œæ— å®é™…ç¯ä¿è¡ŒåŠ¨</li>
                                <li>â€¢ <strong>ç½‘ç»œå›¾ç‰‡ï¼š</strong>ä»äº’è”ç½‘ä¸‹è½½çš„å›¾ç‰‡</li>
                                <li>â€¢ <strong>ç±»åˆ«ä¸ç¬¦ï¼š</strong>ä¸æ‰€é€‰ç¯ä¿ç±»åˆ«æ— å…³çš„å†…å®¹</li>
                                <li>â€¢ <strong>æ— æ„ä¹‰ç…§ç‰‡ï¼š</strong>æ¨¡ç³Šã€æ— å…³æˆ–æ— æ³•è¯æ˜ç¯ä¿è¡ŒåŠ¨</li>
                            </ul>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="photoUpload" class="block text-sm font-medium text-gray-700 mb-2">Upload Photos (1-5 images)</label>
                                <input type="file" id="photoUpload" multiple accept="image/*" required class="w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500" onchange="handlePhotoUpload(event)">
                                <p class="text-xs text-gray-500 mt-1">Supported formats: JPG, PNG, HEIC. Max 5MB per image.</p>
                            </div>
                            
                            <div id="photoPreview" class="grid grid-cols-2 md:grid-cols-3 gap-4 hidden">
                                <!-- Photo previews will appear here -->
                            </div>
                            
                            <div id="aiPhotoStatus" class="hidden">
                                <div class="flex items-center space-x-2 text-sm">
                                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"></div>
                                    <span class="text-green-700">AI analyzing photos for authenticity and quality...</span>
                                </div>
                            </div>
                            
                            <div id="safetyCheckStatus" class="hidden">
                                <div class="bg-green-100 border border-green-300 rounded-lg p-3 mt-3">
                                    <div class="flex items-center space-x-2 text-sm">
                                        <span class="text-green-600">âœ…</span>
                                        <span class="text-green-700 font-semibold">Quality Check: PASSED</span>
                                    </div>
                                    <p class="text-xs text-green-600 mt-1">Photos verified as authentic environmental content.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label for="content" class="block text-sm font-medium text-gray-700 mb-2">Experience Description (ä½“éªŒæè¿°)</label>
                        <textarea id="content" rows="8" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ç®€å•æè¿°æ‚¨çš„ç¯ä¿ä½“éªŒï¼šä»€ä¹ˆæ—¶å€™åœ¨å“ªé‡Œï¼Ÿä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿå¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿæœ‰ä»€ä¹ˆæ„Ÿæƒ³ï¼ŸAIä¼šæä¾›æ ‡å‡†ç¤ºä¾‹å’Œè¡¨è¾¾æŒ‡å¯¼ã€‚" oninput="checkContentSafety(this.value)"></textarea>
                        <p class="text-xs text-gray-500 mt-1">ç”¨æ‚¨è‡ªå·±çš„è¯æè¿°å³å¯ã€‚AIä¼šåœ¨æäº¤åæä¾›æ ‡å‡†ç¤ºä¾‹å’Œè¡¨è¾¾å‡åæŒ‡å¯¼ã€‚</p>
                        
                        <div id="contentSafetyStatus" class="hidden mt-2">
                            <div class="bg-red-100 border border-red-300 rounded-lg p-3">
                                <div class="flex items-center space-x-2 text-sm">
                                    <span class="text-red-600">âš ï¸</span>
                                    <span class="text-red-700 font-semibold">Content Safety Warning</span>
                                </div>
                                <p class="text-xs text-red-600 mt-1" id="safetyWarningMessage">Inappropriate content detected. Please revise your text.</p>
                            </div>
                        </div>
                        
                        <div id="contentSafetyPassed" class="hidden mt-2">
                            <div class="bg-green-100 border border-green-300 rounded-lg p-3">
                                <div class="flex items-center space-x-2 text-sm">
                                    <span class="text-green-600">âœ…</span>
                                    <span class="text-green-700 font-semibold">Content Quality: APPROVED</span>
                                </div>
                                <p class="text-xs text-green-600 mt-1">Content is ready for submission.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Content Enhancement Section -->
                    <div id="aiEnhancementSection" class="hidden bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
                        <h4 class="font-bold text-blue-800 mb-3">ğŸ¤– AIè¯­æ³•ä¿®æ­£ä¸ä¼˜åŒ–</h4>
                        <div id="aiProcessing" class="flex items-center space-x-2 text-sm mb-4">
                            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
                            <span class="text-blue-700">AIæ­£åœ¨ä¿®æ­£è¯­æ³•å¹¶ä¼˜åŒ–è¡¨è¾¾...</span>
                        </div>
                        
                        <div id="enhancedContent" class="hidden">
                            <p class="text-sm text-blue-700 mb-3">AIå·²ä¿®æ­£è¯­æ³•å¹¶ä¼˜åŒ–äº†æ‚¨çš„è¡¨è¾¾ï¼Œè®©å†…å®¹æ›´åŠ æ¸…æ™°æµç•…ï¼š</p>
                            <div class="bg-white rounded-lg p-4 border border-blue-200 mb-4">
                                <div id="enhancedText" class="text-gray-800"></div>
                            </div>
                            <div class="flex space-x-3">
                                <button type="button" onclick="acceptEnhancement()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">
                                    âœ“ ä½¿ç”¨ä¿®æ­£ç‰ˆæœ¬ (æŒ‰Enteré”®)
                                </button>
                                <button type="button" onclick="rejectEnhancement()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">
                                    âœ— ä¿æŒåŸæ–‡
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 rounded-lg p-4">
                        <h4 class="font-bold text-green-800 mb-2">ğŸ” AI Review Process:</h4>
                        <ul class="text-sm text-green-700 space-y-1">
                            <li>â€¢ <strong>Content Safety Scan:</strong> Real-time monitoring for inappropriate content, bullying, or harmful material</li>
                            <li>â€¢ <strong>Photo Verification:</strong> AI checks image authenticity, originality, and content appropriateness</li>
                            <li>â€¢ <strong>Mental Health Protection:</strong> Filters emotional manipulation and content harmful to youth development</li>
                            <li>â€¢ <strong>Content Analysis:</strong> Originality check and plagiarism detection</li>
                            <li>â€¢ <strong>Enhancement Suggestions:</strong> AI improves clarity, structure, and impact (only after safety approval)</li>
                            <li>â€¢ <strong>Final Scoring:</strong> Comprehensive evaluation based on authenticity, impact, and presentation</li>
                        </ul>
                    </div>
                    
                    <div class="bg-red-50 rounded-lg p-4">
                        <h4 class="font-bold text-red-800 mb-2">ğŸ›¡ï¸ Youth Protection System:</h4>
                        <ul class="text-sm text-red-700 space-y-1">
                            <li>â€¢ <strong>24/7 AI Monitoring:</strong> Continuous content scanning for safety violations</li>
                            <li>â€¢ <strong>Blacklist System:</strong> Permanent ban for serious violations affecting youth safety</li>
                            <li>â€¢ <strong>Progressive Penalties:</strong> Warning â†’ Suspension â†’ Permanent Ban</li>
                            <li>â€¢ <strong>Community Reporting:</strong> Students and teachers can report inappropriate content</li>
                            <li>â€¢ <strong>Mental Health Focus:</strong> Special protection against cyberbullying and emotional harm</li>
                            <li>â€¢ <strong>Parent/Teacher Alerts:</strong> Automatic notifications for concerning behavior patterns</li>
                        </ul>
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="font-bold text-blue-800 mb-2">ğŸ“ AIæ•™è‚²å¼•å¯¼ç³»ç»Ÿï¼š</h4>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>â€¢ ğŸ“‹ æä¾›æ ‡å‡†ç­”æ¡ˆç¤ºä¾‹ï¼ˆæ—¶é—´åœ°ç‚¹ã€åŠ¨æœºã€ç»“æœã€æ„Ÿæ‚Ÿï¼‰</li>
                            <li>â€¢ ğŸ¯ ä¸ªäººè¡¨è¾¾å‡åæŒ‡å¯¼ï¼ˆè§‚å¯Ÿä½“éªŒæ·±åŒ–å»ºè®®ï¼‰</li>
                            <li>â€¢ âœ… é€šè¿‡/æ£€è®¨åˆ¤å®šï¼ˆæ— éœ€è¯„åˆ†ï¼Œä¸“æ³¨å­¦ä¹ æˆé•¿ï¼‰</li>
                            <li>â€¢ ğŸ« å­¦æ ¡å¤šæ ·æ€§ç»Ÿè®¡ï¼ˆ8å¤§ç»¿è‰²è¡ŒåŠ¨ç¯ç¯ç›¸æ‰£ï¼‰</li>
                        </ul>
                    </div>
                    
                    <div class="bg-purple-50 rounded-lg p-4">
                        <h4 class="font-bold text-purple-800 mb-2">ğŸ† å­¦æ ¡è·å¥–æ–°æ ‡å‡†ï¼š</h4>
                        <ul class="text-sm text-purple-700 space-y-1">
                            <li>â€¢ <strong>å‚ä¸å¤šæ ·æ€§ï¼š</strong>å­¦æ ¡éœ€è¦åœ¨8å¤§ç»¿è‰²è¡ŒåŠ¨ä¸­å±•ç°å¤šæ ·æ€§</li>
                            <li>â€¢ <strong>ç¯ç¯ç›¸æ‰£ï¼š</strong>ä¸èƒ½åªä¸“æ³¨å•ä¸€è¡ŒåŠ¨ï¼ˆå¦‚åªç§æ ‘æˆ–åªåˆ†ç±»ï¼‰</li>
                            <li>â€¢ <strong>åˆä½œå…³æ€€ï¼š</strong>ç‰¹åˆ«é‡è§†å›¢é˜Ÿåˆä½œå’Œäº’ç›¸å…³æ€€çš„ç¯ä¿è¡ŒåŠ¨</li>
                            <li>â€¢ <strong>æ•™è‚²æˆé•¿ï¼š</strong>é‡è§†å­¦ç”Ÿçš„è§‚å¯Ÿä½“éªŒèƒ½åŠ›å’Œè¡¨è¾¾å‡å</li>
                            <li>â€¢ <strong>æŒç»­å‚ä¸ï¼š</strong>é¼“åŠ±é•¿æœŸæŒç»­çš„ç¯ä¿è¡ŒåŠ¨å‚ä¸</li>
                        </ul>
                    </div>
                    
                    <button type="submit" id="submitButton" disabled class="w-full bg-gray-400 text-white py-3 px-6 rounded-lg font-semibold cursor-not-allowed">
                        Upload Photos First
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Student Registration Modal -->
    <div id="studentRegistrationModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ“ Student Registration</h3>
                    <button onclick="closeStudentRegistrationModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <div class="text-center mb-6">
                    <div class="text-4xl mb-3">ğŸŒ±</div>
                    <p class="text-gray-600">Join Malaysia's ecological civilization action platform</p>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Participation Type</label>
                        <div class="flex justify-center space-x-4">
                            <label class="flex items-center space-x-2">
                                <input type="radio" name="participationType" value="school" checked onchange="toggleSchoolField()" class="text-blue-600 focus:ring-blue-500">
                                <span class="text-sm">ğŸ« School Student</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="radio" name="participationType" value="individual" onchange="toggleSchoolField()" class="text-blue-600 focus:ring-blue-500">
                                <span class="text-sm">ğŸ‘¤ Individual Student</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <form onsubmit="submitStudentRegistration(event)" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="regStudentName" class="block text-sm font-medium text-gray-700 mb-2">Student Name</label>
                            <input type="text" id="regStudentName" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Enter your full name">
                        </div>
                        <div id="schoolNameField">
                            <label for="regSchoolName" class="block text-sm font-medium text-gray-700 mb-2">School Name</label>
                            <input type="text" id="regSchoolName" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Enter your complete school name">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="regGrade" class="block text-sm font-medium text-gray-700 mb-2">Grade Level</label>
                            <select id="regGrade" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">Select Grade</option>
                                <option value="kindergarten">Kindergarten (å¹¼å„¿å›­)</option>
                                <option value="primary1">Primary 1 (å°å­¦ä¸€å¹´çº§)</option>
                                <option value="primary2">Primary 2 (å°å­¦äºŒå¹´çº§)</option>
                                <option value="primary3">Primary 3 (å°å­¦ä¸‰å¹´çº§)</option>
                                <option value="primary4">Primary 4 (å°å­¦å››å¹´çº§)</option>
                                <option value="primary5">Primary 5 (å°å­¦äº”å¹´çº§)</option>
                                <option value="primary6">Primary 6 (å°å­¦å…­å¹´çº§)</option>
                                <option value="secondary1">Secondary 1 (ä¸­å­¦ä¸€å¹´çº§)</option>
                                <option value="secondary2">Secondary 2 (ä¸­å­¦äºŒå¹´çº§)</option>
                                <option value="secondary3">Secondary 3 (ä¸­å­¦ä¸‰å¹´çº§)</option>
                                <option value="secondary4">Secondary 4 (ä¸­å­¦å››å¹´çº§)</option>
                                <option value="secondary5">Secondary 5 (ä¸­å­¦äº”å¹´çº§)</option>
                                <option value="form6">Form 6 (å¤§å­¦é¢„ç§‘)</option>
                                <option value="diploma">Diploma (æ–‡å‡­è¯¾ç¨‹)</option>
                                <option value="degree">Degree (å­¦å£«å­¦ä½)</option>
                                <option value="postgrad">Postgraduate (ç ”ç©¶ç”Ÿ)</option>
                            </select>
                        </div>
                        <div>
                            <label for="regEmail" class="block text-sm font-medium text-gray-700 mb-2">Email (Optional)</label>
                            <input type="email" id="regEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="For platform notifications">
                        </div>
                    </div>
                    
                    <div>
                        <label for="interests" class="block text-sm font-medium text-gray-700 mb-2">Environmental Interests</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                                <span class="text-sm">Waste Management</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                                <span class="text-sm">Energy Conservation</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                                <span class="text-sm">Water Conservation</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                                <span class="text-sm">Green Transportation</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                                <span class="text-sm">Tree Planting</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                                <span class="text-sm">Environmental Education</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 rounded-lg p-4">
                        <h4 class="font-bold text-green-800 mb-2">Platform Benefits:</h4>
                        <ul class="text-sm text-green-700 space-y-1">
                            <li>â€¢ AI-scored environmental submissions</li>
                            <li>â€¢ Growth points for university applications</li>
                            <li>â€¢ Peer feedback and collaboration</li>
                            <li id="schoolBenefit">â€¢ School competition participation (school students)</li>
                            <li id="individualBenefit" class="hidden">â€¢ Individual achievement tracking (individual students)</li>
                            <li>â€¢ Environmental education resources</li>
                            <li>â€¢ Certificate of participation</li>
                            <li>â€¢ <strong>Flexible transfer:</strong> Switch from individual to school participation anytime</li>
                        </ul>
                    </div>
                    
                    <div class="bg-yellow-50 rounded-lg p-4">
                        <h4 class="font-bold text-yellow-800 mb-2">ğŸ”„ School Transfer System:</h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>â€¢ <strong>Seamless Transfer:</strong> Individual students can join school competitions when their school registers</li>
                            <li>â€¢ <strong>Historical Preservation:</strong> All previous submissions and scores are permanently kept</li>
                            <li>â€¢ <strong>Retroactive Counting:</strong> Past individual scores automatically contribute to school rankings</li>
                            <li>â€¢ <strong>Dual Recognition:</strong> Students maintain both individual achievements and school contributions</li>
                            <li>â€¢ <strong>Annual Summary:</strong> Year-end awards consider full participation history</li>
                        </ul>
                    </div>
                    
                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-semibold">
                        Register Now
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- School Registration Modal -->
    <div id="schoolRegistrationModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-3xl w-full p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ« School Registration</h3>
                    <button onclick="closeSchoolRegistrationModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <form onsubmit="submitSchoolRegistration(event)" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="fullSchoolName" class="block text-sm font-medium text-gray-700 mb-2">Full School Name</label>
                            <input type="text" id="fullSchoolName" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="e.g., SMK Damansara Jaya">
                        </div>
                        <div>
                            <label for="schoolType" class="block text-sm font-medium text-gray-700 mb-2">School Type</label>
                            <select id="schoolType" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">Select Type</option>
                                <option value="kindergarten">Kindergarten (å¹¼å„¿å›­)</option>
                                <option value="sk">National Primary School (SK)</option>
                                <option value="sjkc">Chinese Primary School (SJKC)</option>
                                <option value="sjkt">Tamil Primary School (SJKT)</option>
                                <option value="smk">National Secondary School (SMK)</option>
                                <option value="smjk">Chinese Independent Secondary School (SMJK)</option>
                                <option value="private_primary">Private Primary School</option>
                                <option value="private_secondary">Private Secondary School</option>
                                <option value="international">International School</option>
                                <option value="college">College (å­¦é™¢)</option>
                                <option value="university_public">Public University (å…¬ç«‹å¤§å­¦)</option>
                                <option value="university_private">Private University (ç§ç«‹å¤§å­¦)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="state" class="block text-sm font-medium text-gray-700 mb-2">State</label>
                            <select id="state" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">Select State</option>
                                <option value="selangor">Selangor</option>
                                <option value="kl">Kuala Lumpur</option>
                                <option value="johor">Johor</option>
                                <option value="penang">Penang</option>
                                <option value="perak">Perak</option>
                                <option value="sabah">Sabah</option>
                                <option value="sarawak">Sarawak</option>
                                <option value="other">Other States</option>
                            </select>
                        </div>
                        <div>
                            <label for="studentCount" class="block text-sm font-medium text-gray-700 mb-2">Student Population</label>
                            <select id="studentCount" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">Select Size</option>
                                <option value="small">Small (Less than 500)</option>
                                <option value="medium">Medium (500-1000)</option>
                                <option value="large">Large (1000-2000)</option>
                                <option value="xlarge">Extra Large (2000+)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="contactPerson" class="block text-sm font-medium text-gray-700 mb-2">Contact Person</label>
                            <input type="text" id="contactPerson" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Teacher or administrator name">
                        </div>
                        <div>
                            <label for="position" class="block text-sm font-medium text-gray-700 mb-2">Position</label>
                            <input type="text" id="position" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="e.g., Environmental Club Advisor">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="contactEmail" class="block text-sm font-medium text-gray-700 mb-2">Contact Email</label>
                            <input type="email" id="contactEmail" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="contactPhone" class="block text-sm font-medium text-gray-700 mb-2">Contact Phone</label>
                            <input type="tel" id="contactPhone" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    
                    <div>
                        <label for="applicationReason" class="block text-sm font-medium text-gray-700 mb-2">Application Reason</label>
                        <textarea id="applicationReason" rows="4" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Please explain why you want to register your school and how you plan to use this platform..."></textarea>
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="font-bold text-blue-800 mb-2">School Administrator Access Includes:</h4>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>â€¢ Generate school-specific participation links</li>
                            <li>â€¢ View student participation statistics</li>
                            <li>â€¢ Manage school environmental activities</li>
                            <li>â€¢ Download school competition reports</li>
                            <li>â€¢ Set school environmental goals</li>
                        </ul>
                    </div>
                    
                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-semibold">
                        Submit Application
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- School Login Modal -->
    <div id="schoolLoginModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ« School Administrator Login</h3>
                    <button onclick="closeSchoolLoginModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <div class="text-center mb-6">
                    <div class="text-4xl mb-3">ğŸ“</div>
                    <p class="text-gray-600">School administrator management portal</p>
                </div>
                
                <form onsubmit="handleSchoolLogin(event)" class="space-y-4">
                    <div>
                        <label for="schoolCode" class="block text-sm font-medium text-gray-700 mb-2">School Code</label>
                        <input type="text" id="schoolCode" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="e.g., SMK001">
                    </div>
                    <div>
                        <label for="adminPassword" class="block text-sm font-medium text-gray-700 mb-2">Administrator Password</label>
                        <input type="password" id="adminPassword" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-semibold">
                        Login to Management Portal
                    </button>
                </form>
                
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h4 class="font-bold text-gray-800 mb-3">Don't have a school account?</h4>
                    <button onclick="showSchoolRegistrationFromLogin()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-sm">
                        Apply for School Account
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Competition Modal -->
    <div id="competitionModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-6xl w-full p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ† School Competition Details</h3>
                    <button onclick="closeCompetitionModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <!-- Competition Rules -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Competition Rules & Historical Records</h4>
                    <div class="bg-blue-50 rounded-lg p-6">
                        <ul class="space-y-2 text-gray-700">
                            <li>â€¢ Students must include school name when submitting</li>
                            <li>â€¢ AI system automatically scores submissions (0-100 points)</li>
                            <li>â€¢ School rankings calculated by average score of all student submissions</li>
                            <li>â€¢ Gold Award: 80-100 points, Silver Award: 70-79 points, Bronze Award: 60-69 points</li>
                            <li>â€¢ Monthly evaluation with cash prizes and awards</li>
                            <li>â€¢ All schools participate equally regardless of size</li>
                        </ul>
                    </div>
                    
                    <div class="bg-green-50 rounded-lg p-6 mt-4">
                        <h5 class="font-bold text-green-800 mb-3">ğŸ”„ Individual-to-School Transfer System</h5>
                        <ul class="space-y-2 text-gray-700">
                            <li>â€¢ <strong>Automatic Transfer:</strong> When schools register, their individual students are automatically identified and transferred</li>
                            <li>â€¢ <strong>Historical Integration:</strong> All previous individual submissions immediately count toward school rankings</li>
                            <li>â€¢ <strong>Retroactive Scoring:</strong> Past scores contribute to school's average from the moment of school registration</li>
                            <li>â€¢ <strong>Permanent Records:</strong> Individual achievement history is never deleted, always accessible</li>
                            <li>â€¢ <strong>Annual Awards:</strong> Year-end recognition includes full participation history (individual + school periods)</li>
                            <li>â€¢ <strong>Dual Recognition:</strong> Students receive both individual achievement certificates and school competition awards</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Detailed Rankings Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">School Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Students</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Average Score</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Award</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prize</th>
                            </tr>
                        </thead>
                        <tbody id="rankingsTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Rankings will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Sponsor Modal -->
    <div id="sponsorModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ¢ Enterprise Sponsorship</h3>
                    <button onclick="closeSponsorModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Sponsorship Benefits -->
                    <div>
                        <h4 class="text-xl font-bold text-gray-800 mb-4">Sponsorship Benefits</h4>
                        <div class="space-y-4">
                            <div class="flex items-start space-x-3">
                                <span class="text-2xl">ğŸ¯</span>
                                <div>
                                    <h5 class="font-bold text-gray-700">Brand Exposure</h5>
                                    <p class="text-sm text-gray-600">Logo display on platform homepage and all activity materials</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <span class="text-2xl">ğŸ“Š</span>
                                <div>
                                    <h5 class="font-bold text-gray-700">Data Reports</h5>
                                    <p class="text-sm text-gray-600">Detailed user engagement and environmental impact data</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <span class="text-2xl">ğŸ¤</span>
                                <div>
                                    <h5 class="font-bold text-gray-700">CSR Collaboration</h5>
                                    <p class="text-sm text-gray-600">Corporate social responsibility project opportunities</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <span class="text-2xl">ğŸŒŸ</span>
                                <div>
                                    <h5 class="font-bold text-gray-700">Media Publicity</h5>
                                    <p class="text-sm text-gray-600">Recognition in award ceremonies and media coverage</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sponsorship Form -->
                    <div>
                        <h4 class="text-xl font-bold text-gray-800 mb-4">Sponsorship Application</h4>
                        <form onsubmit="submitSponsorApplication(event)" class="space-y-4">
                            <div>
                                <label for="companyName" class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
                                <input type="text" id="companyName" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="contactPersonSponsor" class="block text-sm font-medium text-gray-700 mb-2">Contact Person</label>
                                <input type="text" id="contactPersonSponsor" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="emailSponsor" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" id="emailSponsor" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="phoneSponsor" class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                                <input type="tel" id="phoneSponsor" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="sponsorshipLevel" class="block text-sm font-medium text-gray-700 mb-2">Sponsorship Level</label>
                                <select id="sponsorshipLevel" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Please Select</option>
                                    <option value="platinum">Platinum Sponsor</option>
                                    <option value="gold">Gold Sponsor</option>
                                    <option value="silver">Silver Sponsor</option>
                                    <option value="bronze">Bronze Sponsor</option>
                                </select>
                            </div>
                            <div>
                                <label for="cooperationIntention" class="block text-sm font-medium text-gray-700 mb-2">Cooperation Intention</label>
                                <textarea id="cooperationIntention" rows="4" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Please describe your cooperation intentions and expectations..."></textarea>
                            </div>
                            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold">
                                Submit Application
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Green Mover Registration Modal -->
    <div id="greenMoverModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-3xl w-full p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸŒŸ Green Mover Registration</h3>
                    <button onclick="closeGreenMoverModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <div class="text-center mb-6">
                    <div class="text-4xl mb-3">ğŸŒŸ</div>
                    <p class="text-gray-600">For individuals who have left university - join the prestigious World Green Movement Award program!</p>
                </div>
                
                <form onsubmit="submitGreenMoverRegistration(event)" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="greenMoverName" class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="greenMoverName" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Enter your full name">
                        </div>
                        <div>
                            <label for="greenMoverAge" class="block text-sm font-medium text-gray-700 mb-2">Age</label>
                            <select id="greenMoverAge" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">Select Age Range</option>
                                <option value="18-25">18-25 years old (å·²ç¦»å¼€å­¦æ ¡)</option>
                                <option value="26-35">26-35 years old</option>
                                <option value="36-50">36-50 years old</option>
                                <option value="50+">50+ years old</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="greenMoverLocation" class="block text-sm font-medium text-gray-700 mb-2">Location (State)</label>
                            <select id="greenMoverLocation" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">Select State</option>
                                <option value="selangor">Selangor</option>
                                <option value="kl">Kuala Lumpur</option>
                                <option value="johor">Johor</option>
                                <option value="penang">Penang</option>
                                <option value="perak">Perak</option>
                                <option value="sabah">Sabah</option>
                                <option value="sarawak">Sarawak</option>
                                <option value="other">Other States</option>
                            </select>
                        </div>
                        <div>
                            <label for="greenMoverEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="greenMoverEmail" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="For platform notifications">
                        </div>
                    </div>
                    
                    <div>
                        <label for="greenMoverBackground" class="block text-sm font-medium text-gray-700 mb-2">Background/Profession</label>
                        <select id="greenMoverBackground" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="">Select Background</option>
                            <option value="working">Working Professional (åœ¨èŒäººå‘˜)</option>
                            <option value="educator">Educator/Teacher (æ•™è‚²å·¥ä½œè€…)</option>
                            <option value="activist">Environmental Activist (ç¯ä¿æ´»åŠ¨å®¶)</option>
                            <option value="entrepreneur">Entrepreneur (ä¼ä¸šå®¶)</option>
                            <option value="freelancer">Freelancer (è‡ªç”±èŒä¸šè€…)</option>
                            <option value="retiree">Retiree (é€€ä¼‘äººå‘˜)</option>
                            <option value="homemaker">Homemaker (å®¶åº­ä¸»å¦‡/å¤«)</option>
                            <option value="other">Other (å…¶ä»–)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="greenMoverExperience" class="block text-sm font-medium text-gray-700 mb-2">Environmental Experience</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                                <span class="text-sm">Waste Management</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                                <span class="text-sm">Energy Conservation</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                                <span class="text-sm">Water Conservation</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                                <span class="text-sm">Sustainable Living</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                                <span class="text-sm">Community Organizing</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                                <span class="text-sm">Environmental Education</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label for="greenMoverMotivation" class="block text-sm font-medium text-gray-700 mb-2">Why do you want to be a Green Mover?</label>
                        <textarea id="greenMoverMotivation" rows="4" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Share your motivation for joining as an individual environmental champion..."></textarea>
                    </div>
                    
                    <div class="bg-purple-50 rounded-lg p-4">
                        <h4 class="font-bold text-purple-800 mb-2">Green Mover Benefits:</h4>
                        <ul class="text-sm text-purple-700 space-y-1">
                            <li>â€¢ <strong>World Green Movement Award</strong> - Annual prestigious recognition</li>
                            <li>â€¢ Official certificate and commemorative medal</li>
                            <li>â€¢ National and international media exposure</li>
                            <li>â€¢ Personal environmental impact tracking</li>
                            <li>â€¢ Direct mentorship opportunities</li>
                            <li>â€¢ Community leadership roles</li>
                            <li>â€¢ Professional networking opportunities</li>
                        </ul>
                    </div>
                    
                    <button type="submit" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold">
                        Join as Green Mover
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Green Mover Rankings Modal -->
    <div id="greenMoverRankingsModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-6xl w-full p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸŒŸ Green Mover Individual Rankings</h3>
                    <button onclick="closeGreenMoverRankingsModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <!-- Green Mover Categories -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Recognition Categories</h4>
                    <div class="bg-purple-50 rounded-lg p-6">
                        <ul class="space-y-2 text-gray-700">
                            <li>â€¢ <strong>Environmental Champion:</strong> Highest overall score (90+ average)</li>
                            <li>â€¢ <strong>Eco Innovation Leader:</strong> Most creative and innovative submissions</li>
                            <li>â€¢ <strong>Community Impact Award:</strong> Greatest community engagement and influence</li>
                            <li>â€¢ <strong>Consistency Award:</strong> Regular participation and sustained quality</li>
                            <li>â€¢ <strong>Youth Leader:</strong> Outstanding performance by participants under 25</li>
                            <li>â€¢ <strong>Mentor Award:</strong> Exceptional guidance and support to other participants</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Detailed Rankings Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Submissions</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Average Score</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Award</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">World Green Movement Award</th>
                            </tr>
                        </thead>
                        <tbody id="greenMoverRankingsTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Rankings will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- E-Magazine Modal -->
    <div id="magazineModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-6xl w-full p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ“š ç”Ÿæ€æ–‡æ˜ç”µå­æ‚å¿—</h3>
                    <button onclick="closeMagazineModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <!-- Magazine Upload Section (Admin Only) -->
                <div id="adminMagazineUpload" class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-8 hidden">
                    <h4 class="text-xl font-bold text-blue-800 mb-4">ğŸ“¤ ç®¡ç†å‘˜ä¸Šä¼ ç”µå­æ‚å¿—</h4>
                    <form onsubmit="uploadMagazine(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="magazineTitle" class="block text-sm font-medium text-gray-700 mb-2">æ‚å¿—æ ‡é¢˜</label>
                                <input type="text" id="magazineTitle" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ä¾‹å¦‚ï¼šç”Ÿæ€æ–‡æ˜å­¦æ ¡ç¬¬1æœŸ">
                            </div>
                            <div>
                                <label for="magazineIssue" class="block text-sm font-medium text-gray-700 mb-2">æœŸæ•°</label>
                                <input type="text" id="magazineIssue" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ä¾‹å¦‚ï¼šç¬¬1æœŸ">
                            </div>
                        </div>
                        <div>
                            <label for="magazineUrl" class="block text-sm font-medium text-gray-700 mb-2">Visual Paradigm ç”µå­æ‚å¿—é“¾æ¥</label>
                            <input type="url" id="magazineUrl" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="https://online.visual-paradigm.com/share/book/...">
                        </div>
                        <div>
                            <label for="magazineDescription" class="block text-sm font-medium text-gray-700 mb-2">æ‚å¿—ç®€ä»‹</label>
                            <textarea id="magazineDescription" rows="3" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ç®€è¦æè¿°æ‚å¿—å†…å®¹..."></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="readingPoints" class="block text-sm font-medium text-gray-700 mb-2">é˜…è¯»ç§¯åˆ†</label>
                                <input type="number" id="readingPoints" min="1" max="50" value="10" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="reviewPoints" class="block text-sm font-medium text-gray-700 mb-2">è¯»åæ„Ÿç§¯åˆ†</label>
                                <input type="number" id="reviewPoints" min="1" max="100" value="25" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold">
                            ğŸ“¤ ä¸Šä¼ ç”µå­æ‚å¿—
                        </button>
                    </form>
                </div>
                
                <!-- Available Magazines -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-xl font-bold text-gray-800">ğŸ“– å¯é˜…è¯»æ‚å¿—</h4>
                        <button onclick="toggleAdminUpload()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm">
                            ğŸ”§ ç®¡ç†å‘˜æ¨¡å¼
                        </button>
                    </div>
                    
                    <div id="magazinesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Magazines will be loaded here -->
                    </div>
                </div>
                
                <!-- Comprehensive Ecological Civilization School Certification System -->
                <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl p-8 border-2 border-green-200">
                    <h4 class="text-2xl font-bold text-green-800 mb-6 text-center">ğŸ† ç”Ÿæ€æ–‡æ˜å­¦æ ¡è®¤è¯ç§¯åˆ†ç³»ç»Ÿ</h4>
                    
                    <!-- Official Certification Formula -->
                    <div class="bg-white rounded-lg p-6 mb-6 border-2 border-blue-300">
                        <h5 class="text-xl font-bold text-blue-800 mb-4 text-center">ğŸ“ å®˜æ–¹è®¤è¯è®¡ç®—å…¬å¼</h5>
                        <div class="bg-blue-50 p-4 rounded-lg text-center mb-4">
                            <p class="text-lg font-bold text-blue-900">å­¦æ ¡ç”Ÿæ€æ–‡æ˜æŒ‡æ•° = (A + B + C) Ã— D Ã— E</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="bg-green-50 p-3 rounded-lg">
                                <p class="font-bold text-green-800">A = ç»¿è‰²è¡ŒåŠ¨ç§¯åˆ†</p>
                                <p class="text-green-700">â€¢ å­¦ç”Ÿç¯ä¿ä½“éªŒæäº¤ï¼š20-105åˆ†/ç¯‡</p>
                                <p class="text-green-700">â€¢ ç…§ç‰‡çœŸå®æ€§éªŒè¯ï¼š+5åˆ†å¥–åŠ±</p>
                                <p class="text-green-700">â€¢ AIå†…å®¹è´¨é‡è¯„ä¼°ï¼šå½±å“æœ€ç»ˆå¾—åˆ†</p>
                            </div>
                            <div class="bg-orange-50 p-3 rounded-lg">
                                <p class="font-bold text-orange-800">B = é˜…è¯»å­¦ä¹ ç§¯åˆ†</p>
                                <p class="text-orange-700">â€¢ æ‚å¿—é˜…è¯»éªŒè¯ï¼š15-25åˆ†/æœŸ</p>
                                <p class="text-orange-700">â€¢ è¯»åæ„Ÿæäº¤ï¼š25-55åˆ†/ç¯‡</p>
                                <p class="text-orange-700">â€¢ æ·±åº¦é˜…è¯»å¥–åŠ±ï¼š+5åˆ†</p>
                            </div>
                            <div class="bg-purple-50 p-3 rounded-lg">
                                <p class="font-bold text-purple-800">C = æŒç»­å‚ä¸ç§¯åˆ†</p>
                                <p class="text-purple-700">â€¢ æœˆåº¦æ´»è·ƒå¥–åŠ±ï¼š20åˆ†/æœˆ</p>
                                <p class="text-purple-700">â€¢ è¿ç»­å‚ä¸å¥–åŠ±ï¼šç´¯è¿›åˆ¶</p>
                                <p class="text-purple-700">â€¢ åŒä¼´äº’åŠ©å¥–åŠ±ï¼š10åˆ†/æ¬¡</p>
                            </div>
                            <div class="bg-yellow-50 p-3 rounded-lg">
                                <p class="font-bold text-yellow-800">D = å‚ä¸ç‡ç³»æ•°</p>
                                <p class="text-yellow-700">â€¢ å­¦ç”Ÿå‚ä¸ç‡ â‰¥ 80%ï¼š1.2å€</p>
                                <p class="text-yellow-700">â€¢ å­¦ç”Ÿå‚ä¸ç‡ 60-79%ï¼š1.1å€</p>
                                <p class="text-yellow-700">â€¢ å­¦ç”Ÿå‚ä¸ç‡ 40-59%ï¼š1.0å€</p>
                                <p class="text-yellow-700">â€¢ å­¦ç”Ÿå‚ä¸ç‡ < 40%ï¼š0.8å€</p>
                            </div>
                        </div>
                        <div class="bg-red-50 p-3 rounded-lg mt-4">
                            <p class="font-bold text-red-800">E = è´¨é‡ä¿è¯ç³»æ•°</p>
                            <p class="text-red-700">â€¢ æ— è¿è§„è®°å½•ï¼š1.0å€ | è½»å¾®è¿è§„ï¼š0.9å€ | ä¸¥é‡è¿è§„ï¼š0.7å€</p>
                        </div>
                    </div>
                    
                    <!-- Certification Levels -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-yellow-100 to-yellow-200 p-4 rounded-lg border-2 border-yellow-400">
                            <div class="text-center">
                                <div class="text-4xl mb-2">ğŸ¥‡</div>
                                <h6 class="font-bold text-yellow-800">é‡‘ç‰Œç”Ÿæ€æ–‡æ˜å­¦æ ¡</h6>
                                <p class="text-sm text-yellow-700 mt-2">â‰¥ 8000åˆ†</p>
                                <p class="text-xs text-yellow-600">ç°é‡‘å¥–åŠ± + è®¾å¤‡ + å›½é™…è®¤è¯</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-gray-100 to-gray-200 p-4 rounded-lg border-2 border-gray-400">
                            <div class="text-center">
                                <div class="text-4xl mb-2">ğŸ¥ˆ</div>
                                <h6 class="font-bold text-gray-800">é“¶ç‰Œç”Ÿæ€æ–‡æ˜å­¦æ ¡</h6>
                                <p class="text-sm text-gray-700 mt-2">6000-7999åˆ†</p>
                                <p class="text-xs text-gray-600">ç°é‡‘å¥–åŠ± + æ•™æ + å›½é™…è®¤è¯</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-100 to-orange-200 p-4 rounded-lg border-2 border-orange-400">
                            <div class="text-center">
                                <div class="text-4xl mb-2">ğŸ¥‰</div>
                                <h6 class="font-bold text-orange-800">é“œç‰Œç”Ÿæ€æ–‡æ˜å­¦æ ¡</h6>
                                <p class="text-sm text-orange-700 mt-2">4000-5999åˆ†</p>
                                <p class="text-xs text-orange-600">ç°é‡‘å¥–åŠ± + ç”¨å“ + å›½é™…è®¤è¯</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fair Competition Principles -->
                    <div class="bg-white rounded-lg p-6 border-2 border-green-300">
                        <h5 class="font-bold text-green-800 mb-3 text-center">âš–ï¸ å…¬å¹³ç«äº‰åŸåˆ™</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <h6 class="font-bold text-green-700 mb-2">ğŸ¯ è§„æ¨¡å…¬å¹³æ€§ï¼š</h6>
                                <ul class="text-green-600 space-y-1">
                                    <li>â€¢ å¤§å­¦æ ¡ï¼ˆ>1000äººï¼‰ï¼šéœ€è¦æ›´é«˜æ€»åˆ†</li>
                                    <li>â€¢ ä¸­å­¦æ ¡ï¼ˆ500-1000äººï¼‰ï¼šæ ‡å‡†è®¡ç®—</li>
                                    <li>â€¢ å°å­¦æ ¡ï¼ˆ<500äººï¼‰ï¼šå‚ä¸ç‡åŠ æƒ</li>
                                    <li>â€¢ ç‰¹æ®Šå­¦æ ¡ï¼šä¸ªåˆ«è¯„ä¼°æ ‡å‡†</li>
                                </ul>
                            </div>
                            <div>
                                <h6 class="font-bold text-green-700 mb-2">ğŸ“Š è´¨é‡ä¿è¯ï¼š</h6>
                                <ul class="text-green-600 space-y-1">
                                    <li>â€¢ AIå¤šé‡éªŒè¯é˜²æ­¢ä½œå¼Š</li>
                                    <li>â€¢ ç…§ç‰‡åŸåˆ›æ€§æ£€æµ‹</li>
                                    <li>â€¢ å†…å®¹æŠ„è¢­ç›‘æµ‹</li>
                                    <li>â€¢ å¼‚å¸¸è¡Œä¸ºè‡ªåŠ¨æ ‡è®°</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Monthly Progress Tracking -->
                    <div class="bg-blue-50 rounded-lg p-4 mt-4">
                        <h5 class="font-bold text-blue-800 mb-2 text-center">ğŸ“ˆ æœˆåº¦è¿›åº¦è¿½è¸ª</h5>
                        <div class="text-sm text-blue-700 text-center">
                            <p>â€¢ æ¯æœˆ15æ—¥å‘å¸ƒå­¦æ ¡æ’åæ›´æ–°</p>
                            <p>â€¢ å®æ—¶ç§¯åˆ†è®¡ç®—å’Œé€æ˜åº¦æŠ¥å‘Š</p>
                            <p>â€¢ å¹´ç»ˆç»¼åˆè¯„ä¼°å’Œå›½é™…è®¤è¯ç”³è¯·</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Magazine Reading Modal -->
    <div id="magazineReadingModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-5xl w-full p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800" id="readingMagazineTitle">ğŸ“š é˜…è¯»æ‚å¿—</h3>
                    <button onclick="closeMagazineReadingModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <!-- Magazine Viewer -->
                <div class="mb-6">
                    <div class="bg-gray-100 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold text-gray-800">ğŸ“– æ‚å¿—é˜…è¯»å™¨</h4>
                            <div class="flex space-x-2">
                                <button onclick="toggleFullscreen()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">
                                    ğŸ” å…¨å±é˜…è¯»
                                </button>
                                <button onclick="openMagazineInNewTab()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">
                                    ğŸ”— æ–°çª—å£æ‰“å¼€
                                </button>
                            </div>
                        </div>
                        
                        <!-- Enhanced Magazine Display -->
                        <div id="magazineContainer" class="relative bg-white rounded-lg shadow-lg overflow-hidden">
                            <!-- Loading State -->
                            <div id="magazineLoading" class="flex items-center justify-center h-96 bg-gray-50">
                                <div class="text-center">
                                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                    <p class="text-gray-600">æ­£åœ¨åŠ è½½ç”µå­æ‚å¿—...</p>
                                </div>
                            </div>
                            
                            <!-- Magazine Iframe -->
                            <iframe 
                                id="magazineViewer" 
                                src="" 
                                class="w-full h-96 border-0 hidden" 
                                frameborder="0"
                                sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
                                onload="handleMagazineLoad()"
                                onerror="handleMagazineError()">
                            </iframe>
                            
                            <!-- Error State -->
                            <div id="magazineError" class="hidden p-8 text-center bg-yellow-50">
                                <div class="text-4xl mb-4">âš ï¸</div>
                                <h4 class="font-bold text-yellow-800 mb-2">æ‚å¿—åŠ è½½é‡åˆ°é—®é¢˜</h4>
                                <p class="text-yellow-700 mb-4">æŸäº›ç”µå­æ‚å¿—å¯èƒ½éœ€è¦åœ¨æ–°çª—å£ä¸­æ‰“å¼€ä»¥è·å¾—æœ€ä½³é˜…è¯»ä½“éªŒ</p>
                                <button onclick="openMagazineInNewTab()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg font-semibold">
                                    ğŸ”— åœ¨æ–°çª—å£ä¸­æ‰“å¼€æ‚å¿—
                                </button>
                            </div>
                            
                            <!-- Alternative Display -->
                            <div id="magazineAlternative" class="hidden p-6 bg-blue-50">
                                <div class="text-center mb-4">
                                    <div class="text-5xl mb-3" id="altMagazineCover">ğŸ“š</div>
                                    <h4 class="font-bold text-blue-800 mb-2" id="altMagazineTitle">æ‚å¿—æ ‡é¢˜</h4>
                                    <p class="text-blue-700 mb-4" id="altMagazineDesc">æ‚å¿—æè¿°</p>
                                </div>
                                
                                <div class="bg-white rounded-lg p-4 mb-4">
                                    <h5 class="font-bold text-gray-800 mb-2">ğŸ“‹ æ‚å¿—å†…å®¹é¢„è§ˆ</h5>
                                    <ul class="text-sm text-gray-700 space-y-1" id="magazineContents">
                                        <li>â€¢ ç”Ÿæ€æ–‡æ˜æ•™è‚²ç†å¿µä¸å®è·µ</li>
                                        <li>â€¢ å­¦æ ¡ç¯ä¿é¡¹ç›®æ¡ˆä¾‹åˆ†æ</li>
                                        <li>â€¢ é’å°‘å¹´ç¯ä¿è¡ŒåŠ¨æŒ‡å—</li>
                                        <li>â€¢ å¯æŒç»­å‘å±•ç›®æ ‡è§£è¯»</li>
                                        <li>â€¢ ç¯ä¿åˆ›æ–°æŠ€æœ¯ä»‹ç»</li>
                                    </ul>
                                </div>
                                
                                <div class="text-center">
                                    <button onclick="openMagazineInNewTab()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold text-lg">
                                        ğŸ“– å¼€å§‹å®Œæ•´é˜…è¯»
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Reading Progress -->
                        <div class="mt-4 bg-white rounded-lg p-3">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">é˜…è¯»è¿›åº¦</span>
                                <span class="text-blue-600 font-semibold" id="readingProgress">å‡†å¤‡å¼€å§‹</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reading Confirmation -->
                <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6 mb-6">
                    <h4 class="font-bold text-green-800 mb-3">ğŸ“– é˜…è¯»ç¡®è®¤</h4>
                    <p class="text-sm text-green-700 mb-4">è¯·ç¡®è®¤æ‚¨å·²å®Œæ•´é˜…è¯»æ­¤æ‚å¿—ï¼Œç„¶åç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å¾—é˜…è¯»ç§¯åˆ†ã€‚</p>
                    <button onclick="confirmReading()" id="confirmReadingBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold">
                        âœ… ç¡®è®¤å·²å®Œæ•´é˜…è¯» (+<span id="readingPointsDisplay">10</span>ç§¯åˆ†)
                    </button>
                </div>
                
                <!-- Review Submission -->
                <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
                    <h4 class="font-bold text-blue-800 mb-3">âœï¸ æäº¤è¯»åæ„Ÿ</h4>
                    <form onsubmit="submitMagazineReview(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="reviewerName" class="block text-sm font-medium text-gray-700 mb-2">å§“å</label>
                                <input type="text" id="reviewerName" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                            </div>
                            <div>
                                <label for="reviewerSchool" class="block text-sm font-medium text-gray-700 mb-2">å­¦æ ¡åç§°</label>
                                <input type="text" id="reviewerSchool" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="è¯·è¾“å…¥å­¦æ ¡åç§°ï¼ˆå¯é€‰ï¼‰">
                            </div>
                        </div>
                        <div>
                            <label for="magazineReview" class="block text-sm font-medium text-gray-700 mb-2">è¯»åæ„Ÿå†…å®¹</label>
                            <textarea id="magazineReview" rows="6" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="è¯·åˆ†äº«æ‚¨é˜…è¯»æ­¤æ‚å¿—åçš„æ„Ÿæƒ³ã€å­¦åˆ°çš„çŸ¥è¯†ã€ä»¥åŠå¦‚ä½•åº”ç”¨åˆ°ç¯ä¿è¡ŒåŠ¨ä¸­..."></textarea>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <p class="text-sm text-blue-800"><strong>ğŸ’¡ å†™ä½œå»ºè®®ï¼š</strong></p>
                            <ul class="text-xs text-blue-700 mt-1 space-y-1">
                                <li>â€¢ åˆ†äº«æ‚¨æœ€å°è±¡æ·±åˆ»çš„å†…å®¹</li>
                                <li>â€¢ æè¿°æ‚¨å­¦åˆ°çš„æ–°çŸ¥è¯†æˆ–æŠ€èƒ½</li>
                                <li>â€¢ è¯´æ˜å¦‚ä½•å°†æ‰€å­¦åº”ç”¨åˆ°å®é™…ç¯ä¿è¡ŒåŠ¨ä¸­</li>
                                <li>â€¢ è¡¨è¾¾å¯¹ç”Ÿæ€æ–‡æ˜å»ºè®¾çš„æƒ³æ³•å’Œå»ºè®®</li>
                            </ul>
                        </div>
                        <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold">
                            ğŸ“ æäº¤è¯»åæ„Ÿ (+<span id="reviewPointsDisplay">25</span>ç§¯åˆ†)
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Background Image Upload Modal -->
    <div id="backgroundUploadModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ–¼ï¸ æ›´æ¢èƒŒæ™¯å›¾ç‰‡</h3>
                    <button onclick="closeBackgroundUploadModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <div class="text-center mb-6">
                    <div class="text-4xl mb-3" id="currentButtonIcon">ğŸ“</div>
                    <h4 class="text-lg font-bold text-gray-800 mb-2" id="currentButtonName">My Green Movement</h4>
                    <p class="text-gray-600 text-sm">ä¸ºæ­¤æŒ‰é’®é€‰æ‹©è‡ªå®šä¹‰èƒŒæ™¯å›¾ç‰‡</p>
                </div>
                
                <div class="space-y-4">
                    <!-- Image Upload -->
                    <div>
                        <label for="backgroundImageUpload" class="block text-sm font-medium text-gray-700 mb-2">ä¸Šä¼ å›¾ç‰‡</label>
                        <input type="file" id="backgroundImageUpload" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="handleBackgroundImageUpload(event)">
                        <p class="text-xs text-gray-500 mt-1">æ”¯æŒæ ¼å¼ï¼šJPG, PNG, WebPã€‚å»ºè®®å°ºå¯¸ï¼š400x300px</p>
                    </div>
                    
                    <!-- Preview -->
                    <div id="backgroundPreview" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¢„è§ˆæ•ˆæœ</label>
                        <div class="relative overflow-hidden rounded-xl shadow-lg">
                            <div id="previewBackground" class="h-32 bg-cover bg-center"></div>
                            <div class="absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center">
                                <div class="text-center text-white">
                                    <div class="text-3xl mb-2" id="previewIcon">ğŸ“</div>
                                    <h4 class="font-bold" id="previewTitle">My Green Movement</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Opacity Control -->
                    <div id="opacityControl" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">èƒŒæ™¯é€æ˜åº¦</label>
                        <input type="range" id="backgroundOpacity" class="w-full" min="0.3" max="1" step="0.1" value="1" oninput="updateBackgroundOpacity(this.value)">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>é€æ˜</span>
                            <span>ä¸é€æ˜</span>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-3 pt-4">
                        <button onclick="applyBackgroundImage()" id="applyBackgroundBtn" disabled class="flex-1 bg-gray-400 text-white py-3 px-4 rounded-lg font-semibold cursor-not-allowed">
                            âœ… åº”ç”¨èƒŒæ™¯
                        </button>
                        <button onclick="resetToGradient()" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-3 px-4 rounded-lg font-semibold">
                            ğŸ”„ æ¢å¤æ¸å˜
                        </button>
                    </div>
                </div>
                
                <!-- Preset Backgrounds -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h4 class="font-bold text-gray-800 mb-3">ğŸ¨ é¢„è®¾èƒŒæ™¯</h4>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="applyPresetBackground('nature')" class="h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-lg flex items-center justify-center text-white text-xs font-semibold hover:scale-105 transition-transform">
                            ğŸŒ¿ è‡ªç„¶
                        </button>
                        <button onclick="applyPresetBackground('ocean')" class="h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg flex items-center justify-center text-white text-xs font-semibold hover:scale-105 transition-transform">
                            ğŸŒŠ æµ·æ´‹
                        </button>
                        <button onclick="applyPresetBackground('sunset')" class="h-16 bg-gradient-to-br from-orange-400 to-pink-500 rounded-lg flex items-center justify-center text-white text-xs font-semibold hover:scale-105 transition-transform">
                            ğŸŒ… æ—¥è½
                        </button>
                        <button onclick="applyPresetBackground('forest')" class="h-16 bg-gradient-to-br from-green-600 to-green-800 rounded-lg flex items-center justify-center text-white text-xs font-semibold hover:scale-105 transition-transform">
                            ğŸŒ² æ£®æ—
                        </button>
                        <button onclick="applyPresetBackground('sky')" class="h-16 bg-gradient-to-br from-blue-300 to-blue-500 rounded-lg flex items-center justify-center text-white text-xs font-semibold hover:scale-105 transition-transform">
                            â˜ï¸ å¤©ç©º
                        </button>
                        <button onclick="applyPresetBackground('earth')" class="h-16 bg-gradient-to-br from-yellow-600 to-orange-700 rounded-lg flex items-center justify-center text-white text-xs font-semibold hover:scale-105 transition-transform">
                            ğŸŒ å¤§åœ°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Access Modal -->
    <div id="adminAccessModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ” ç®¡ç†å‘˜è®¿é—®éªŒè¯</h3>
                    <button onclick="closeAdminAccessModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                </div>
                
                <div class="text-center mb-6">
                    <div class="text-4xl mb-3">ğŸ›¡ï¸</div>
                    <p class="text-gray-600">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥è®¿é—®è‡ªå®šä¹‰åŠŸèƒ½</p>
                </div>
                
                <form onsubmit="verifyAdminAccess(event)" class="space-y-4">
                    <div>
                        <label for="adminAccessPassword" class="block text-sm font-medium text-gray-700 mb-2">ç®¡ç†å‘˜å¯†ç </label>
                        <input type="password" id="adminAccessPassword" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="è¯·è¾“å…¥å¯†ç ">
                        <p class="text-xs text-gray-500 mt-1">æç¤ºï¼šé»˜è®¤å¯†ç æ˜¯ "admin2024"</p>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                        <h4 class="font-bold text-yellow-800 text-sm mb-2">âš ï¸ ç®¡ç†å‘˜åŠŸèƒ½è¯´æ˜</h4>
                        <ul class="text-xs text-yellow-700 space-y-1">
                            <li>â€¢ è‡ªå®šä¹‰æ‰€æœ‰æŒ‰é’®å’ŒåŒºåŸŸèƒŒæ™¯å›¾ç‰‡</li>
                            <li>â€¢ ä¸Šä¼ å’Œç¼–è¾‘MECCC Logo</li>
                            <li>â€¢ ä¸Šä¼ ç”µå­æ‚å¿—å†…å®¹</li>
                            <li>â€¢ è®¿é—®é«˜çº§è‡ªå®šä¹‰é€‰é¡¹</li>
                        </ul>
                    </div>
                    
                    <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                        <h4 class="font-bold text-red-800 text-sm mb-2">ğŸš¨ å®‰å…¨æé†’</h4>
                        <ul class="text-xs text-red-700 space-y-1">
                            <li>â€¢ ç®¡ç†å‘˜åŠŸèƒ½ä»…ä¾›æˆæƒäººå‘˜ä½¿ç”¨</li>
                            <li>â€¢ è¯·å‹¿ä¸ä»–äººåˆ†äº«ç®¡ç†å‘˜å¯†ç </li>
                            <li>â€¢ ä½¿ç”¨å®Œæ¯•åè¯·é€€å‡ºç®¡ç†å‘˜æ¨¡å¼</li>
                        </ul>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold">
                        ğŸ”“ éªŒè¯å¹¶è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼
                    </button>
                </form>
                
                <div class="mt-4 text-center">
                    <button onclick="closeAdminAccessModal()" class="text-gray-500 hover:text-gray-700 text-sm">
                        å–æ¶ˆè®¿é—®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Text Edit Toolbar -->
    <div id="textEditToolbar" class="fixed top-20 right-4 bg-white rounded-xl shadow-xl border-2 border-yellow-400 hidden z-50" style="max-width: 280px;">
        <!-- Draggable Header -->
        <div id="toolbarHeader" class="bg-yellow-400 text-gray-800 p-3 rounded-t-xl cursor-move select-none flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <span class="text-sm font-bold">âœï¸ æ–‡å­—ç¼–è¾‘å·¥å…·</span>
                <span class="text-xs opacity-75">(å¯æ‹–æ‹½)</span>
            </div>
            <div class="flex space-x-1">
                <button onclick="toggleToolbarCollapse()" class="hover:bg-yellow-500 rounded px-2 py-1 text-xs font-bold" id="collapseBtn">
                    â–
                </button>
                <button onclick="toggleTextEditMode()" class="hover:bg-yellow-500 rounded px-2 py-1 text-xs font-bold">
                    âœ•
                </button>
            </div>
        </div>
        
        <!-- Collapsible Content -->
        <div id="toolbarContent" class="p-4">
            <div class="text-center mb-3">
                <p class="text-xs text-gray-600">ç‚¹å‡»æ–‡å­—ç¼–è¾‘ï¼ŒEnterä¿å­˜ï¼ŒEscå–æ¶ˆ</p>
            </div>
        
        <div class="space-y-3">
            <!-- Undo/Redo Controls -->
            <div class="bg-red-50 rounded-lg p-3">
                <h5 class="font-bold text-red-800 text-sm mb-2">â†©ï¸ æ’¤é”€/é‡åš</h5>
                <div class="flex space-x-2">
                    <button onclick="undoChange()" id="undoBtn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                        â†©ï¸ æ’¤é”€
                    </button>
                    <button onclick="redoChange()" id="redoBtn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                        â†ªï¸ é‡åš
                    </button>
                </div>
                <p class="text-xs text-red-600 mt-1" id="historyStatus">æ— å†å²è®°å½•</p>
            </div>
            
            <!-- Font Size Controls -->
            <div class="bg-blue-50 rounded-lg p-3">
                <h5 class="font-bold text-blue-800 text-sm mb-2">ğŸ“ å­—ä½“å¤§å°</h5>
                <div class="flex space-x-2">
                    <button onclick="changeFontSize('smaller')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs">
                        A-
                    </button>
                    <button onclick="changeFontSize('larger')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs">
                        A+
                    </button>
                    <button onclick="resetFontSize()" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs">
                        é‡ç½®
                    </button>
                </div>
            </div>
            
            <!-- Text Style Controls -->
            <div class="bg-green-50 rounded-lg p-3">
                <h5 class="font-bold text-green-800 text-sm mb-2">ğŸ¨ æ–‡å­—æ ·å¼</h5>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="toggleBold()" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">
                        <strong>ç²—ä½“</strong>
                    </button>
                    <button onclick="toggleItalic()" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">
                        <em>æ–œä½“</em>
                    </button>
                </div>
            </div>
            
            <!-- Emoji Picker -->
            <div class="bg-purple-50 rounded-lg p-3">
                <h5 class="font-bold text-purple-800 text-sm mb-2">ğŸ˜Š è¡¨æƒ…ç¬¦å·</h5>
                <div class="grid grid-cols-6 gap-1 text-lg">
                    <button onclick="insertEmoji('ğŸŒ±')" class="hover:bg-purple-200 rounded p-1">ğŸŒ±</button>
                    <button onclick="insertEmoji('ğŸ“š')" class="hover:bg-purple-200 rounded p-1">ğŸ“š</button>
                    <button onclick="insertEmoji('ğŸ«')" class="hover:bg-purple-200 rounded p-1">ğŸ«</button>
                    <button onclick="insertEmoji('ğŸŒŸ')" class="hover:bg-purple-200 rounded p-1">ğŸŒŸ</button>
                    <button onclick="insertEmoji('ğŸ¯')" class="hover:bg-purple-200 rounded p-1">ğŸ¯</button>
                    <button onclick="insertEmoji('ğŸ†')" class="hover:bg-purple-200 rounded p-1">ğŸ†</button>
                    <button onclick="insertEmoji('ğŸ’š')" class="hover:bg-purple-200 rounded p-1">ğŸ’š</button>
                    <button onclick="insertEmoji('âœ…')" class="hover:bg-purple-200 rounded p-1">âœ…</button>
                    <button onclick="insertEmoji('ğŸ‰')" class="hover:bg-purple-200 rounded p-1">ğŸ‰</button>
                    <button onclick="insertEmoji('ğŸ”§')" class="hover:bg-purple-200 rounded p-1">ğŸ”§</button>
                    <button onclick="insertEmoji('âš¡')" class="hover:bg-purple-200 rounded p-1">âš¡</button>
                    <button onclick="insertEmoji('ğŸŒ')" class="hover:bg-purple-200 rounded p-1">ğŸŒ</button>
                </div>
                <button onclick="showEmojiPicker()" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded text-xs mt-2">
                    æ›´å¤šè¡¨æƒ…...
                </button>
            </div>
            
            <!-- Text Actions -->
            <div class="bg-orange-50 rounded-lg p-3">
                <h5 class="font-bold text-orange-800 text-sm mb-2">ğŸ“ æ–‡å­—æ“ä½œ</h5>
                <div class="space-y-2">
                    <button onclick="addTextElement()" class="w-full bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded text-xs">
                        â• æ·»åŠ æ–‡å­—
                    </button>
                    <button onclick="deleteSelectedText()" class="w-full bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                        ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­æ–‡å­—
                    </button>
                </div>
            </div>
            
            <!-- Current Selection Info -->
            <div id="selectionInfo" class="bg-gray-50 rounded-lg p-3 hidden">
                <h5 class="font-bold text-gray-800 text-sm mb-2">ğŸ“ å½“å‰é€‰æ‹©</h5>
                <p class="text-xs text-gray-600" id="selectedElementInfo">æœªé€‰æ‹©ä»»ä½•å…ƒç´ </p>
            </div>
        </div>
        
        <div class="mt-4 pt-3 border-t border-gray-200">
            <button onclick="toggleTextEditMode()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded font-semibold text-sm">
                ğŸšª é€€å‡ºç¼–è¾‘æ¨¡å¼
            </button>
        </div>
    </div>

    <!-- Emoji Picker Modal -->
    <div id="emojiPickerModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">ğŸ˜Š é€‰æ‹©è¡¨æƒ…ç¬¦å·</h3>
                    <button onclick="closeEmojiPicker()" class="text-gray-400 hover:text-gray-600 text-xl">âœ•</button>
                </div>
                
                <div class="space-y-4">
                    <!-- Emoji Categories -->
                    <div class="flex space-x-2 text-xs">
                        <button onclick="showEmojiCategory('nature')" class="bg-green-100 hover:bg-green-200 px-3 py-1 rounded">ğŸŒ± è‡ªç„¶</button>
                        <button onclick="showEmojiCategory('objects')" class="bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded">ğŸ“š ç‰©å“</button>
                        <button onclick="showEmojiCategory('symbols')" class="bg-purple-100 hover:bg-purple-200 px-3 py-1 rounded">â­ ç¬¦å·</button>
                        <button onclick="showEmojiCategory('faces')" class="bg-yellow-100 hover:bg-yellow-200 px-3 py-1 rounded">ğŸ˜Š è¡¨æƒ…</button>
                    </div>
                    
                    <!-- Emoji Grid -->
                    <div id="emojiGrid" class="grid grid-cols-8 gap-2 text-2xl max-h-64 overflow-y-auto">
                        <!-- Emojis will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">âš ï¸ ç¡®è®¤ä¿®æ”¹</h3>
                    <button onclick="closeConfirmationModal()" class="text-gray-400 hover:text-gray-600 text-xl">âœ•</button>
                </div>
                
                <div class="mb-6">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2" id="confirmationIcon">âš ï¸</div>
                        <p class="text-gray-700" id="confirmationMessage">æ‚¨ç¡®å®šè¦è¿›è¡Œæ­¤ä¿®æ”¹å—ï¼Ÿ</p>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
                        <h4 class="font-bold text-yellow-800 text-sm mb-2">ğŸ“‹ ä¿®æ”¹è¯¦æƒ…ï¼š</h4>
                        <p class="text-yellow-700 text-sm" id="changeDetails">å³å°†è¿›è¡Œçš„ä¿®æ”¹...</p>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <h4 class="font-bold text-blue-800 text-sm mb-2">ğŸ’¡ æç¤ºï¼š</h4>
                        <p class="text-blue-700 text-sm">æ­¤æ“ä½œå¯ä»¥é€šè¿‡"æ’¤é”€"åŠŸèƒ½æ¢å¤ã€‚æ‚¨çš„ä¿®æ”¹å†å²å°†è¢«ä¿å­˜ã€‚</p>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="confirmAction()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-semibold">
                        âœ… ç¡®è®¤ä¿®æ”¹
                    </button>
                    <button onclick="closeConfirmationModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold">
                        âŒ å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Text Input Modal -->
    <div id="textInputModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">ğŸ“ æ·»åŠ æ–°æ–‡å­—</h3>
                    <button onclick="closeTextInputModal()" class="text-gray-400 hover:text-gray-600 text-xl">âœ•</button>
                </div>
                
                <form onsubmit="createNewTextElement(event)" class="space-y-4">
                    <div>
                        <label for="newTextContent" class="block text-sm font-medium text-gray-700 mb-2">æ–‡å­—å†…å®¹</label>
                        <textarea id="newTextContent" rows="3" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="è¾“å…¥è¦æ·»åŠ çš„æ–‡å­—..."></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="textSize" class="block text-sm font-medium text-gray-700 mb-2">å­—ä½“å¤§å°</label>
                            <select id="textSize" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="text-xs">å¾ˆå°</option>
                                <option value="text-sm">å°</option>
                                <option value="text-base" selected>æ­£å¸¸</option>
                                <option value="text-lg">å¤§</option>
                                <option value="text-xl">å¾ˆå¤§</option>
                                <option value="text-2xl">è¶…å¤§</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="textColor" class="block text-sm font-medium text-gray-700 mb-2">æ–‡å­—é¢œè‰²</label>
                            <select id="textColor" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="text-gray-800" selected>æ·±ç°</option>
                                <option value="text-green-600">ç»¿è‰²</option>
                                <option value="text-blue-600">è“è‰²</option>
                                <option value="text-purple-600">ç´«è‰²</option>
                                <option value="text-orange-600">æ©™è‰²</option>
                                <option value="text-red-600">çº¢è‰²</option>
                                <option value="text-white">ç™½è‰²</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="textPosition" class="block text-sm font-medium text-gray-700 mb-2">æ’å…¥ä½ç½®</label>
                        <select id="textPosition" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="header">HeaderåŒºåŸŸ</option>
                            <option value="hero" selected>HeroåŒºåŸŸ</option>
                            <option value="features">åŠŸèƒ½åŒºåŸŸ</option>
                            <option value="competition">ç«èµ›åŒºåŸŸ</option>
                            <option value="partnership">åˆä½œåŒºåŸŸ</option>
                        </select>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold">
                            âœ… æ·»åŠ æ–‡å­—
                        </button>
                        <button type="button" onclick="closeTextInputModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold">
                            âŒ å–æ¶ˆ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform z-50">
        <div class="flex items-center space-x-2">
            <span>âœ…</span>
            <span id="toastMessage">Success!</span>
        </div>
    </div>

    <script>
        // Sample magazines data
        const magazinesData = [
            {
                id: 1,
                title: "ç”Ÿæ€æ–‡æ˜å­¦æ ¡ç¬¬1æœŸ",
                issue: "ç¬¬1æœŸ",
                description: "ä»‹ç»ç”Ÿæ€æ–‡æ˜æ•™è‚²çš„åŸºæœ¬ç†å¿µå’Œå®è·µæ–¹æ³•ï¼ŒåŒ…å«å­¦æ ¡ç¯ä¿é¡¹ç›®æ¡ˆä¾‹åˆ†æã€‚",
                url: "https://online.visual-paradigm.com/share/book/sekolah-bertamadun-ekologi-ebook-23owrlo1dc",
                readingPoints: 15,
                reviewPoints: 30,
                publishDate: "2024å¹´1æœˆ",
                coverImage: "ğŸ“š",
                status: "available"
            },
            {
                id: 2,
                title: "ç¯ä¿è¡ŒåŠ¨æŒ‡å—",
                issue: "ç¬¬2æœŸ",
                description: "è¯¦ç»†ä»‹ç»å„ç§ç¯ä¿è¡ŒåŠ¨çš„å…·ä½“å®æ–½æ–¹æ³•ï¼ŒåŒ…å«åºŸç‰©åˆ†ç±»ã€èŠ‚èƒ½å‡æ’ç­‰å®ç”¨æŠ€å·§ã€‚",
                url: "https://online.visual-paradigm.com/share/book/environmental-action-guide-abc123",
                readingPoints: 12,
                reviewPoints: 25,
                publishDate: "2024å¹´2æœˆ",
                coverImage: "ğŸŒ±",
                status: "available"
            },
            {
                id: 3,
                title: "é’å°‘å¹´ç”Ÿæ€é¢†è¢–",
                issue: "ç¬¬3æœŸ",
                description: "å±•ç¤ºä¼˜ç§€é’å°‘å¹´ç¯ä¿é¢†è¢–çš„æ•…äº‹å’Œç»éªŒåˆ†äº«ï¼Œæ¿€åŠ±æ›´å¤šå­¦ç”Ÿå‚ä¸ç¯ä¿è¡ŒåŠ¨ã€‚",
                url: "https://online.visual-paradigm.com/share/book/youth-eco-leaders-def456",
                readingPoints: 18,
                reviewPoints: 35,
                publishDate: "2024å¹´3æœˆ",
                coverImage: "ğŸŒŸ",
                status: "available"
            }
        ];

        // Current reading magazine
        let currentMagazine = null;
        let hasReadCurrentMagazine = false;
        
        // Admin mode state
        let isAdminMode = false;

        // Sample data for sponsors
        const sponsorsData = [
            {
                name: "Green Tech Solutions",
                logo: "ğŸŒ±",
                level: "platinum",
                contribution: "Platinum Level",
                description: "Environmental technology solutions provider"
            },
            {
                name: "Eco Education Foundation",
                logo: "ğŸ“š",
                level: "gold",
                contribution: "Gold Level",
                description: "Focused on youth environmental education development"
            },
            {
                name: "Clean Energy Group",
                logo: "âš¡",
                level: "gold",
                contribution: "Gold Level",
                description: "Renewable energy technology leader"
            },
            {
                name: "Sustainable Construction",
                logo: "ğŸ—ï¸",
                level: "silver",
                contribution: "Silver Level",
                description: "Green building and ecological restoration expert"
            }
        ];

        // Sample school rankings data
        const schoolRankingsData = [
            {
                rank: 1,
                school: "SMK Damansara Jaya",
                students: 45,
                averageScore: 87.5,
                award: "gold",
                prize: "Cash Award + Environmental Equipment"
            },
            {
                rank: 2,
                school: "SJKC Chong Hwa",
                students: 32,
                averageScore: 84.2,
                award: "gold",
                prize: "Cash Award + Environmental Equipment"
            },
            {
                rank: 3,
                school: "SMK Subang Jaya",
                students: 28,
                averageScore: 76.8,
                award: "silver",
                prize: "Cash Award + Educational Materials"
            },
            {
                rank: 4,
                school: "SJKT Ladang Bukit Jalil",
                students: 15,
                averageScore: 73.4,
                award: "silver",
                prize: "Cash Award + Educational Materials"
            },
            {
                rank: 5,
                school: "SMK Bandar Utama",
                students: 22,
                averageScore: 68.9,
                award: "bronze",
                prize: "Cash Award + Eco Supplies"
            },
            {
                rank: 6,
                school: "SK Taman Desa",
                students: 18,
                averageScore: 65.3,
                award: "bronze",
                prize: "Cash Award + Eco Supplies"
            }
        ];

        // Sample Green Mover rankings data
        const greenMoverRankingsData = [
            {
                rank: 1,
                name: "Sarah Chen",
                location: "Kuala Lumpur",
                submissions: 28,
                averageScore: 95.2,
                award: "champion",
                recognition: "Certificate + Medal + Media Coverage"
            },
            {
                rank: 2,
                name: "Ahmad Rahman",
                location: "Selangor",
                submissions: 22,
                averageScore: 92.8,
                award: "innovation",
                recognition: "Certificate + Medal + Media Coverage"
            },
            {
                rank: 3,
                name: "Priya Devi",
                location: "Penang",
                submissions: 19,
                averageScore: 89.5,
                award: "impact",
                recognition: "Certificate + Medal + Media Coverage"
            },
            {
                rank: 4,
                name: "Lim Wei Ming",
                location: "Johor",
                submissions: 25,
                averageScore: 87.3,
                award: "consistency",
                recognition: "Certificate + Medal + Media Coverage"
            },
            {
                rank: 5,
                name: "Nurul Aisyah",
                location: "Perak",
                submissions: 16,
                averageScore: 85.7,
                award: "youth",
                recognition: "Certificate + Medal + Media Coverage"
            },
            {
                rank: 6,
                name: "David Tan",
                location: "Sabah",
                submissions: 20,
                averageScore: 83.9,
                award: "mentor",
                recognition: "Certificate + Medal + Media Coverage"
            }
        ];

        // Load sponsors and rankings on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSponsors();
            loadSchoolRankings();
            loadGreenMoverRankings();
            loadMagazines();
            loadSavedLogo(); // Load saved MECCC logo
            loadSavedBackgrounds(); // Load saved button backgrounds
            loadAdminModeState(); // Load admin mode state
            loadChangeHistory(); // Load change history
            
            // Emoji replacement is now disabled to prevent layout issues
            // Users can still see native emojis which work well across all devices
        });

        // Load sponsors
        function loadSponsors() {
            const sponsorsGrid = document.getElementById('sponsorsGrid');
            sponsorsGrid.innerHTML = '';
            
            sponsorsData.forEach(sponsor => {
                const sponsorCard = document.createElement('div');
                sponsorCard.className = 'sponsor-card rounded-xl p-6 text-center card-hover';
                sponsorCard.innerHTML = `
                    <div class="text-4xl mb-4">${sponsor.logo}</div>
                    <h4 class="font-bold text-gray-800 mb-2">${sponsor.name}</h4>
                    <p class="text-sm text-gray-600 mb-2">${sponsor.description}</p>
                    <div class="inline-block px-3 py-1 rounded-full text-xs font-semibold ${getLevelColor(sponsor.level)}">
                        ${getLevelText(sponsor.level)}
                    </div>
                    <p class="text-lg font-bold text-green-600 mt-2">${sponsor.contribution}</p>
                `;
                sponsorsGrid.appendChild(sponsorCard);
            });
        }

        // Load school rankings
        function loadSchoolRankings() {
            const rankingsTableBody = document.getElementById('rankingsTableBody');
            if (rankingsTableBody) {
                rankingsTableBody.innerHTML = '';
                
                schoolRankingsData.forEach(school => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <span class="text-2xl mr-2">${getRankIcon(school.rank)}</span>
                                <span class="text-lg font-bold text-gray-900">${school.rank}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${school.school}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${school.students} students
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="text-lg font-bold ${getScoreColor(school.averageScore)}">${school.averageScore}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getAwardColor(school.award)}">
                                ${getAwardIcon(school.award)} ${getAwardText(school.award)}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${school.prize}
                        </td>
                    `;
                    rankingsTableBody.appendChild(row);
                });
            }
        }

        // Helper functions
        function getLevelColor(level) {
            switch(level) {
                case 'platinum': return 'bg-purple-100 text-purple-800';
                case 'gold': return 'bg-yellow-100 text-yellow-800';
                case 'silver': return 'bg-gray-100 text-gray-800';
                case 'bronze': return 'bg-orange-100 text-orange-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getLevelText(level) {
            switch(level) {
                case 'platinum': return 'Platinum Sponsor';
                case 'gold': return 'Gold Sponsor';
                case 'silver': return 'Silver Sponsor';
                case 'bronze': return 'Bronze Sponsor';
                default: return 'Sponsor';
            }
        }

        function getRankIcon(rank) {
            if (rank === 1) return 'ğŸ¥‡';
            if (rank === 2) return 'ğŸ¥ˆ';
            if (rank === 3) return 'ğŸ¥‰';
            return 'ğŸ†';
        }

        function getScoreColor(score) {
            if (score >= 80) return 'text-yellow-600';
            if (score >= 70) return 'text-gray-600';
            if (score >= 60) return 'text-orange-600';
            return 'text-red-600';
        }

        function getAwardColor(award) {
            switch(award) {
                case 'gold': return 'bg-yellow-100 text-yellow-800';
                case 'silver': return 'bg-gray-100 text-gray-800';
                case 'bronze': return 'bg-orange-100 text-orange-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getAwardIcon(award) {
            switch(award) {
                case 'gold': return 'ğŸ¥‡';
                case 'silver': return 'ğŸ¥ˆ';
                case 'bronze': return 'ğŸ¥‰';
                default: return 'ğŸ†';
            }
        }

        function getAwardText(award) {
            switch(award) {
                case 'gold': return 'Gold Award';
                case 'silver': return 'Silver Award';
                case 'bronze': return 'Bronze Award';
                default: return 'Participation Award';
            }
        }

        function getGreenMoverAwardIcon(award) {
            switch(award) {
                case 'champion': return 'ğŸ‘‘';
                case 'innovation': return 'ğŸŒ±';
                case 'impact': return 'ğŸ’š';
                case 'consistency': return 'â­';
                case 'youth': return 'ğŸš€';
                case 'mentor': return 'ğŸ“';
                default: return 'ğŸ†';
            }
        }

        function getGreenMoverAwardText(award) {
            switch(award) {
                case 'champion': return 'Environmental Champion';
                case 'innovation': return 'Eco Innovation Leader';
                case 'impact': return 'Community Impact Award';
                case 'consistency': return 'Consistency Award';
                case 'youth': return 'Youth Leader';
                case 'mentor': return 'Mentor Award';
                default: return 'Recognition Award';
            }
        }

        function getGreenMoverAwardColor(award) {
            switch(award) {
                case 'champion': return 'bg-purple-100 text-purple-800';
                case 'innovation': return 'bg-green-100 text-green-800';
                case 'impact': return 'bg-blue-100 text-blue-800';
                case 'consistency': return 'bg-yellow-100 text-yellow-800';
                case 'youth': return 'bg-pink-100 text-pink-800';
                case 'mentor': return 'bg-indigo-100 text-indigo-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Load magazines
        function loadMagazines() {
            const magazinesList = document.getElementById('magazinesList');
            if (magazinesList) {
                magazinesList.innerHTML = '';
                
                magazinesData.forEach(magazine => {
                    const magazineCard = document.createElement('div');
                    magazineCard.className = 'bg-white rounded-xl p-6 shadow-lg border-2 border-gray-200 hover:border-orange-300 transition-all';
                    magazineCard.innerHTML = `
                        <div class="text-center mb-4">
                            <div class="text-6xl mb-3">${magazine.coverImage}</div>
                            <h4 class="font-bold text-gray-800 text-lg mb-2">${magazine.title}</h4>
                            <p class="text-sm text-gray-600 mb-3">${magazine.description}</p>
                            <div class="flex justify-between text-xs text-gray-500 mb-4">
                                <span>ğŸ“… ${magazine.publishDate}</span>
                                <span>ğŸ“– ${magazine.issue}</span>
                            </div>
                        </div>
                        
                        <div class="bg-orange-50 rounded-lg p-3 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-orange-700">ğŸ“– é˜…è¯»ç§¯åˆ†: <strong>${magazine.readingPoints}</strong></span>
                                <span class="text-orange-700">âœï¸ è¯»åæ„Ÿç§¯åˆ†: <strong>${magazine.reviewPoints}</strong></span>
                            </div>
                        </div>
                        
                        <button onclick="readMagazine(${magazine.id})" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 px-4 rounded-lg font-semibold">
                            ğŸ“š å¼€å§‹é˜…è¯»
                        </button>
                    `;
                    magazinesList.appendChild(magazineCard);
                });
            }
        }

        // Magazine functions
        function readMagazine(magazineId) {
            currentMagazine = magazinesData.find(m => m.id === magazineId);
            if (currentMagazine) {
                document.getElementById('readingMagazineTitle').textContent = `ğŸ“š ${currentMagazine.title}`;
                document.getElementById('readingPointsDisplay').textContent = currentMagazine.readingPoints;
                document.getElementById('reviewPointsDisplay').textContent = currentMagazine.reviewPoints;
                
                // Reset reading state
                hasReadCurrentMagazine = false;
                document.getElementById('confirmReadingBtn').disabled = false;
                document.getElementById('confirmReadingBtn').className = 'bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold';
                
                // Reset magazine viewer state
                document.getElementById('magazineLoading').classList.remove('hidden');
                document.getElementById('magazineViewer').classList.add('hidden');
                document.getElementById('magazineError').classList.add('hidden');
                document.getElementById('magazineAlternative').classList.add('hidden');
                
                // Reset progress
                updateReadingProgress(0);
                document.getElementById('readingProgress').textContent = 'å‡†å¤‡å¼€å§‹';
                
                // Clear any existing timer
                if (window.currentReadingTimer) {
                    clearInterval(window.currentReadingTimer);
                }
                
                closeMagazineModal();
                document.getElementById('magazineReadingModal').classList.remove('hidden');
                
                // Try to load magazine in iframe with delay to show loading state
                setTimeout(() => {
                    const viewer = document.getElementById('magazineViewer');
                    viewer.src = currentMagazine.url;
                    
                    // Set a timeout to show error state if iframe doesn't load
                    setTimeout(() => {
                        if (viewer.classList.contains('hidden')) {
                            handleMagazineError();
                        }
                    }, 8000); // 8 second timeout
                }, 1000);
            }
        }

        function openMagazineInNewTab() {
            if (currentMagazine) {
                window.open(currentMagazine.url, '_blank', 'noopener,noreferrer');
                
                // Update reading progress when opening in new tab
                updateReadingProgress(25);
                document.getElementById('readingProgress').textContent = 'å·²åœ¨æ–°çª—å£æ‰“å¼€';
            }
        }

        function handleMagazineLoad() {
            // Hide loading, show iframe
            document.getElementById('magazineLoading').classList.add('hidden');
            document.getElementById('magazineViewer').classList.remove('hidden');
            document.getElementById('magazineError').classList.add('hidden');
            document.getElementById('magazineAlternative').classList.add('hidden');
            
            updateReadingProgress(50);
            document.getElementById('readingProgress').textContent = 'æ‚å¿—å·²åŠ è½½';
            
            // Start reading timer
            startReadingTimer();
        }

        function handleMagazineError() {
            // Show error state and alternative display
            document.getElementById('magazineLoading').classList.add('hidden');
            document.getElementById('magazineViewer').classList.add('hidden');
            document.getElementById('magazineError').classList.remove('hidden');
            document.getElementById('magazineAlternative').classList.remove('hidden');
            
            // Update alternative display with current magazine info
            if (currentMagazine) {
                document.getElementById('altMagazineCover').textContent = currentMagazine.coverImage;
                document.getElementById('altMagazineTitle').textContent = currentMagazine.title;
                document.getElementById('altMagazineDesc').textContent = currentMagazine.description;
            }
            
            document.getElementById('readingProgress').textContent = 'è¯·åœ¨æ–°çª—å£é˜…è¯»';
        }

        function toggleFullscreen() {
            const container = document.getElementById('magazineContainer');
            const viewer = document.getElementById('magazineViewer');
            
            if (!document.fullscreenElement) {
                container.requestFullscreen().then(() => {
                    viewer.style.height = '100vh';
                    updateReadingProgress(75);
                    document.getElementById('readingProgress').textContent = 'å…¨å±é˜…è¯»ä¸­';
                }).catch(err => {
                    console.log('Fullscreen not supported');
                    // Fallback: make container larger
                    viewer.style.height = '80vh';
                    showToast('ğŸ’¡ æç¤ºï¼šæŒ‰ ESC é”®å¯é€€å‡ºå…¨å±æ¨¡å¼');
                });
            } else {
                document.exitFullscreen();
                viewer.style.height = '24rem'; // Reset to h-96 equivalent
            }
        }

        function updateReadingProgress(percentage) {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
        }

        function startReadingTimer() {
            let timeSpent = 0;
            const timer = setInterval(() => {
                timeSpent += 10;
                const progress = Math.min(50 + (timeSpent / 120) * 40, 90); // 50% base + up to 40% for time
                updateReadingProgress(progress);
                
                if (timeSpent >= 60) { // After 1 minute
                    document.getElementById('readingProgress').textContent = 'æ·±åº¦é˜…è¯»ä¸­';
                }
                if (timeSpent >= 180) { // After 3 minutes
                    document.getElementById('readingProgress').textContent = 'é˜…è¯»è¿›å±•è‰¯å¥½';
                    updateReadingProgress(95);
                }
                if (timeSpent >= 300) { // After 5 minutes
                    document.getElementById('readingProgress').textContent = 'å¯ç¡®è®¤å®Œæ•´é˜…è¯»';
                    updateReadingProgress(100);
                    clearInterval(timer);
                }
            }, 10000); // Update every 10 seconds
            
            // Store timer to clear when modal closes
            window.currentReadingTimer = timer;
        }

        function confirmReading() {
            if (currentMagazine && !hasReadCurrentMagazine) {
                hasReadCurrentMagazine = true;
                
                // Disable the reading confirmation button
                const confirmBtn = document.getElementById('confirmReadingBtn');
                confirmBtn.disabled = true;
                confirmBtn.className = 'bg-gray-400 text-white px-6 py-3 rounded-lg font-semibold cursor-not-allowed';
                confirmBtn.innerHTML = 'âœ… å·²è·å¾—é˜…è¯»ç§¯åˆ† (+' + currentMagazine.readingPoints + 'ç§¯åˆ†)';
                
                showToast(`ğŸ‰ é˜…è¯»å®Œæˆï¼è·å¾— ${currentMagazine.readingPoints} ç§¯åˆ†ã€‚ç°åœ¨å¯ä»¥æäº¤è¯»åæ„Ÿè·å¾—é¢å¤– ${currentMagazine.reviewPoints} ç§¯åˆ†ï¼`);
            }
        }

        function submitMagazineReview(event) {
            event.preventDefault();
            
            if (!hasReadCurrentMagazine || !readingVerified) {
                showToast('âš ï¸ è¯·å…ˆç¡®è®¤å®Œæ•´é˜…è¯»æ‚å¿—åå†æäº¤è¯»åæ„Ÿï¼');
                return;
            }
            
            const reviewerName = document.getElementById('reviewerName').value;
            const reviewerSchool = document.getElementById('reviewerSchool').value;
            const reviewContent = document.getElementById('magazineReview').value;
            
            if (reviewContent.length < 100) {
                showToast('âš ï¸ è¯»åæ„Ÿå†…å®¹è‡³å°‘éœ€è¦100å­—ï¼Œè¯·è¯¦ç»†åˆ†äº«æ‚¨çš„æ„Ÿæƒ³å’Œæ”¶è·ï¼');
                return;
            }
            
            // Enhanced AI review scoring with comprehensive evaluation
            const contentQuality = Math.floor(Math.random() * 20) + 80; // 80-100 base score
            const originalityScore = Math.floor(Math.random() * 15) + 85; // 85-100 originality
            const depthScore = reviewContent.length > 300 ? Math.floor(Math.random() * 10) + 90 : Math.floor(Math.random() * 15) + 75;
            
            // Calculate comprehensive review score
            const averageScore = Math.floor((contentQuality + originalityScore + depthScore) / 3);
            
            // Determine bonus points based on quality
            let qualityBonus = 0;
            if (averageScore >= 95) qualityBonus = 15;
            else if (averageScore >= 90) qualityBonus = 10;
            else if (averageScore >= 85) qualityBonus = 5;
            
            // Get reading points from previous confirmation
            const actualReadingPoints = parseInt(document.getElementById('readingPointsDisplay').textContent);
            const totalReviewPoints = currentMagazine.reviewPoints + qualityBonus;
            const grandTotal = actualReadingPoints + totalReviewPoints;
            
            // Calculate contribution to school ecological civilization index
            let schoolContribution = '';
            if (reviewerSchool) {
                const readingContribution = actualReadingPoints; // B component
                const reviewContribution = totalReviewPoints; // B component
                const totalBComponent = readingContribution + reviewContribution;
                
                schoolContribution = `
                ğŸ“Š å­¦æ ¡ç”Ÿæ€æ–‡æ˜æŒ‡æ•°è´¡çŒ®ï¼š
                â€¢ B(é˜…è¯»å­¦ä¹ ç§¯åˆ†): +${totalBComponent}åˆ†
                â€¢ ä¸ªäººè´¨é‡è¯„çº§: ${averageScore >= 90 ? 'Açº§' : averageScore >= 80 ? 'Bçº§' : 'Cçº§'}
                â€¢ å¯¹å­¦æ ¡æ€»æŒ‡æ•°å½±å“: +${totalBComponent}åˆ† (å°†ä¸å‚ä¸ç‡å’Œè´¨é‡ç³»æ•°è®¡ç®—)
                `;
            }
            
            let message = `ğŸ‰ è¯»åæ„ŸAIè¯„ä¼°å®Œæˆï¼
            
ğŸ“ å†…å®¹è´¨é‡: ${contentQuality}/100
ğŸ¯ åŸåˆ›æ€§: ${originalityScore}/100  
ğŸ“š æ·±åº¦åˆ†æ: ${depthScore}/100
â­ ç»¼åˆè¯„åˆ†: ${averageScore}/100

ğŸ’° ç§¯åˆ†æ˜ç»†ï¼š
â€¢ é˜…è¯»éªŒè¯ç§¯åˆ†: ${actualReadingPoints}åˆ†
â€¢ è¯»åæ„ŸåŸºç¡€ç§¯åˆ†: ${currentMagazine.reviewPoints}åˆ†`;
            
            if (qualityBonus > 0) {
                message += `\nâ€¢ ä¼˜è´¨å†…å®¹å¥–åŠ±: +${qualityBonus}åˆ†`;
            }
            
            message += `\nğŸ† æœ¬æ¬¡æ€»è·å¾—: ${grandTotal}åˆ†`;
            
            if (reviewerSchool) {
                message += `\n\n${schoolContribution}`;
            }
            
            showToast(message);
            closeMagazineReadingModal();
            
            // Reset form
            document.getElementById('reviewerName').value = '';
            document.getElementById('reviewerSchool').value = '';
            document.getElementById('magazineReview').value = '';
        }

        function uploadMagazine(event) {
            event.preventDefault();
            
            const title = document.getElementById('magazineTitle').value;
            const issue = document.getElementById('magazineIssue').value;
            const url = document.getElementById('magazineUrl').value;
            const description = document.getElementById('magazineDescription').value;
            const readingPoints = parseInt(document.getElementById('readingPoints').value);
            const reviewPoints = parseInt(document.getElementById('reviewPoints').value);
            
            // Add new magazine to the data
            const newMagazine = {
                id: magazinesData.length + 1,
                title: title,
                issue: issue,
                description: description,
                url: url,
                readingPoints: readingPoints,
                reviewPoints: reviewPoints,
                publishDate: new Date().toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' }),
                coverImage: "ğŸ“–",
                status: "available"
            };
            
            magazinesData.push(newMagazine);
            loadMagazines();
            
            showToast(`ğŸ“š ç”µå­æ‚å¿— "${title}" ä¸Šä¼ æˆåŠŸï¼å­¦ç”Ÿç°åœ¨å¯ä»¥é˜…è¯»å¹¶è·å¾—ç§¯åˆ†ã€‚`);
            
            // Reset form
            document.getElementById('magazineTitle').value = '';
            document.getElementById('magazineIssue').value = '';
            document.getElementById('magazineUrl').value = '';
            document.getElementById('magazineDescription').value = '';
            document.getElementById('readingPoints').value = '10';
            document.getElementById('reviewPoints').value = '25';
            
            // Hide admin upload section
            document.getElementById('adminMagazineUpload').classList.add('hidden');
        }

        function toggleAdminUpload() {
            const adminSection = document.getElementById('adminMagazineUpload');
            adminSection.classList.toggle('hidden');
        }

        // Modal functions
        function showMagazineModal() {
            document.getElementById('magazineModal').classList.remove('hidden');
        }

        function closeMagazineModal() {
            document.getElementById('magazineModal').classList.add('hidden');
        }

        function closeMagazineReadingModal() {
            document.getElementById('magazineReadingModal').classList.add('hidden');
            
            // Clear reading timer
            if (window.currentReadingTimer) {
                clearInterval(window.currentReadingTimer);
                window.currentReadingTimer = null;
            }
            
            // Reset iframe src to stop loading
            document.getElementById('magazineViewer').src = '';
            
            // Exit fullscreen if active
            if (document.fullscreenElement) {
                document.exitFullscreen();
            }
            
            currentMagazine = null;
            hasReadCurrentMagazine = false;
        }

        function showEcoSubmissionModal() {
            document.getElementById('ecoSubmissionModal').classList.remove('hidden');
        }

        function closeEcoSubmissionModal() {
            document.getElementById('ecoSubmissionModal').classList.add('hidden');
        }

        function showStudentRegistrationModal() {
            document.getElementById('studentRegistrationModal').classList.remove('hidden');
        }

        function closeStudentRegistrationModal() {
            document.getElementById('studentRegistrationModal').classList.add('hidden');
        }

        function showSchoolRegistrationModal() {
            document.getElementById('schoolRegistrationModal').classList.remove('hidden');
        }

        function closeSchoolRegistrationModal() {
            document.getElementById('schoolRegistrationModal').classList.add('hidden');
        }

        function showSchoolLoginModal() {
            document.getElementById('schoolLoginModal').classList.remove('hidden');
        }

        function closeSchoolLoginModal() {
            document.getElementById('schoolLoginModal').classList.add('hidden');
        }

        function showSchoolRegistrationFromLogin() {
            closeSchoolLoginModal();
            showSchoolRegistrationModal();
        }

        function showCompetitionModal() {
            document.getElementById('competitionModal').classList.remove('hidden');
        }

        function closeCompetitionModal() {
            document.getElementById('competitionModal').classList.add('hidden');
        }

        function showSponsorModal() {
            document.getElementById('sponsorModal').classList.remove('hidden');
        }

        function closeSponsorModal() {
            document.getElementById('sponsorModal').classList.add('hidden');
        }

        function showGreenMoverModal() {
            document.getElementById('greenMoverModal').classList.remove('hidden');
        }

        function closeGreenMoverModal() {
            document.getElementById('greenMoverModal').classList.add('hidden');
        }

        function showGreenMoverRankingsModal() {
            document.getElementById('greenMoverRankingsModal').classList.remove('hidden');
        }

        function closeGreenMoverRankingsModal() {
            document.getElementById('greenMoverRankingsModal').classList.add('hidden');
        }

        // Load Green Mover rankings
        function loadGreenMoverRankings() {
            const greenMoverRankingsTableBody = document.getElementById('greenMoverRankingsTableBody');
            if (greenMoverRankingsTableBody) {
                greenMoverRankingsTableBody.innerHTML = '';
                
                greenMoverRankingsData.forEach(mover => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <span class="text-2xl mr-2">${getGreenMoverAwardIcon(mover.award)}</span>
                                <span class="text-lg font-bold text-gray-900">${mover.rank}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${mover.name}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${mover.location}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${mover.submissions}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="text-lg font-bold ${getScoreColor(mover.averageScore)}">${mover.averageScore}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getGreenMoverAwardColor(mover.award)}">
                                ${getGreenMoverAwardIcon(mover.award)} ${getGreenMoverAwardText(mover.award)}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${mover.recognition}
                        </td>
                    `;
                    greenMoverRankingsTableBody.appendChild(row);
                });
            }
        }

        // Toggle school field based on participation type
        function toggleSchoolField() {
            const participationType = document.querySelector('input[name="participationType"]:checked').value;
            const schoolNameField = document.getElementById('schoolNameField');
            const schoolNameInput = document.getElementById('regSchoolName');
            const schoolBenefit = document.getElementById('schoolBenefit');
            const individualBenefit = document.getElementById('individualBenefit');
            
            if (participationType === 'individual') {
                schoolNameField.style.display = 'none';
                schoolNameInput.required = false;
                schoolBenefit.classList.add('hidden');
                individualBenefit.classList.remove('hidden');
            } else {
                schoolNameField.style.display = 'block';
                schoolNameInput.required = true;
                schoolBenefit.classList.remove('hidden');
                individualBenefit.classList.add('hidden');
            }
        }

        // Photo upload and AI processing
        let uploadedPhotos = [];
        let photosVerified = false;
        let contentEnhanced = false;
        let originalContent = '';
        let enhancedContentText = '';
        let contentSafetyPassed = false;
        let photoSafetyPassed = false;
        let violationCount = 0; // Track violation attempts
        
        // Content safety monitoring for positive environment
        const trulyHarmfulKeywords = [
            // Only truly harmful content that could hurt youth
            'è‡ªæ€', 'ä¼¤å®³', 'æš´åŠ›', 'æ¬ºå‡Œ', 'è‰²æƒ…', 'æ¯’å“', 'ä»‡æ¨', 'æ­§è§†',
            'suicide', 'violence', 'bullying', 'pornography', 'drugs', 'hate', 'discrimination'
        ];
        
        const encouragePositiveKeywords = [
            // Encourage positive environmental expressions
            'ç¯ä¿', 'ç»¿è‰²', 'èŠ‚èƒ½', 'å›æ”¶', 'æ¤æ ‘', 'æ¸…æ´', 'ä¿æŠ¤', 'å­¦ä¹ ', 'åˆä½œ', 'å¸®åŠ©', 'ç§æ¤', 'èš¯èš“', 'åœŸå£¤', 'æœ‰æœº',
            'environmental', 'green', 'recycle', 'plant', 'clean', 'protect', 'learn', 'cooperate', 'help', 'organic', 'soil', 'earthworm'
        ];
        
        // Check for truly harmful content only
        function checkForHarmfulContent(content) {
            const lowerContent = content.toLowerCase();
            
            // Only flag truly harmful content
            for (let keyword of trulyHarmfulKeywords) {
                if (lowerContent.includes(keyword.toLowerCase())) {
                    return true;
                }
            }
            
            return false; // Environmental content is always safe
        }
        
        // Show safety warning only for truly harmful content
        function showSafetyWarning() {
            const contentSafetyStatus = document.getElementById('contentSafetyStatus');
            const safetyWarningMessage = document.getElementById('safetyWarningMessage');
            
            safetyWarningMessage.textContent = 'æ£€æµ‹åˆ°å¯èƒ½æœ‰å®³çš„å†…å®¹ï¼Œè¯·ä¿®æ”¹ä¸ºç§¯ææ­£é¢çš„ç¯ä¿ä½“éªŒåˆ†äº«ã€‚';
            contentSafetyStatus.classList.remove('hidden');
        }

        // Real-time content guidance and progressive learning system
        function checkContentSafety(content) {
            const contentSafetyStatus = document.getElementById('contentSafetyStatus');
            const contentSafetyPassedDiv = document.getElementById('contentSafetyPassed');
            const safetyWarningMessage = document.getElementById('safetyWarningMessage');
            
            // Clear previous guidance
            clearPreviousGuidance();
            
            if (content.length < 5) {
                contentSafetyStatus.classList.add('hidden');
                contentSafetyPassedDiv.classList.add('hidden');
                contentSafetyPassed = false;
                updateSubmitButton();
                return;
            }
            
            // First check for truly inappropriate content (very restrictive)
            const hasTrulyInappropriateContent = checkForHarmfulContent(content);
            
            if (hasTrulyInappropriateContent) {
                showSafetyWarning();
                contentSafetyPassed = false;
                updateSubmitButton();
                return;
            }
            
            // If content passes safety check, analyze quality and provide guidance
            const analysisResult = analyzeContentQuality(content);
            
            // Always pass safety check for environmental content
            contentSafetyPassed = true;
            
            if (analysisResult.needsImprovement) {
                showRealTimeGuidance(analysisResult);
            } else {
                showProgressiveFeedback(analysisResult);
            }
            
            updateSubmitButton();
        }
        
        // Simplified content quality analysis - easy pass criteria
        function analyzeContentQuality(content) {
            const result = {
                needsImprovement: false,
                score: 0,
                strengths: [],
                improvements: [],
                specificSuggestions: [],
                level: 'beginner',
                passesBasicRequirements: false
            };
            
            const wordCount = content.length;
            
            // Simple pattern matching for basic requirements
            const hasWhenWhere = /åœ¨.*æ—¶å€™|åœ¨.*åœ°æ–¹|æ˜¨å¤©|ä»Šå¤©|ä¸Šå‘¨|å­¦æ ¡|å®¶é‡Œ|å…¬å›­|åŠå…¬å®¤|ç©ºåœ°|2025å¹´|8æœˆ31æ—¥|æ—¶é—´|åœ°ç‚¹/.test(content);
            const hasWhy = /å› ä¸º|ä¸ºäº†|ç›®çš„|æ„ä¹‰|é‡è¦|è¿™æ ·|ä½¿ç”¨|æ‰ä¼š|é€‚åˆ|åŸå› |åŠ¨æœº/.test(content);
            const hasResult = /ç»“æœ|æ•ˆæœ|å½±å“|æ”¹å˜|æé«˜|å‡å°‘|èŠ‚çº¦|å¥åº·|ä¿æŠ¤|ç”Ÿæ€|æˆæœ|æ”¶è·/.test(content);
            const hasFeeling = /æ„Ÿåˆ°|è§‰å¾—|ä½“ä¼š|å­¦åˆ°|æ”¶è·|å¯å‘|é¼“åŠ±|æ„Ÿæƒ³|æ„Ÿæ‚Ÿ|æƒ³æ³•/.test(content);
            
            // Very generous base scoring - start high
            let score = 50; // High base score
            
            // Basic requirements check (only need 3 out of 4)
            let requirementsMet = 0;
            if (hasWhenWhere) { score += 10; requirementsMet++; }
            if (hasWhy) { score += 10; requirementsMet++; }
            if (hasResult) { score += 10; requirementsMet++; }
            if (hasFeeling) { score += 10; requirementsMet++; }
            
            // Length bonus (very generous)
            if (wordCount >= 30) score += 10;
            if (wordCount >= 50) score += 5;
            
            // Environmental keywords bonus
            const envKeywords = ['ç¯ä¿', 'ç»¿è‰²', 'æœ‰æœº', 'ç§æ¤', 'èš¯èš“', 'åœŸå£¤', 'ç”Ÿæ€', 'å¥åº·', 'ä¿æŠ¤', 'å·¥ä½œåŠ', 'å­¦å‘˜'];
            const foundEnvKeywords = envKeywords.filter(keyword => content.includes(keyword));
            score += foundEnvKeywords.length * 3; // 3 points per environmental keyword
            
            result.score = Math.min(score, 100);
            result.passesBasicRequirements = requirementsMet >= 3 && wordCount >= 30;
            
            // Very lenient pass criteria
            if (result.passesBasicRequirements) {
                result.level = 'passed';
                result.strengths = getPassedFeedback(content, hasWhenWhere, hasWhy, hasResult, hasFeeling);
            } else {
                result.level = 'needs_simple_additions';
                result.needsImprovement = true;
                result.improvements = getSimpleGuidance(content, hasWhenWhere, hasWhy, hasResult, hasFeeling, wordCount);
            }
            
            return result;
        }
        
        // Simple guidance for missing elements
        function getSimpleGuidance(content, hasWhen, hasWhy, hasResult, hasFeeling, wordCount) {
            const guidance = [];
            
            if (wordCount < 30) {
                guidance.push({
                    type: 'length',
                    title: 'ğŸ“ å†…å®¹ç¨çŸ­',
                    suggestion: 'è¯·å†æ·»åŠ ä¸€äº›ç»†èŠ‚ï¼Œè‡³å°‘30å­—å³å¯',
                    example: 'ä¾‹å¦‚ï¼šå¤šè¯´å‡ å¥æ‚¨çš„æ„Ÿå—æˆ–è¡ŒåŠ¨è¿‡ç¨‹'
                });
            }
            
            if (!hasWhen) {
                guidance.push({
                    type: 'missing',
                    title: 'ğŸ“… æ—¶é—´åœ°ç‚¹',
                    suggestion: 'ç®€å•è¯´æ˜ä»€ä¹ˆæ—¶å€™ã€åœ¨å“ªé‡Œ',
                    example: 'ä¾‹å¦‚ï¼š"8æœˆ31æ—¥åœ¨åŠå…¬å®¤æ—è¾¹" æˆ– "æ˜¨å¤©åœ¨å­¦æ ¡"'
                });
            }
            
            if (!hasWhy) {
                guidance.push({
                    type: 'missing',
                    title: 'ğŸ¯ ä¸ºä»€ä¹ˆ',
                    suggestion: 'è¯´æ˜æ‚¨çš„åŠ¨æœºæˆ–ç›®çš„',
                    example: 'ä¾‹å¦‚ï¼š"ä¸ºäº†ä¿æŠ¤åœŸå£¤" æˆ– "å› ä¸ºæƒ³é¼“åŠ±å¤§å®¶ç¯ä¿"'
                });
            }
            
            if (!hasResult) {
                guidance.push({
                    type: 'missing',
                    title: 'ğŸ“Š ç»“æœ',
                    suggestion: 'è¯´æ˜å¾—åˆ°äº†ä»€ä¹ˆç»“æœæˆ–æ•ˆæœ',
                    example: 'ä¾‹å¦‚ï¼š"åœŸå£¤å˜å¾—æ›´å¥åº·" æˆ– "å­¦å‘˜ä»¬å­¦åˆ°äº†çŸ¥è¯†"'
                });
            }
            
            if (!hasFeeling) {
                guidance.push({
                    type: 'missing',
                    title: 'ğŸ’­ æ„Ÿæ‚Ÿ',
                    suggestion: 'åˆ†äº«æ‚¨çš„æ„Ÿå—æˆ–æ”¶è·',
                    example: 'ä¾‹å¦‚ï¼š"æˆ‘å­¦åˆ°äº†..." æˆ– "æˆ‘è§‰å¾—å¾ˆæœ‰æ„ä¹‰"'
                });
            }
            
            return guidance;
        }
        
        // Positive feedback for passed content
        function getPassedFeedback(content, hasWhen, hasWhy, hasResult, hasFeeling) {
            const feedback = [];
            
            feedback.push({
                type: 'strength',
                title: 'âœ… åŸºæœ¬è¦æ±‚å·²æ»¡è¶³',
                message: 'æ‚¨çš„å†…å®¹åŒ…å«äº†æ—¶é—´åœ°ç‚¹ã€åŠ¨æœºã€ç»“æœå’Œæ„Ÿæ‚Ÿç­‰å…³é”®ä¿¡æ¯'
            });
            
            if (hasWhen) {
                feedback.push({
                    type: 'strength',
                    title: 'ğŸ“… æ—¶é—´åœ°ç‚¹æ¸…æ¥š',
                    message: 'å¾ˆå¥½åœ°è¯´æ˜äº†è¡ŒåŠ¨çš„æ—¶é—´å’Œåœ°ç‚¹'
                });
            }
            
            if (hasWhy) {
                feedback.push({
                    type: 'strength',
                    title: 'ğŸ¯ åŠ¨æœºæ˜ç¡®',
                    message: 'æ¸…æ¥šè¡¨è¾¾äº†ç¯ä¿è¡ŒåŠ¨çš„åŸå› å’Œç›®çš„'
                });
            }
            
            if (hasResult) {
                feedback.push({
                    type: 'strength',
                    title: 'ğŸ“Š ç»“æœå…·ä½“',
                    message: 'å¾ˆå¥½åœ°æè¿°äº†è¡ŒåŠ¨å¸¦æ¥çš„æ•ˆæœ'
                });
            }
            
            if (hasFeeling) {
                feedback.push({
                    type: 'strength',
                    title: 'ğŸ’­ æ„Ÿæ‚Ÿæ·±åˆ»',
                    message: 'çœŸè¯šåˆ†äº«äº†ä¸ªäººçš„æ„Ÿå—å’Œæ”¶è·'
                });
            }
            
            return feedback;
        }
        
        // Show real-time guidance
        function showRealTimeGuidance(analysisResult) {
            const contentSafetyStatus = document.getElementById('contentSafetyStatus');
            
            let guidanceHTML = `
                <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-4 mt-3">
                    <div class="flex items-center space-x-2 mb-3">
                        <span class="text-blue-600">ğŸ¯</span>
                        <span class="text-blue-800 font-bold">å®æ—¶å†™ä½œæŒ‡å¯¼ (å½“å‰å¾—åˆ†: ${analysisResult.score}/100)</span>
                    </div>
                    
                    <div class="space-y-3">
            `;
            
            analysisResult.improvements.forEach((improvement, index) => {
                const iconMap = {
                    'missing': 'â—',
                    'enhance': 'â¬†ï¸',
                    'improve': 'âœ¨'
                };
                
                guidanceHTML += `
                    <div class="bg-white rounded-lg p-3 border-l-4 border-blue-400">
                        <div class="flex items-start space-x-2">
                            <span class="text-lg">${iconMap[improvement.type]}</span>
                            <div class="flex-1">
                                <h6 class="font-bold text-blue-800 text-sm">${improvement.title}</h6>
                                <p class="text-blue-700 text-sm mb-2">${improvement.suggestion}</p>
                                <div class="bg-blue-100 p-2 rounded text-xs text-blue-800">
                                    <strong>ğŸ’¡ ç¤ºä¾‹ï¼š</strong>${improvement.example}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            guidanceHTML += `
                    </div>
                    
                    <div class="mt-4 bg-green-100 p-3 rounded-lg">
                        <p class="text-green-800 text-sm font-bold">ğŸš€ å†™ä½œæç¤ºï¼š</p>
                        <p class="text-green-700 text-xs">æŒ‰ç…§ä¸Šè¿°å»ºè®®å®Œå–„å†…å®¹ï¼Œæ‚¨çš„å¾—åˆ†å°†æ˜¾è‘—æé«˜ï¼æ¯æ¬¡æäº¤éƒ½æ˜¯å­¦ä¹ è¿›æ­¥çš„æœºä¼šã€‚</p>
                    </div>
                </div>
            `;
            
            contentSafetyStatus.innerHTML = guidanceHTML;
            contentSafetyStatus.classList.remove('hidden');
        }
        
        // Show progressive feedback for good content
        function showProgressiveFeedback(analysisResult) {
            const contentSafetyPassedDiv = document.getElementById('contentSafetyPassed');
            
            let feedbackHTML = `
                <div class="bg-green-100 border border-green-300 rounded-lg p-4 mt-3">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <span class="text-green-600">ğŸ‰</span>
                            <span class="text-green-700 font-bold">å†…å®¹è´¨é‡ä¼˜ç§€ï¼(å¾—åˆ†: ${analysisResult.score}/100)</span>
                        </div>
                        <button onclick="showAIWritingGuidance()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors">
                            ğŸ¤– AIå†™ä½œæŒ‡å¼•
                        </button>
                    </div>
                    
                    <div class="space-y-2">
            `;
            
            analysisResult.strengths.forEach(strength => {
                feedbackHTML += `
                    <div class="flex items-start space-x-2 text-sm">
                        <span class="text-green-600">${strength.type === 'strength' ? 'âœ…' : 'ğŸŒŸ'}</span>
                        <div>
                            <span class="font-semibold text-green-800">${strength.title}</span>
                            <p class="text-green-700">${strength.message}</p>
                        </div>
                    </div>
                `;
            });
            
            feedbackHTML += `
                    </div>
                    
                    <div class="mt-3 bg-yellow-100 p-3 rounded-lg">
                        <p class="text-yellow-800 text-sm font-bold">ğŸ† ç»§ç»­è¿›æ­¥ï¼š</p>
                        <p class="text-yellow-700 text-xs">æ‚¨çš„è¡¨è¾¾èƒ½åŠ›å¾ˆæ£’ï¼ç‚¹å‡»"AIå†™ä½œæŒ‡å¼•"è·å¾—æ›´ä¸“ä¸šçš„å†™ä½œå»ºè®®ï¼Œè®©æ‚¨çš„æ–‡ç« æ›´åŠ å‡ºè‰²ã€‚</p>
                    </div>
                </div>
            `;
            
            contentSafetyPassedDiv.innerHTML = feedbackHTML;
            contentSafetyPassedDiv.classList.remove('hidden');
        }
        
        // Clear previous guidance
        function clearPreviousGuidance() {
            const contentSafetyStatus = document.getElementById('contentSafetyStatus');
            const contentSafetyPassedDiv = document.getElementById('contentSafetyPassed');
            
            contentSafetyStatus.classList.add('hidden');
            contentSafetyPassedDiv.classList.add('hidden');
        }
        
        // Show gentle guidance for content improvement
        function showContentGuidance() {
            const guidanceOverlay = document.createElement('div');
            guidanceOverlay.className = 'fixed inset-0 bg-blue-500 bg-opacity-80 flex items-center justify-center z-50';
            guidanceOverlay.innerHTML = `
                <div class="bg-white rounded-xl p-8 max-w-lg text-center shadow-2xl border-4 border-blue-400">
                    <div class="text-6xl mb-4">ğŸŒ±</div>
                    <h3 class="text-2xl font-bold text-blue-800 mb-4">å†…å®¹æ”¹è¿›å»ºè®®</h3>
                    <div class="bg-blue-100 p-4 rounded-lg text-sm text-blue-900 mb-4">
                        <p><strong>ğŸ’¡ å»ºè®®ï¼š</strong></p>
                        <p>â€¢ åˆ†äº«æ‚¨çš„çœŸå®ç¯ä¿ä½“éªŒ</p>
                        <p>â€¢ æè¿°å…·ä½“çš„ç¯ä¿è¡ŒåŠ¨</p>
                        <p>â€¢ å±•ç°ç§¯æçš„å­¦ä¹ æ€åº¦</p>
                        <p>â€¢ ç”¨æ­£é¢è¯­è¨€è¡¨è¾¾æƒ³æ³•</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold">
                        å¥½çš„ï¼Œæˆ‘æ¥æ”¹è¿›å†…å®¹
                    </button>
                </div>
            `;
            document.body.appendChild(guidanceOverlay);
        }
        
        // Show positive content suggestions
        function showContentImprovementSuggestions() {
            const suggestionsDiv = document.createElement('div');
            suggestionsDiv.className = 'bg-green-50 border-2 border-green-200 rounded-lg p-4 mt-3';
            suggestionsDiv.id = 'improvementSuggestions';
            
            const suggestions = `
                <h5 class="font-bold text-green-800 mb-2">ğŸ’¡ å†…å®¹æ”¹è¿›å»ºè®®ï¼š</h5>
                <ul class="text-sm text-green-700 space-y-1">
                    <li>â€¢ åˆ†äº«æ‚¨çš„çœŸå®ç¯ä¿ä½“éªŒå’Œæ„Ÿå—</li>
                    <li>â€¢ æè¿°å…·ä½“çš„ç¯ä¿è¡ŒåŠ¨å’Œæˆæœ</li>
                    <li>â€¢ å±•ç°ä»ç¯ä¿æ´»åŠ¨ä¸­è·å¾—çš„å¯å‘</li>
                    <li>â€¢ ç”¨ç§¯ææ­£é¢çš„è¯­è¨€è¡¨è¾¾æƒ³æ³•</li>
                    <li>â€¢ å¼ºè°ƒå›¢é˜Ÿåˆä½œå’Œäº’åŠ©ç²¾ç¥</li>
                </ul>
            `;
            
            suggestionsDiv.innerHTML = suggestions;
            
            // Insert after content safety status
            const contentSafetyStatus = document.getElementById('contentSafetyStatus');
            if (contentSafetyStatus && !document.getElementById('improvementSuggestions')) {
                contentSafetyStatus.parentNode.insertBefore(suggestionsDiv, contentSafetyStatus.nextSibling);
            }
        }
        
        // Show positive reinforcement for good content
        function showPositiveReinforcement(content) {
            // Check for positive environmental keywords
            const foundPositive = encouragePositiveKeywords.filter(keyword => content.includes(keyword));
            
            if (foundPositive.length > 0) {
                const encouragementDiv = document.createElement('div');
                encouragementDiv.className = 'bg-green-50 border-2 border-green-200 rounded-lg p-3 mt-2';
                encouragementDiv.innerHTML = `
                    <div class="flex items-center space-x-2 text-sm">
                        <span class="text-green-600">ğŸŒŸ</span>
                        <span class="text-green-700 font-semibold">å†…å®¹å¾ˆæ£’ï¼</span>
                    </div>
                    <p class="text-xs text-green-600 mt-1">å‘ç°äº†ç§¯æçš„ç¯ä¿å…³é”®è¯ï¼Œç»§ç»­ä¿æŒè¿™ç§æ­£é¢çš„è¡¨è¾¾æ–¹å¼ï¼</p>
                `;
                
                const contentSafetyPassed = document.getElementById('contentSafetyPassed');
                if (contentSafetyPassed && !contentSafetyPassed.querySelector('.bg-green-50')) {
                    contentSafetyPassed.appendChild(encouragementDiv);
                }
                
                // Auto-remove after 3 seconds
                setTimeout(() => {
                    if (encouragementDiv.parentNode) {
                        encouragementDiv.remove();
                    }
                }, 3000);
            }
        }

        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files);
            const photoPreview = document.getElementById('photoPreview');
            const aiPhotoStatus = document.getElementById('aiPhotoStatus');
            const safetyCheckStatus = document.getElementById('safetyCheckStatus');
            const submitButton = document.getElementById('submitButton');
            const category = document.getElementById('category').value;
            
            if (files.length === 0) return;
            
            if (!category) {
                showToast('âš ï¸ è¯·å…ˆé€‰æ‹©ç¯ä¿è¡ŒåŠ¨ç±»åˆ«ï¼Œä»¥ä¾¿AIéªŒè¯ç…§ç‰‡å†…å®¹çš„ç›¸å…³æ€§ï¼');
                document.getElementById('photoUpload').value = '';
                return;
            }
            
            // Show photo previews
            photoPreview.innerHTML = '';
            photoPreview.classList.remove('hidden');
            
            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoDiv = document.createElement('div');
                    photoDiv.className = 'relative bg-gray-100 rounded-lg overflow-hidden';
                    photoDiv.innerHTML = `
                        <img src="${e.target.result}" alt="Photo ${index + 1}" class="w-full h-32 object-cover">
                        <div class="absolute top-2 right-2 bg-white rounded-full p-1">
                            <span class="text-xs text-gray-600">${index + 1}</span>
                        </div>
                    `;
                    photoPreview.appendChild(photoDiv);
                };
                reader.readAsDataURL(file);
            });
            
            uploadedPhotos = files;
            
            // Show AI processing status with enhanced messaging
            aiPhotoStatus.innerHTML = `
                <div class="flex items-center space-x-2 text-sm">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
                    <span class="text-blue-700">AIæ­£åœ¨åˆ†æç…§ç‰‡ï¼šå®‰å…¨æ£€æŸ¥ + è¡ŒåŠ¨è¯æ˜éªŒè¯ + åŸåˆ›æ€§æ£€æµ‹...</span>
                </div>
            `;
            aiPhotoStatus.classList.remove('hidden');
            safetyCheckStatus.classList.add('hidden');
            
            // Enhanced AI photo verification with action evidence detection
            setTimeout(() => {
                // First: Safety check
                const hasInappropriateContent = detectInappropriateImageContent(files);
                
                if (hasInappropriateContent) {
                    handleInappropriateContent();
                    return;
                }
                
                // Second: Action evidence verification
                const actionVerification = verifyActionEvidence(files, category);
                
                if (!actionVerification.hasGenuineAction) {
                    handleInvalidActionEvidence(actionVerification);
                    return;
                }
                
                // Third: Success - both safety and action evidence passed
                handleSuccessfulVerification(actionVerification);
                
            }, 4000); // Longer processing time for thorough analysis
        }
        
        function handleInappropriateContent() {
            violationCount++;
            clearPhotoUpload();
            
            const blockingMessage = createBlockingMessage();
            document.body.appendChild(blockingMessage);
            
            const timeoutDuration = violationCount === 1 ? 3000 : 5000;
            setTimeout(() => {
                if (blockingMessage.parentNode) {
                    blockingMessage.parentNode.removeChild(blockingMessage);
                }
            }, timeoutDuration);
            
            setTimeout(() => {
                if (violationCount === 1) {
                    showToast('ğŸš« è¿è§„å†…å®¹å·²æ¸…é™¤å¹¶è®°å½•ã€‚è¯·é‡æ–°ä¸Šä¼ åˆé€‚çš„ç¯ä¿ç…§ç‰‡ã€‚');
                } else {
                    showToast(`ğŸš¨ ç¬¬${violationCount}æ¬¡è¿è§„ï¼è´¦æˆ·å·²è¢«ä¸¥é‡è­¦å‘Šã€‚å†æ¬¡è¿è§„å°†è¢«æ°¸ä¹…å°ç¦ã€‚`);
                }
            }, timeoutDuration + 500);
        }
        
        function handleInvalidActionEvidence(verification) {
            clearPhotoUpload();
            
            // Show detailed feedback for invalid action evidence
            const feedbackModal = document.createElement('div');
            feedbackModal.className = 'fixed inset-0 bg-orange-600 bg-opacity-90 flex items-center justify-center z-50';
            feedbackModal.innerHTML = `
                <div class="bg-white rounded-xl p-8 max-w-lg text-center shadow-2xl border-4 border-orange-400">
                    <div class="text-6xl mb-4">ğŸ“¸</div>
                    <h3 class="text-2xl font-bold text-orange-800 mb-4">è¡ŒåŠ¨è¯æ˜ä¸è¶³</h3>
                    <div class="bg-orange-100 p-4 rounded-lg text-sm text-orange-900 mb-4">
                        <p class="font-bold mb-2">ğŸ” AIæ£€æµ‹ç»“æœï¼š</p>
                        ${verification.issues.map(issue => `<p class="mb-1">â€¢ ${issue}</p>`).join('')}
                    </div>
                    <div class="bg-blue-100 p-4 rounded-lg text-sm text-blue-900 mb-4">
                        <p class="font-bold mb-2">ğŸ’¡ æ”¹è¿›å»ºè®®ï¼š</p>
                        ${verification.suggestions.map(suggestion => `<p class="mb-1">â€¢ ${suggestion}</p>`).join('')}
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg text-sm text-green-800 mb-4">
                        <p class="font-bold">âœ… æœ‰æ•ˆè¡ŒåŠ¨è¯æ˜åº”åŒ…å«ï¼š</p>
                        <p>â€¢ æ‚¨æœ¬äººæˆ–å›¢é˜Ÿæ­£åœ¨è¿›è¡Œç¯ä¿æ´»åŠ¨</p>
                        <p>â€¢ æ¸…æ™°çš„è¡ŒåŠ¨è¿‡ç¨‹æˆ–å·¥å…·ä½¿ç”¨</p>
                        <p>â€¢ ä¸æ‰€é€‰ç±»åˆ«ç›¸ç¬¦çš„å…·ä½“è¡ŒåŠ¨</p>
                        <p>â€¢ åŸåˆ›æ‹æ‘„ï¼Œéç½‘ç»œä¸‹è½½å›¾ç‰‡</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg font-semibold">
                        æˆ‘æ˜ç™½äº†ï¼Œé‡æ–°ä¸Šä¼ è¡ŒåŠ¨ç…§ç‰‡
                    </button>
                </div>
            `;
            
            document.body.appendChild(feedbackModal);
            
            // Auto-remove after 8 seconds
            setTimeout(() => {
                if (feedbackModal.parentNode) {
                    feedbackModal.parentNode.removeChild(feedbackModal);
                }
            }, 8000);
            
            showToast('ğŸ“¸ è¯·ä¸Šä¼ æ˜¾ç¤ºçœŸå®ç¯ä¿è¡ŒåŠ¨è¿‡ç¨‹çš„ç…§ç‰‡ï¼Œè€Œéé£æ™¯æˆ–æ— å…³å›¾ç‰‡ï¼');
        }
        
        function handleSuccessfulVerification(verification) {
            const safetyCheckStatus = document.getElementById('safetyCheckStatus');
            const aiPhotoStatus = document.getElementById('aiPhotoStatus');
            
            // Show comprehensive success status
            safetyCheckStatus.innerHTML = `
                <div class="bg-green-100 border border-green-300 rounded-lg p-4 mt-3">
                    <div class="flex items-center space-x-2 text-sm mb-2">
                        <span class="text-green-600">ğŸ›¡ï¸</span>
                        <span class="text-green-700 font-semibold">å†…å®¹å®‰å…¨æ£€æŸ¥ï¼šé€šè¿‡</span>
                    </div>
                    <div class="flex items-center space-x-2 text-sm mb-2">
                        <span class="text-green-600">ğŸ¯</span>
                        <span class="text-green-700 font-semibold">è¡ŒåŠ¨è¯æ˜éªŒè¯ï¼š${verification.actionType}</span>
                    </div>
                    <div class="flex items-center space-x-2 text-sm">
                        <span class="text-green-600">â­</span>
                        <span class="text-green-700 font-semibold">è¯æ®è´¨é‡è¯„åˆ†ï¼š${verification.evidenceQuality}/100</span>
                    </div>
                    <p class="text-xs text-green-600 mt-2">âœ… æ£€æµ‹åˆ°çœŸå®ç¯ä¿è¡ŒåŠ¨è¯æ®ï¼Œé€‚åˆé’å°‘å¹´ç¤¾åŒºåˆ†äº«</p>
                </div>
            `;
            safetyCheckStatus.classList.remove('hidden');
            
            setTimeout(() => {
                aiPhotoStatus.innerHTML = `
                    <div class="flex items-center space-x-2 text-sm">
                        <span class="text-green-600">âœ…</span>
                        <span class="text-green-700">ç…§ç‰‡éªŒè¯å®Œæˆï¼šçœŸå®è¡ŒåŠ¨è¯æ® + åŸåˆ›å†…å®¹ + å®‰å…¨åˆè§„</span>
                    </div>
                `;
                photosVerified = true;
                photoSafetyPassed = true;
                updateSubmitButton();
                
                // Show positive reinforcement
                showToast(`ğŸ‰ å¤ªæ£’äº†ï¼AIè¯†åˆ«åˆ°æ‚¨çš„${verification.actionType}ï¼Œè¯æ®è´¨é‡${verification.evidenceQuality}åˆ†ï¼`);
            }, 1000);
        }
        
        function clearPhotoUpload() {
            const photoPreview = document.getElementById('photoPreview');
            const aiPhotoStatus = document.getElementById('aiPhotoStatus');
            const safetyCheckStatus = document.getElementById('safetyCheckStatus');
            
            photoPreview.innerHTML = '';
            photoPreview.classList.add('hidden');
            aiPhotoStatus.classList.add('hidden');
            safetyCheckStatus.classList.add('hidden');
            
            document.getElementById('photoUpload').value = '';
            uploadedPhotos = [];
            photosVerified = false;
            photoSafetyPassed = false;
            updateSubmitButton();
        }
        
        function createBlockingMessage() {
            const blockingMessage = document.createElement('div');
            blockingMessage.className = 'fixed inset-0 bg-red-600 bg-opacity-95 flex items-center justify-center z-50';
            
            if (violationCount === 1) {
                blockingMessage.innerHTML = `
                    <div class="bg-white rounded-xl p-8 max-w-md text-center shadow-2xl">
                        <div class="text-6xl mb-4">ğŸš«</div>
                        <h3 class="text-2xl font-bold text-red-800 mb-4">å†…å®¹å·²è¢«é˜»æ­¢</h3>
                        <p class="text-red-700 mb-4">æ£€æµ‹åˆ°ä¸å½“å†…å®¹ï¼Œå·²ç«‹å³æ¸…é™¤</p>
                        <div class="bg-red-100 p-3 rounded-lg text-sm text-red-800">
                            <p><strong>âš ï¸ ç¬¬ä¸€æ¬¡è¿è§„ - è­¦å‘Š</strong></p>
                            <p>è¯·ä¸Šä¼ åˆé€‚çš„ç¯ä¿ç…§ç‰‡</p>
                        </div>
                        <div class="mt-4 text-xs text-gray-500">
                            æ­¤æ¶ˆæ¯å°†åœ¨ 3 ç§’åæ¶ˆå¤±
                        </div>
                    </div>
                `;
            } else {
                blockingMessage.innerHTML = `
                    <div class="bg-white rounded-xl p-8 max-w-md text-center shadow-2xl border-4 border-red-600">
                        <div class="text-6xl mb-4">ğŸš¨</div>
                        <h3 class="text-2xl font-bold text-red-800 mb-4">ä¸¥é‡è¿è§„è­¦å‘Š</h3>
                        <p class="text-red-700 mb-4 font-bold">ç¬¬${violationCount}æ¬¡è¿è§„æ£€æµ‹</p>
                        <div class="bg-red-200 p-4 rounded-lg text-sm text-red-900 mb-4">
                            <p><strong>ğŸš¨ ç«‹å³åæœï¼š</strong></p>
                            <p>â€¢ è´¦æˆ·å·²è¢«æ ‡è®°</p>
                            <p>â€¢ è¿è§„è®°å½•æ°¸ä¹…ä¿å­˜</p>
                            <p>â€¢ ä¸‹æ¬¡è¿è§„å°†è¢«æ°¸ä¹…å°ç¦</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-lg text-sm text-yellow-800">
                            <p><strong>âš ï¸ æœ€åè­¦å‘Š</strong></p>
                            <p>è¯·ç«‹å³åœæ­¢ä¸Šä¼ ä¸å½“å†…å®¹</p>
                        </div>
                        <div class="mt-4 text-xs text-gray-500">
                            æ­¤æ¶ˆæ¯å°†åœ¨ 5 ç§’åæ¶ˆå¤±
                        </div>
                    </div>
                `;
            }
            
            return blockingMessage;
        }
        
        // Enhanced AI Action Evidence Detection System
        function detectInappropriateImageContent(files) {
            // Advanced AI system to detect genuine environmental action evidence
            
            for (let file of files) {
                const fileName = file.name.toLowerCase();
                
                // Check for obvious inappropriate filenames
                const inappropriatePatterns = [
                    'nude', 'naked', 'sex', 'porn', 'explicit', 'nsfw', 'adult', 'xxx',
                    'è£¸', 'è‰²æƒ…', 'æ€§', 'æˆäºº', 'ä¸é›…', 'æš´éœ²'
                ];
                
                for (let pattern of inappropriatePatterns) {
                    if (fileName.includes(pattern)) {
                        return true; // Definitely inappropriate
                    }
                }
                
                // Simulate AI detection - in demo, randomly flag some uploads as inappropriate
                // In real app, this would be actual AI image analysis
                // Higher detection rate for repeat attempts
                const detectionRate = violationCount >= 1 ? 0.6 : 0.3; // 60% for repeat, 30% for first
                if (Math.random() < detectionRate) {
                    return true;
                }
            }
            
            return false; // Content appears appropriate
        }

        // Advanced AI Action Evidence Verification System
        function verifyActionEvidence(files, category) {
            // Simulate advanced AI analysis for genuine environmental action evidence
            const results = {
                hasGenuineAction: false,
                actionType: '',
                evidenceQuality: 0,
                issues: [],
                suggestions: []
            };
            
            // Simulate AI detection based on category and file analysis
            const actionIndicators = getActionIndicators(category);
            const detectionScore = Math.random();
            
            // Check for landscape/scenery photos (no action evidence)
            if (detectionScore < 0.2) {
                results.issues.push('ä»…é£æ™¯ç…§ç‰‡ï¼Œæœªå‘ç°ç¯ä¿è¡ŒåŠ¨è¯æ®');
                results.suggestions.push('è¯·ä¸Šä¼ æ˜¾ç¤ºæ‚¨å®é™…å‚ä¸ç¯ä¿è¡ŒåŠ¨çš„ç…§ç‰‡');
                return results;
            }
            
            // Check for stock photos or generic images
            if (detectionScore < 0.3) {
                results.issues.push('ç–‘ä¼¼ç½‘ç»œå›¾ç‰‡æˆ–éåŸåˆ›å†…å®¹');
                results.suggestions.push('è¯·ä¸Šä¼ æ‚¨äº²è‡ªæ‹æ‘„çš„è¡ŒåŠ¨ç…§ç‰‡');
                return results;
            }
            
            // Check for irrelevant content
            if (detectionScore < 0.4) {
                results.issues.push('ç…§ç‰‡å†…å®¹ä¸æ‰€é€‰ç¯ä¿ç±»åˆ«ä¸ç¬¦');
                results.suggestions.push(`è¯·ä¸Šä¼ ä¸"${category}"ç›¸å…³çš„è¡ŒåŠ¨è¯æ˜ç…§ç‰‡`);
                return results;
            }
            
            // Check for lack of human action evidence
            if (detectionScore < 0.5) {
                results.issues.push('æœªå‘ç°äººå‘˜å‚ä¸ç¯ä¿è¡ŒåŠ¨çš„è¯æ®');
                results.suggestions.push('è¯·ç¡®ä¿ç…§ç‰‡ä¸­æ˜¾ç¤ºæ‚¨æˆ–å›¢é˜Ÿæ­£åœ¨è¿›è¡Œç¯ä¿æ´»åŠ¨');
                return results;
            }
            
            // Genuine action detected
            results.hasGenuineAction = true;
            results.actionType = actionIndicators.type;
            results.evidenceQuality = Math.floor(detectionScore * 100);
            
            return results;
        }
        
        function getActionIndicators(category) {
            const indicators = {
                'recycling': {
                    type: 'åºŸç‰©åˆ†ç±»å›æ”¶è¡ŒåŠ¨',
                    required: ['åˆ†ç±»åƒåœ¾æ¡¶', 'å›æ”¶ææ–™', 'åˆ†æ‹£è¿‡ç¨‹', 'äººå‘˜æ“ä½œ'],
                    forbidden: ['çº¯é£æ™¯', 'æ— äººåœºæ™¯', 'ç½‘ç»œå›¾ç‰‡']
                },
                'planting': {
                    type: 'æ¤æ ‘ç§æ¤è¡ŒåŠ¨',
                    required: ['ç§æ¤å·¥å…·', 'å¹¼è‹—æ¤ç‰©', 'æŒ–åœŸè¿‡ç¨‹', 'æµ‡æ°´æŠ¤ç†'],
                    forbidden: ['æˆç†Ÿæ ‘æœ¨', 'å…¬å›­é£æ™¯', 'æ— è¡ŒåŠ¨è¯æ®']
                },
                'cleanup': {
                    type: 'ç¯å¢ƒæ¸…æ´è¡ŒåŠ¨',
                    required: ['æ¸…æ´å·¥å…·', 'åƒåœ¾æ”¶é›†', 'æ¸…ç†è¿‡ç¨‹', 'å‰åå¯¹æ¯”'],
                    forbidden: ['å¹²å‡€ç¯å¢ƒ', 'æ— åƒåœ¾åœºæ™¯', 'çº¯é£æ™¯ç…§']
                },
                'conservation': {
                    type: 'èŠ‚èƒ½èŠ‚æ°´è¡ŒåŠ¨',
                    required: ['èŠ‚èƒ½è®¾å¤‡', 'ç›‘æµ‹ä»ªè¡¨', 'æ”¹è¿›æªæ–½', 'æ•°æ®è®°å½•'],
                    forbidden: ['æ™®é€šç”µå™¨', 'æ— æ”¹è¿›è¯æ®', 'é™æ€å±•ç¤º']
                },
                'transport': {
                    type: 'ç»¿è‰²å‡ºè¡Œè¡ŒåŠ¨',
                    required: ['ç¯ä¿äº¤é€šå·¥å…·', 'å‡ºè¡Œè®°å½•', 'å›¢é˜Ÿå‚ä¸', 'è·¯çº¿è¯æ˜'],
                    forbidden: ['æ™®é€šäº¤é€š', 'æ— ç¯ä¿å…ƒç´ ', 'å•çº¯å±•ç¤º']
                },
                'education': {
                    type: 'ç¯ä¿æ•™è‚²è¡ŒåŠ¨',
                    required: ['æ•™è‚²ææ–™', 'å­¦ä¹ è¿‡ç¨‹', 'äº’åŠ¨åœºæ™¯', 'çŸ¥è¯†åˆ†äº«'],
                    forbidden: ['çº¯æ–‡å­—ææ–™', 'æ— äº’åŠ¨è¯æ®', 'é™æ€å±•ç¤º']
                },
                'innovation': {
                    type: 'ç”Ÿæ€åˆ›æ–°é¡¹ç›®',
                    required: ['åˆ›æ–°äº§å“', 'åˆ¶ä½œè¿‡ç¨‹', 'åŠŸèƒ½æ¼”ç¤º', 'æ•ˆæœå±•ç¤º'],
                    forbidden: ['ç°æˆäº§å“', 'æ— åˆ›æ–°å…ƒç´ ', 'çº¯ç†è®ºå±•ç¤º']
                }
            };
            
            return indicators[category] || indicators['cleanup'];
        }

        function updateSubmitButton() {
            const submitButton = document.getElementById('submitButton');
            const content = document.getElementById('content').value;
            
            // Check all safety requirements
            if (!photosVerified || !photoSafetyPassed) {
                submitButton.disabled = true;
                submitButton.className = 'w-full bg-gray-400 text-white py-3 px-6 rounded-lg font-semibold cursor-not-allowed';
                submitButton.textContent = 'è¯·å…ˆä¸Šä¼ å¹¶éªŒè¯ç…§ç‰‡';
                return;
            }
            
            // If photos are verified but no content yet
            if (photosVerified && photoSafetyPassed && content.length < 10) {
                submitButton.disabled = false;
                submitButton.className = 'w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold';
                submitButton.textContent = 'ğŸ“ è¯·å¡«å†™ä½“éªŒæè¿°åæäº¤';
                return;
            }
            
            // If content has safety issues
            if (content.length > 10 && !contentSafetyPassed) {
                submitButton.disabled = true;
                submitButton.className = 'w-full bg-red-400 text-white py-3 px-6 rounded-lg font-semibold cursor-not-allowed';
                submitButton.textContent = 'å†…å®¹å®‰å…¨æ£€æŸ¥æœªé€šè¿‡ - è¯·ä¿®æ”¹';
                return;
            }
            
            // Ready to submit - photos verified and content is good
            if (photosVerified && photoSafetyPassed && content.length >= 10) {
                submitButton.disabled = false;
                submitButton.className = 'w-full bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-semibold';
                submitButton.textContent = 'ğŸŒ± æäº¤ç»¿è‰²è¡ŒåŠ¨ä½“éªŒ';
            }
        }

        // Monitor content changes
        document.addEventListener('DOMContentLoaded', function() {
            const contentTextarea = document.getElementById('content');
            if (contentTextarea) {
                contentTextarea.addEventListener('input', function() {
                    updateSubmitButton();
                });
            }
        });

        function processContentWithAI() {
            const content = document.getElementById('content').value;
            const aiEnhancementSection = document.getElementById('aiEnhancementSection');
            const aiProcessing = document.getElementById('aiProcessing');
            const enhancedContent = document.getElementById('enhancedContent');
            const enhancedText = document.getElementById('enhancedText');
            
            originalContent = content;
            aiEnhancementSection.classList.remove('hidden');
            aiProcessing.classList.remove('hidden');
            enhancedContent.classList.add('hidden');
            
            // Simulate AI content enhancement with grammar correction
            setTimeout(() => {
                // Generate enhanced content with grammar fixes
                enhancedContentText = generateGrammarCorrectedContent(content);
                
                aiProcessing.classList.add('hidden');
                enhancedContent.classList.remove('hidden');
                enhancedText.innerHTML = enhancedContentText;
                
                // Add keyboard listener for Enter key
                document.addEventListener('keydown', handleEnterKey);
            }, 2000); // Reduced from 4000 to 2000ms for faster processing
        }

        function generateGrammarCorrectedContent(original) {
            // Simulate AI grammar correction and light enhancement
            let corrected = original;
            
            // Basic grammar corrections (simulation)
            corrected = corrected.replace(/ï¼Œï¼Œ/g, 'ï¼Œ'); // Remove double commas
            corrected = corrected.replace(/ã€‚ã€‚/g, 'ã€‚'); // Remove double periods
            corrected = corrected.replace(/\s+/g, ' '); // Clean up extra spaces
            corrected = corrected.replace(/([ã€‚ï¼ï¼Ÿ])([^"ã€ã€])/g, '$1 $2'); // Add space after punctuation
            
            // Add proper sentence structure if missing
            if (!corrected.endsWith('ã€‚') && !corrected.endsWith('ï¼') && !corrected.endsWith('ï¼Ÿ')) {
                corrected += 'ã€‚';
            }
            
            // Simple enhancements while keeping original meaning
            corrected = corrected.replace(/æˆ‘åšäº†/g, 'æˆ‘å‚ä¸äº†');
            corrected = corrected.replace(/å¾ˆå¥½/g, 'éå¸¸æœ‰æ„ä¹‰');
            corrected = corrected.replace(/å­¦åˆ°äº†/g, 'æ·±åˆ»å­¦ä¹ åˆ°äº†');
            
            const enhanced = `
                <div class="bg-white rounded-lg p-4 border border-gray-200">
                    <h4 class="font-bold text-gray-800 mb-3">ğŸ¤– AIè¯­æ³•ä¿®æ­£ç‰ˆæœ¬ï¼š</h4>
                    <div class="text-gray-800 leading-relaxed mb-4" style="line-height: 1.8;">
                        ${corrected}
                    </div>
                    
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <p class="text-sm text-blue-800"><strong>âœ¨ AIä¿®æ­£å†…å®¹ï¼š</strong></p>
                        <ul class="text-xs text-blue-700 mt-1 space-y-1">
                            <li>â€¢ ä¿®æ­£äº†è¯­æ³•å’Œæ ‡ç‚¹ç¬¦å·</li>
                            <li>â€¢ ä¼˜åŒ–äº†å¥å­ç»“æ„å’Œæµç•…åº¦</li>
                            <li>â€¢ ä¿æŒäº†æ‚¨çš„åŸå§‹æ„æ€å’ŒçœŸå®æ„Ÿå—</li>
                            <li>â€¢ è®©è¡¨è¾¾æ›´åŠ æ¸…æ™°å’Œä¸“ä¸š</li>
                        </ul>
                    </div>
                </div>
            `;
            return enhanced;
        }

        function handleEnterKey(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                acceptEnhancement();
            }
        }

        function acceptEnhancement() {
            const contentTextarea = document.getElementById('content');
            
            // Extract the corrected text from the enhanced content
            let corrected = originalContent;
            
            // Apply the same corrections as in generateGrammarCorrectedContent
            corrected = corrected.replace(/ï¼Œï¼Œ/g, 'ï¼Œ');
            corrected = corrected.replace(/ã€‚ã€‚/g, 'ã€‚');
            corrected = corrected.replace(/\s+/g, ' ');
            corrected = corrected.replace(/([ã€‚ï¼ï¼Ÿ])([^"ã€ã€])/g, '$1 $2');
            
            if (!corrected.endsWith('ã€‚') && !corrected.endsWith('ï¼') && !corrected.endsWith('ï¼Ÿ')) {
                corrected += 'ã€‚';
            }
            
            corrected = corrected.replace(/æˆ‘åšäº†/g, 'æˆ‘å‚ä¸äº†');
            corrected = corrected.replace(/å¾ˆå¥½/g, 'éå¸¸æœ‰æ„ä¹‰');
            corrected = corrected.replace(/å­¦åˆ°äº†/g, 'æ·±åˆ»å­¦ä¹ åˆ°äº†');
            
            // Replace the textarea content with corrected version
            contentTextarea.value = corrected;
            contentEnhanced = true;
            
            document.getElementById('aiEnhancementSection').classList.add('hidden');
            document.removeEventListener('keydown', handleEnterKey);
            updateSubmitButton();
            
            showToast('âœ¨ AIè¯­æ³•ä¿®æ­£å·²åº”ç”¨ï¼æ‚¨çš„å†…å®¹ç°åœ¨æ›´åŠ æ¸…æ™°æµç•…ã€‚');
        }

        function rejectEnhancement() {
            contentEnhanced = false;
            document.getElementById('aiEnhancementSection').classList.add('hidden');
            document.removeEventListener('keydown', handleEnterKey);
            updateSubmitButton();
            
            showToast('Original content kept. Your submission is ready as written.');
        }

        // AIå†™ä½œæŒ‡å¼•åŠŸèƒ½
        function showAIWritingGuidance() {
            const currentContent = document.getElementById('content').value;
            const category = document.getElementById('category').value;
            
            // åˆ›å»ºAIå†™ä½œæŒ‡å¼•æ¨¡æ€æ¡†
            const guidanceModal = document.createElement('div');
            guidanceModal.className = 'fixed inset-0 bg-blue-600 bg-opacity-90 flex items-center justify-center z-50';
            guidanceModal.id = 'aiWritingGuidanceModal';
            
            const enhancedSuggestions = generateAdvancedWritingSuggestions(currentContent, category);
            
            guidanceModal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full p-8 max-h-[90vh] overflow-y-auto mx-4">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-blue-800">ğŸ¤– AIä¸“ä¸šå†™ä½œæŒ‡å¼•</h3>
                        <button onclick="closeAIWritingGuidance()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- å½“å‰å†…å®¹åˆ†æ -->
                        <div class="bg-green-50 rounded-lg p-6">
                            <h4 class="font-bold text-green-800 mb-4">ğŸ“Š å½“å‰å†…å®¹åˆ†æ</h4>
                            <div class="space-y-3">
                                ${enhancedSuggestions.currentAnalysis}
                            </div>
                        </div>
                        
                        <!-- ä¸“ä¸šå†™ä½œå»ºè®® -->
                        <div class="bg-blue-50 rounded-lg p-6">
                            <h4 class="font-bold text-blue-800 mb-4">âœ¨ ä¸“ä¸šå†™ä½œå»ºè®®</h4>
                            <div class="space-y-3">
                                ${enhancedSuggestions.writingTips}
                            </div>
                        </div>
                    </div>
                    
                    <!-- ä¼˜åŒ–ç‰ˆæœ¬ç”Ÿæˆ -->
                    <div class="mt-6 bg-purple-50 rounded-lg p-6">
                        <h4 class="font-bold text-purple-800 mb-4">ğŸš€ AIä¼˜åŒ–ç‰ˆæœ¬</h4>
                        <div class="bg-white rounded-lg p-4 border-2 border-purple-200 mb-4">
                            <div class="text-gray-800 leading-relaxed" style="line-height: 1.8;">
                                ${enhancedSuggestions.optimizedVersion}
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-3">
                            <button onclick="applyOptimizedVersion()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold">
                                âœ… ä½¿ç”¨AIä¼˜åŒ–ç‰ˆæœ¬
                            </button>
                            <button onclick="showWritingTechniques()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold">
                                ğŸ“š å­¦ä¹ å†™ä½œæŠ€å·§
                            </button>
                            <button onclick="generateAlternativeVersion()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold">
                                ğŸ”„ ç”Ÿæˆå…¶ä»–ç‰ˆæœ¬
                            </button>
                            <button onclick="closeAIWritingGuidance()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold">
                                ğŸ“ ç»§ç»­è‡ªå·±å†™ä½œ
                            </button>
                        </div>
                    </div>
                    
                    <!-- å†™ä½œæŠ€å·§å­¦ä¹ åŒºåŸŸ -->
                    <div id="writingTechniquesSection" class="hidden mt-6 bg-yellow-50 rounded-lg p-6">
                        <h4 class="font-bold text-yellow-800 mb-4">ğŸ“– ç¯ä¿å†™ä½œæŠ€å·§å¤§å…¨</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${enhancedSuggestions.writingTechniques}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(guidanceModal);
            
            // å­˜å‚¨ä¼˜åŒ–ç‰ˆæœ¬ä»¥ä¾›åç»­ä½¿ç”¨
            window.currentOptimizedContent = enhancedSuggestions.optimizedContent;
        }
        
        function generateAdvancedWritingSuggestions(content, category) {
            // æ·±åº¦åˆ†æå½“å‰å†…å®¹
            const wordCount = content.length;
            const sentences = content.split(/[ã€‚ï¼ï¼Ÿ]/).filter(s => s.trim().length > 0);
            const hasEmotionalWords = /æ„ŸåŠ¨|æ¿€åŠ¨|å…´å¥‹|å¼€å¿ƒ|æ»¡è¶³|è‡ªè±ª|æ„Ÿæ¿€|æ¸©æš–|å¸Œæœ›/.test(content);
            const hasSpecificDetails = /\d+|å…·ä½“|è¯¦ç»†|æ¸…æ¥š|æ˜ç¡®/.test(content);
            const hasTeamwork = /ä¸€èµ·|åˆä½œ|å¸®åŠ©|åä½œ|å›¢é˜Ÿ|åŒå­¦|æœ‹å‹|å¤§å®¶/.test(content);
            
            // å½“å‰å†…å®¹åˆ†æ
            const currentAnalysis = `
                <div class="bg-white p-3 rounded border-l-4 border-green-400">
                    <p class="font-semibold text-green-800">ğŸ“ å†…å®¹é•¿åº¦ï¼š${wordCount}å­— (${wordCount >= 50 ? 'âœ… å……è¶³' : 'âš ï¸ å¯ä»¥æ›´è¯¦ç»†'})</p>
                    <p class="text-green-700 text-sm">å¥å­æ•°é‡ï¼š${sentences.length}å¥</p>
                </div>
                <div class="bg-white p-3 rounded border-l-4 border-blue-400">
                    <p class="font-semibold text-blue-800">ğŸ’­ æƒ…æ„Ÿè¡¨è¾¾ï¼š${hasEmotionalWords ? 'âœ… ä¸°å¯Œ' : 'ğŸ’¡ å¯ä»¥å¢åŠ '}</p>
                    <p class="text-blue-700 text-sm">${hasEmotionalWords ? 'å¾ˆå¥½åœ°è¡¨è¾¾äº†å†…å¿ƒæ„Ÿå—' : 'å»ºè®®åŠ å…¥æ›´å¤šæƒ…æ„Ÿè¯æ±‡'}</p>
                </div>
                <div class="bg-white p-3 rounded border-l-4 border-purple-400">
                    <p class="font-semibold text-purple-800">ğŸ” å…·ä½“ç»†èŠ‚ï¼š${hasSpecificDetails ? 'âœ… è¯¦ç»†' : 'ğŸ’¡ éœ€è¦æ›´å…·ä½“'}</p>
                    <p class="text-purple-700 text-sm">${hasSpecificDetails ? 'åŒ…å«äº†å…·ä½“çš„ç»†èŠ‚æè¿°' : 'å¯ä»¥æ·»åŠ æ•°å­—ã€æ—¶é—´ç­‰å…·ä½“ä¿¡æ¯'}</p>
                </div>
                <div class="bg-white p-3 rounded border-l-4 border-orange-400">
                    <p class="font-semibold text-orange-800">ğŸ¤ å›¢é˜Ÿåˆä½œï¼š${hasTeamwork ? 'âœ… ä½“ç°' : 'ğŸ’¡ å¯ä»¥å¼ºè°ƒ'}</p>
                    <p class="text-orange-700 text-sm">${hasTeamwork ? 'å¾ˆå¥½åœ°å±•ç°äº†åˆä½œç²¾ç¥' : 'å»ºè®®æè¿°ä¸ä»–äººçš„äº’åŠ¨åˆä½œ'}</p>
                </div>
            `;
            
            // ä¸“ä¸šå†™ä½œå»ºè®®
            const writingTips = `
                <div class="bg-white p-3 rounded border-l-4 border-blue-400">
                    <h5 class="font-bold text-blue-800">ğŸ¯ å¼€å¤´æŠ€å·§</h5>
                    <p class="text-blue-700 text-sm">ç”¨å…·ä½“çš„æ—¶é—´ã€åœ°ç‚¹ã€å¤©æ°”å¼€å§‹ï¼Œè¥é€ ç”»é¢æ„Ÿ</p>
                </div>
                <div class="bg-white p-3 rounded border-l-4 border-green-400">
                    <h5 class="font-bold text-green-800">ğŸ“– è¿‡ç¨‹æè¿°</h5>
                    <p class="text-green-700 text-sm">æŒ‰æ—¶é—´é¡ºåºï¼Œè¯¦ç»†æè¿°æ¯ä¸ªæ­¥éª¤å’Œæ„Ÿå—</p>
                </div>
                <div class="bg-white p-3 rounded border-l-4 border-purple-400">
                    <h5 class="font-bold text-purple-800">ğŸ’¡ æ„Ÿæ‚Ÿå‡å</h5>
                    <p class="text-purple-700 text-sm">è¿æ¥ä¸ªäººæˆé•¿ä¸ç¯ä¿æ„ä¹‰ï¼Œå±•ç°æ·±åº¦æ€è€ƒ</p>
                </div>
                <div class="bg-white p-3 rounded border-l-4 border-orange-400">
                    <h5 class="font-bold text-orange-800">ğŸŒŸ ç»“å°¾å‘¼åº”</h5>
                    <p class="text-orange-700 text-sm">æ€»ç»“æ”¶è·ï¼Œè¡¨è¾¾å¯¹æœªæ¥ç¯ä¿è¡ŒåŠ¨çš„æœŸå¾…</p>
                </div>
            `;
            
            // ç”Ÿæˆä¼˜åŒ–ç‰ˆæœ¬
            const optimizedContent = generateOptimizedContent(content, category);
            const optimizedVersion = optimizedContent.replace(/\n/g, '<br>');
            
            // å†™ä½œæŠ€å·§å¤§å…¨
            const writingTechniques = `
                <div class="bg-white p-4 rounded-lg">
                    <h5 class="font-bold text-gray-800 mb-2">ğŸ¨ æ„Ÿå®˜æå†™æŠ€å·§</h5>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>â€¢ è§†è§‰ï¼šé¢œè‰²ã€å½¢çŠ¶ã€å¤§å°å˜åŒ–</li>
                        <li>â€¢ å¬è§‰ï¼šå£°éŸ³ã€éŸ³ä¹ã€å¯¹è¯</li>
                        <li>â€¢ è§¦è§‰ï¼šæ¸©åº¦ã€è´¨æ„Ÿã€é‡é‡</li>
                        <li>â€¢ å—…è§‰ï¼šæ°”å‘³çš„å˜åŒ–å’Œæ„Ÿå—</li>
                    </ul>
                </div>
                <div class="bg-white p-4 rounded-lg">
                    <h5 class="font-bold text-gray-800 mb-2">ğŸ’­ æƒ…æ„Ÿè¡¨è¾¾è¯æ±‡</h5>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>â€¢ ç§¯æï¼šå…´å¥‹ã€æ»¡è¶³ã€è‡ªè±ªã€æ„Ÿæ¿€</li>
                        <li>â€¢ æˆé•¿ï¼šå¯å‘ã€é¢†æ‚Ÿã€æ”¶è·ã€è¿›æ­¥</li>
                        <li>â€¢ è´£ä»»ï¼šä½¿å‘½ã€æ‹…å½“ã€å¥‰çŒ®ã€åšæŒ</li>
                        <li>â€¢ å¸Œæœ›ï¼šæœŸå¾…ã€æ†§æ†¬ã€æ¢¦æƒ³ã€æ„¿æ™¯</li>
                    </ul>
                </div>
                <div class="bg-white p-4 rounded-lg">
                    <h5 class="font-bold text-gray-800 mb-2">ğŸ”¢ å…·ä½“åŒ–æŠ€å·§</h5>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>â€¢ æ—¶é—´ï¼šå…·ä½“åˆ°å°æ—¶ã€åˆ†é’Ÿ</li>
                        <li>â€¢ æ•°é‡ï¼šå¤šå°‘äººã€å¤šå°‘ç‰©å“</li>
                        <li>â€¢ å°ºå¯¸ï¼šé•¿åº¦ã€é‡é‡ã€é¢ç§¯</li>
                        <li>â€¢ æ•ˆæœï¼šç™¾åˆ†æ¯”ã€å¯¹æ¯”æ•°æ®</li>
                    </ul>
                </div>
                <div class="bg-white p-4 rounded-lg">
                    <h5 class="font-bold text-gray-800 mb-2">ğŸ¤ åˆä½œæå†™è¦ç‚¹</h5>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>â€¢ åˆ†å·¥ï¼šè°è´Ÿè´£ä»€ä¹ˆä»»åŠ¡</li>
                        <li>â€¢ äº’åŠ©ï¼šç›¸äº’å¸®åŠ©çš„å…·ä½“è¡Œä¸º</li>
                        <li>â€¢ æ²Ÿé€šï¼šå¯¹è¯å’Œäº¤æµè¿‡ç¨‹</li>
                        <li>â€¢ æˆæœï¼šå›¢é˜Ÿåˆä½œçš„æˆå°±æ„Ÿ</li>
                    </ul>
                </div>
            `;
            
            return {
                currentAnalysis,
                writingTips,
                optimizedVersion,
                optimizedContent,
                writingTechniques
            };
        }
        
        function generateOptimizedContent(originalContent, category) {
            // åŸºäºåŸå†…å®¹ç”Ÿæˆæ›´ä¸“ä¸šçš„ä¼˜åŒ–ç‰ˆæœ¬
            const categoryContext = {
                'recycling': 'åºŸç‰©åˆ†ç±»å›æ”¶',
                'planting': 'æ¤æ ‘ç§æ¤',
                'cleanup': 'ç¯å¢ƒæ¸…æ´',
                'conservation': 'èŠ‚èƒ½èŠ‚æ°´',
                'transport': 'ç»¿è‰²å‡ºè¡Œ',
                'education': 'ç¯ä¿æ•™è‚²',
                'innovation': 'ç”Ÿæ€åˆ›æ–°',
                'togetherness': 'åˆä½œå…³æ€€'
            };
            
            const actionType = categoryContext[category] || 'ç¯ä¿è¡ŒåŠ¨';
            
            // ç”Ÿæˆç»“æ„åŒ–çš„ä¼˜åŒ–å†…å®¹
            let optimized = `åœ¨ä¸€ä¸ªé˜³å…‰æ˜åªšçš„å‘¨æœ«ä¸Šåˆï¼Œæˆ‘å‚ä¸äº†ä¸€æ¬¡æ„ä¹‰æ·±åˆ»çš„${actionType}æ´»åŠ¨ã€‚\n\n`;
            
            // ä¿ç•™åŸå†…å®¹çš„æ ¸å¿ƒä¿¡æ¯ï¼Œä½†å¢å¼ºè¡¨è¾¾
            if (originalContent.includes('å­¦æ ¡') || originalContent.includes('åŠå…¬å®¤')) {
                optimized += `æ´»åŠ¨åœ°ç‚¹é€‰åœ¨å­¦æ ¡åŠå…¬å®¤æ—è¾¹çš„ç©ºåœ°ï¼Œè¿™é‡Œå¹³æ—¶äººæµé‡å¤§ï¼Œæ˜¯è¿›è¡Œç¯ä¿æ•™è‚²çš„ç†æƒ³åœºæ‰€ã€‚`;
            } else {
                optimized += `æˆ‘ä»¬é€‰æ‹©äº†ç¤¾åŒºé™„è¿‘çš„ä¸€ä¸ªå¼€æ”¾ç©ºé—´ï¼Œè¿™é‡Œç¯å¢ƒä¼˜ç¾ï¼Œå¾ˆé€‚åˆå¼€å±•${actionType}æ´»åŠ¨ã€‚`;
            }
            
            optimized += `å½“æˆ‘çœ‹åˆ°ç°åœºçš„æƒ…å†µæ—¶ï¼Œå†…å¿ƒæ¶Œèµ·äº†å¼ºçƒˆçš„è´£ä»»æ„Ÿã€‚\n\n`;
            
            // è¿‡ç¨‹æè¿°
            optimized += `æ´»åŠ¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆ†å·¥æ˜ç¡®ï¼Œç›¸äº’é…åˆã€‚æ¯ä¸ªäººéƒ½å…¨èº«å¿ƒæŠ•å…¥ï¼Œè®¤çœŸå¯¹å¾…æ¯ä¸€ä¸ªç»†èŠ‚ã€‚`;
            optimized += `é€šè¿‡å¤§å®¶çš„å…±åŒåŠªåŠ›ï¼Œæˆ‘ä»¬ä¸ä»…å®Œæˆäº†é¢„å®šç›®æ ‡ï¼Œæ›´é‡è¦çš„æ˜¯åœ¨è¿‡ç¨‹ä¸­å­¦ä¼šäº†å›¢é˜Ÿåˆä½œçš„é‡è¦æ€§ã€‚\n\n`;
            
            // ç»“æœå’Œæ„Ÿæ‚Ÿ
            optimized += `çœ‹ç€æ´»åŠ¨å–å¾—çš„æˆæœï¼Œæˆ‘æ·±æ·±æ„Ÿå—åˆ°ç¯ä¿è¡ŒåŠ¨çš„æ„ä¹‰ä¸ä»…åœ¨äºæ”¹å–„ç¯å¢ƒï¼Œæ›´åœ¨äºå”¤é†’æ¯ä¸ªäººå†…å¿ƒçš„ç¯ä¿æ„è¯†ã€‚`;
            optimized += `è¿™æ¬¡ç»å†è®©æˆ‘æ˜ç™½ï¼ŒçœŸæ­£çš„ç¯ä¿ä¸æ˜¯å£å·ï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬ç”¨å®é™…è¡ŒåŠ¨æ¥è¯æ˜çš„è´£ä»»å’Œæ‹…å½“ã€‚\n\n`;
            
            optimized += `æœªæ¥ï¼Œæˆ‘ä¼šç»§ç»­å‚ä¸æ›´å¤šçš„ç¯ä¿æ´»åŠ¨ï¼Œç”¨è‡ªå·±çš„è¡ŒåŠ¨å½±å“èº«è¾¹çš„äººï¼Œä¸ºå»ºè®¾ç¾ä¸½çš„ç”Ÿæ€ç¯å¢ƒè´¡çŒ®è‡ªå·±çš„åŠ›é‡ã€‚`;
            
            return optimized;
        }
        
        function closeAIWritingGuidance() {
            const modal = document.getElementById('aiWritingGuidanceModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function applyOptimizedVersion() {
            const contentTextarea = document.getElementById('content');
            contentTextarea.value = window.currentOptimizedContent;
            
            // é‡æ–°æ£€æŸ¥å†…å®¹å®‰å…¨æ€§
            checkContentSafety(window.currentOptimizedContent);
            
            closeAIWritingGuidance();
            showToast('ğŸ‰ AIä¼˜åŒ–ç‰ˆæœ¬å·²åº”ç”¨ï¼æ‚¨çš„æ–‡ç« ç°åœ¨æ›´åŠ ä¸“ä¸šå’Œç”ŸåŠ¨ã€‚');
        }
        
        function showWritingTechniques() {
            const techniquesSection = document.getElementById('writingTechniquesSection');
            techniquesSection.classList.toggle('hidden');
        }
        
        function generateAlternativeVersion() {
            const category = document.getElementById('category').value;
            const alternativeContent = generateAlternativeOptimizedContent(category);
            
            // æ›´æ–°ä¼˜åŒ–ç‰ˆæœ¬æ˜¾ç¤º
            const optimizedVersionDiv = document.querySelector('#aiWritingGuidanceModal .bg-white.rounded-lg.p-4.border-2.border-purple-200 .text-gray-800');
            if (optimizedVersionDiv) {
                optimizedVersionDiv.innerHTML = alternativeContent.replace(/\n/g, '<br>');
                window.currentOptimizedContent = alternativeContent;
                showToast('ğŸ”„ å·²ç”Ÿæˆæ–°çš„ä¼˜åŒ–ç‰ˆæœ¬ï¼');
            }
        }
        
        function generateAlternativeOptimizedContent(category) {
            const alternatives = {
                'recycling': `æ˜¨å¤©ä¸‹åˆï¼Œæˆ‘å’ŒåŒå­¦ä»¬åœ¨å­¦æ ¡å¼€å±•äº†ä¸€æ¬¡åºŸç‰©åˆ†ç±»å›æ”¶æ´»åŠ¨ã€‚çœ‹åˆ°æ ¡å›­é‡Œæ•£è½çš„å„ç§åƒåœ¾ï¼Œæˆ‘ä»¬å†³å®šç”¨å®é™…è¡ŒåŠ¨æ¥æ”¹å˜è¿™ç§çŠ¶å†µã€‚

æˆ‘ä»¬å‡†å¤‡äº†ä¸åŒé¢œè‰²çš„åƒåœ¾è¢‹å’Œåˆ†ç±»æ ‡ç­¾ï¼Œå¼€å§‹äº†ç»†è‡´çš„åˆ†ç±»å·¥ä½œã€‚å¡‘æ–™ç“¶ã€çº¸å¼ ã€é£Ÿç‰©æ®‹æ¸£ï¼Œæ¯ä¸€æ ·éƒ½è¢«æˆ‘ä»¬è®¤çœŸåœ°åˆ†ç±»å¤„ç†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°åŸæ¥åƒåœ¾åˆ†ç±»éœ€è¦è¿™ä¹ˆå¤šçš„çŸ¥è¯†å’Œè€å¿ƒã€‚

æœ€è®©æˆ‘æ„ŸåŠ¨çš„æ˜¯ï¼Œå½“å…¶ä»–åŒå­¦çœ‹åˆ°æˆ‘ä»¬çš„è¡ŒåŠ¨æ—¶ï¼Œä¹Ÿä¸»åŠ¨åŠ å…¥è¿›æ¥ã€‚å¤§å®¶ä¸€èµ·å·¥ä½œï¼Œä¸€èµ·å­¦ä¹ ï¼Œé‚£ç§å›¢ç»“åˆä½œçš„æ°›å›´è®©æˆ‘æ·±æ·±æ„Ÿå—åˆ°é›†ä½“çš„åŠ›é‡ã€‚

é€šè¿‡è¿™æ¬¡æ´»åŠ¨ï¼Œæˆ‘ä¸ä»…å­¦ä¼šäº†æ­£ç¡®çš„åƒåœ¾åˆ†ç±»æ–¹æ³•ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£äº†ç¯ä¿éœ€è¦æ¯ä¸ªäººçš„å‚ä¸ã€‚å°å°çš„è¡ŒåŠ¨ï¼Œå´èƒ½å¸¦æ¥å¤§å¤§çš„æ”¹å˜ã€‚`,

                'planting': `æ˜¥å¤©çš„æ—©æ™¨ï¼Œç©ºæ°”æ ¼å¤–æ¸…æ–°ã€‚æˆ‘å‚åŠ äº†ç¤¾åŒºç»„ç»‡çš„æ¤æ ‘æ´»åŠ¨ï¼Œå¿ƒæƒ…æ—¢å…´å¥‹åˆç´§å¼ ã€‚

æ‹¿ç€å°æ ‘è‹—å’Œé“é”¹ï¼Œæˆ‘å°å¿ƒç¿¼ç¿¼åœ°æŒ–ç€åœŸå‘ã€‚æ³¥åœŸçš„èŠ¬èŠ³æ··åˆç€æ˜¥å¤©çš„æ°”æ¯ï¼Œè®©æˆ‘æ„Ÿå—åˆ°å¤§è‡ªç„¶çš„ç”Ÿå‘½åŠ›ã€‚å½“æˆ‘æŠŠå°æ ‘è‹—è½»è½»æ”¾å…¥åœŸå‘ï¼Œç”¨åŒæ‰‹ä¸ºå®ƒåŸ¹åœŸæ—¶ï¼Œä»¿ä½›èƒ½æ„Ÿå—åˆ°ç”Ÿå‘½åœ¨æˆ‘æ‰‹ä¸­èŒå‘ã€‚

æ´»åŠ¨ä¸­ï¼Œä¸€ä½è€çˆ·çˆ·æ•™æˆ‘å¦‚ä½•æ­£ç¡®æµ‡æ°´ï¼Œå¦‚ä½•åˆ¤æ–­æ ‘è‹—æ˜¯å¦ç§å¾—ç¨³å›ºã€‚ä»–è¯´ï¼š"ç§æ ‘å°±åƒåŸ¹å…»å­©å­ï¼Œéœ€è¦è€å¿ƒå’Œçˆ±å¿ƒã€‚"è¿™å¥è¯æ·±æ·±å°åœ¨æˆ‘å¿ƒé‡Œã€‚

çœ‹ç€ä¸€æ’æ’æ–°ç§çš„å°æ ‘ï¼Œæˆ‘æƒ³è±¡ç€å®ƒä»¬é•¿å¤§åçš„æ ·å­ã€‚ä¹Ÿè®¸å¤šå¹´åï¼Œè¿™é‡Œä¼šæˆä¸ºä¸€ç‰‡ç»¿è«ï¼Œä¸ºäººä»¬å¸¦æ¥æ¸…æ–°çš„ç©ºæ°”å’Œç¾ä¸½çš„ç¯å¢ƒã€‚`
            };
            
            return alternatives[category] || alternatives['recycling'];
        }

        // Form submission functions
        function submitEcoArticle(event) {
            event.preventDefault();
            
            const content = document.getElementById('content').value;
            
            // Final safety check before submission
            if (!photoSafetyPassed || !contentSafetyPassed) {
                showToast('âš ï¸ æäº¤è¢«é˜»æ­¢ï¼šè¯·ä¿®æ”¹ä¸å½“å†…å®¹åé‡æ–°æäº¤ã€‚');
                return;
            }
            
            // Check if content meets basic requirements
            const analysisResult = analyzeContentQuality(content);
            
            // If content doesn't meet basic requirements, offer AI help
            if (!analysisResult.passesBasicRequirements && !contentEnhanced) {
                showToast('ğŸ’¡ å†…å®¹è¿˜éœ€è¦å®Œå–„ï¼ŒAIå¯ä»¥å¸®æ‚¨ä¿®æ­£è¯­æ³•å¹¶ä¼˜åŒ–è¡¨è¾¾ï¼');
                processContentWithAI();
                return;
            }
            
            // If content is good but not enhanced, offer AI grammar correction
            if (content.length > 30 && !contentEnhanced && !document.getElementById('aiEnhancementSection').classList.contains('hidden') === false) {
                processContentWithAI();
                return;
            }
            
            // AIæ•™è‚²å¼•å¯¼ç³»ç»Ÿ - ç”Ÿæˆæ ‡å‡†ç­”æ¡ˆå’Œå†…å®¹å‡å
            const category = document.getElementById('category').value;
            const studentName = document.getElementById('studentName').value;
            const schoolName = document.getElementById('schoolName').value;
            
            // ç”Ÿæˆæ ‡å‡†ç­”æ¡ˆç¤ºä¾‹
            const standardExample = generateStandardExample(category, content);
            
            // å†…å®¹å‡åå’Œæ•™è‚²æŒ‡å¯¼
            const educationalGuidance = generateEducationalGuidance(content, category);
            
            let successMessage = `ğŸ‰ ç»¿è‰²è¡ŒåŠ¨ä½“éªŒä¸Šä¼ æˆåŠŸï¼

ğŸ“š AIå­¦ä¹ æŒ‡å¯¼ç³»ç»Ÿï¼š

${standardExample}

${educationalGuidance}

âœ… æäº¤çŠ¶æ€ï¼šé€šè¿‡ - å·²è®°å½•æ‚¨çš„ç¯ä¿å‚ä¸
ğŸ“ å­¦ä¹ æˆæœï¼šè§‚å¯Ÿä½“éªŒèƒ½åŠ›æå‡
ğŸŒ± ç¯ä¿æ„è¯†ï¼šæŒç»­æˆé•¿ä¸­

ğŸ« å­¦æ ¡å‚ä¸ç»Ÿè®¡å·²æ›´æ–°ï¼š${schoolName || 'ä¸ªäººå‚ä¸è€…'}`;

            // æ£€æŸ¥5å¤§ç»¿è‰²è¡ŒåŠ¨çš„å¤šæ ·æ€§å‚ä¸
            const diversityMessage = checkGreenActionDiversity(schoolName, category);
            if (diversityMessage) {
                successMessage += `\n\n${diversityMessage}`;
            }
            
            showToast(successMessage);
            closeEcoSubmissionModal();
            
            // Reset form state
            uploadedPhotos = [];
            photosVerified = false;
            contentEnhanced = false;
            originalContent = '';
            enhancedContentText = '';
            contentSafetyPassed = false;
            photoSafetyPassed = false;
        }

        function submitStudentRegistration(event) {
            event.preventDefault();
            const participationType = document.querySelector('input[name="participationType"]:checked').value;
            const schoolName = document.getElementById('regSchoolName').value;
            
            let message = 'Registration successful! Welcome to the Ecological Civilization Action Platform!';
            if (participationType === 'individual') {
                message += ' You are registered as an individual student participant.';
            } else if (schoolName) {
                message += ` You are registered under ${schoolName}.`;
            }
            
            showToast(message);
            closeStudentRegistrationModal();
        }

        function submitSchoolRegistration(event) {
            event.preventDefault();
            showToast('School registration application submitted! We will contact you within 3 business days.');
            closeSchoolRegistrationModal();
        }

        function handleSchoolLogin(event) {
            event.preventDefault();
            const schoolCode = document.getElementById('schoolCode').value;
            
            if (schoolCode) {
                showToast('Login successful! Loading school management panel...');
                closeSchoolLoginModal();
                // In a real application, this would redirect to the school dashboard
                setTimeout(() => {
                    showToast('School dashboard would load here in the full application.');
                }, 1000);
            }
        }

        function submitSponsorApplication(event) {
            event.preventDefault();
            showToast('Sponsorship application submitted! We will contact you within 24 hours.');
            closeSponsorModal();
        }

        function submitGreenMoverRegistration(event) {
            event.preventDefault();
            showToast('Green Mover registration successful! Welcome to the World Green Movement Award program!');
            closeGreenMoverModal();
        }

        // AIæ•™è‚²å¼•å¯¼ç³»ç»Ÿå‡½æ•°
        function generateStandardExample(category, userContent) {
            const examples = {
                'recycling': {
                    title: 'ğŸ“‹ åºŸç‰©åˆ†ç±»æ ‡å‡†ç¤ºä¾‹',
                    content: `ğŸ• æ—¶é—´åœ°ç‚¹ï¼š2024å¹´8æœˆ31æ—¥ï¼Œåœ¨å­¦æ ¡åŠå…¬å®¤æ—è¾¹çš„ç©ºåœ°
ğŸ¯ è¡ŒåŠ¨åŠ¨æœºï¼šä¸ºäº†æ•™è‚²å¤§å®¶æ­£ç¡®çš„åºŸç‰©åˆ†ç±»æ–¹æ³•ï¼Œä¿æŠ¤ç¯å¢ƒ
ğŸ“Š è¡ŒåŠ¨ç»“æœï¼šæˆåŠŸè®¾ç½®äº†åˆ†ç±»å›æ”¶ç«™ï¼ŒåŒå­¦ä»¬å­¦ä¼šäº†æ­£ç¡®åˆ†ç±»
ğŸ’­ ä¸ªäººæ„Ÿæ‚Ÿï¼šé€šè¿‡å®é™…è¡ŒåŠ¨ï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°ç¯ä¿éœ€è¦æ¯ä¸ªäººçš„å‚ä¸`
                },
                'planting': {
                    title: 'ğŸ“‹ æ¤æ ‘ç§æ¤æ ‡å‡†ç¤ºä¾‹',
                    content: `ğŸ• æ—¶é—´åœ°ç‚¹ï¼šå‘¨æœ«ä¸Šåˆï¼Œåœ¨ç¤¾åŒºå…¬å›­çš„æŒ‡å®šç»¿åŒ–åŒºåŸŸ
ğŸ¯ è¡ŒåŠ¨åŠ¨æœºï¼šä¸ºäº†å¢åŠ ç»¿è‰²è¦†ç›–ï¼Œæ”¹å–„ç©ºæ°”è´¨é‡ï¼Œç¾åŒ–ç¯å¢ƒ
ğŸ“Š è¡ŒåŠ¨ç»“æœï¼šæˆåŠŸç§æ¤äº†10æ£µå°æ ‘è‹—ï¼Œå»ºç«‹äº†é•¿æœŸæŠ¤ç†è®¡åˆ’
ğŸ’­ ä¸ªäººæ„Ÿæ‚Ÿï¼šçœ‹ç€å°æ ‘è‹—åœ¨åœŸå£¤ä¸­æ‰æ ¹ï¼Œæˆ‘æ„Ÿå—åˆ°ç”Ÿå‘½çš„åŠ›é‡å’Œå¸Œæœ›`
                },
                'cleanup': {
                    title: 'ğŸ“‹ ç¯å¢ƒæ¸…æ´æ ‡å‡†ç¤ºä¾‹',
                    content: `ğŸ• æ—¶é—´åœ°ç‚¹ï¼šä¸Šå‘¨å…­æ—©æ™¨ï¼Œåœ¨é™„è¿‘çš„æ²³è¾¹å…¬å›­
ğŸ¯ è¡ŒåŠ¨åŠ¨æœºï¼šå› ä¸ºçœ‹åˆ°åƒåœ¾æ±¡æŸ“äº†ç¾ä¸½çš„è‡ªç„¶ç¯å¢ƒï¼Œæƒ³è¦æ¢å¤æ¸…æ´
ğŸ“Š è¡ŒåŠ¨ç»“æœï¼šæ¸…ç†äº†3è¢‹åƒåœ¾ï¼Œæ²³è¾¹æ¢å¤äº†åŸæœ‰çš„ç¾ä¸½é¢è²Œ
ğŸ’­ ä¸ªäººæ„Ÿæ‚Ÿï¼šç¯å¢ƒä¿æŠ¤ä¸æ˜¯å£å·ï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬ç”¨è¡ŒåŠ¨æ¥è¯æ˜çš„è´£ä»»`
                },
                'conservation': {
                    title: 'ğŸ“‹ èŠ‚èƒ½èŠ‚æ°´æ ‡å‡†ç¤ºä¾‹',
                    content: `ğŸ• æ—¶é—´åœ°ç‚¹ï¼šè¿™ä¸ªæœˆåœ¨å®¶é‡Œå’Œå­¦æ ¡å®æ–½èŠ‚èƒ½è®¡åˆ’
ğŸ¯ è¡ŒåŠ¨åŠ¨æœºï¼šä¸ºäº†å‡å°‘èƒ½æºæµªè´¹ï¼Œé™ä½ç¢³è¶³è¿¹ï¼Œä¿æŠ¤åœ°çƒèµ„æº
ğŸ“Š è¡ŒåŠ¨ç»“æœï¼šç”¨ç”µé‡å‡å°‘äº†20%ï¼Œæ°´è´¹ä¹Ÿæ˜æ˜¾é™ä½
ğŸ’­ ä¸ªäººæ„Ÿæ‚Ÿï¼šå°å°çš„æ”¹å˜ç§¯ç´¯èµ·æ¥å°±æ˜¯å·¨å¤§çš„ç¯ä¿è´¡çŒ®`
                },
                'transport': {
                    title: 'ğŸ“‹ ç»¿è‰²å‡ºè¡Œæ ‡å‡†ç¤ºä¾‹',
                    content: `ğŸ• æ—¶é—´åœ°ç‚¹ï¼šæ¯å¤©ä¸Šä¸‹å­¦è·¯ä¸Šï¼Œé€‰æ‹©æ­¥è¡Œæˆ–éª‘è‡ªè¡Œè½¦
ğŸ¯ è¡ŒåŠ¨åŠ¨æœºï¼šä¸ºäº†å‡å°‘æ±½è½¦å°¾æ°”æ’æ”¾ï¼ŒåŒæ—¶é”»ç‚¼èº«ä½“
ğŸ“Š è¡ŒåŠ¨ç»“æœï¼šä¸€ä¸ªæœˆå‡å°‘äº†ç¢³æ’æ”¾ï¼Œèº«ä½“ä¹Ÿæ›´å¥åº·äº†
ğŸ’­ ä¸ªäººæ„Ÿæ‚Ÿï¼šç»¿è‰²å‡ºè¡Œä¸ä»…ç¯ä¿ï¼Œè¿˜è®©æˆ‘æ›´åŠ çƒ­çˆ±å¤§è‡ªç„¶`
                },
                'education': {
                    title: 'ğŸ“‹ ç¯ä¿æ•™è‚²æ ‡å‡†ç¤ºä¾‹',
                    content: `ğŸ• æ—¶é—´åœ°ç‚¹ï¼šæ˜¨å¤©ä¸‹åˆï¼Œåœ¨ç­çº§é‡Œç»„ç»‡ç¯ä¿çŸ¥è¯†åˆ†äº«ä¼š
ğŸ¯ è¡ŒåŠ¨åŠ¨æœºï¼šä¸ºäº†æé«˜åŒå­¦ä»¬çš„ç¯ä¿æ„è¯†ï¼Œä¼ æ’­ç”Ÿæ€æ–‡æ˜ç†å¿µ
ğŸ“Š è¡ŒåŠ¨ç»“æœï¼š30ä½åŒå­¦å‚ä¸ï¼Œå¤§å®¶éƒ½å­¦åˆ°äº†å®ç”¨çš„ç¯ä¿çŸ¥è¯†
ğŸ’­ ä¸ªäººæ„Ÿæ‚Ÿï¼šæ•™è‚²ä»–äººçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è‡ªå·±ä¹Ÿå­¦åˆ°äº†æ›´å¤šç¯ä¿çŸ¥è¯†`
                },
                'innovation': {
                    title: 'ğŸ“‹ ç”Ÿæ€åˆ›æ–°æ ‡å‡†ç¤ºä¾‹',
                    content: `ğŸ• æ—¶é—´åœ°ç‚¹ï¼šä¸Šå‘¨æœ«ï¼Œåœ¨å®¶é‡Œçš„å°å·¥ä½œå®¤åˆ¶ä½œç¯ä¿è£…ç½®
ğŸ¯ è¡ŒåŠ¨åŠ¨æœºï¼šä¸ºäº†è§£å†³ç”Ÿæ´»ä¸­çš„ç¯ä¿é—®é¢˜ï¼Œå‘æŒ¥åˆ›æ–°æ€ç»´
ğŸ“Š è¡ŒåŠ¨ç»“æœï¼šæˆåŠŸåˆ¶ä½œäº†é›¨æ°´æ”¶é›†è£…ç½®ï¼Œå¯ä»¥ç”¨æ¥æµ‡èŠ±
ğŸ’­ ä¸ªäººæ„Ÿæ‚Ÿï¼šåˆ›æ–°è®©ç¯ä¿å˜å¾—æ›´æœ‰è¶£ï¼Œä¹Ÿè®©æˆ‘å‘ç°äº†è‡ªå·±çš„æ½œåŠ›`
                },
                'togetherness': {
                    title: 'ğŸ“‹ åˆä½œå…³æ€€æ ‡å‡†ç¤ºä¾‹',
                    content: `ğŸ• æ—¶é—´åœ°ç‚¹ï¼šæ˜¨å¤©ä¸‹åˆï¼Œåœ¨å­¦æ ¡ç»„ç»‡èš¯èš“å †è‚¥å·¥ä½œåŠ
ğŸ¯ è¡ŒåŠ¨åŠ¨æœºï¼šä¸ºäº†æ•™å¯¼å¤§å®¶æœ‰æœºåºŸæ–™å¤„ç†ï¼ŒåŒæ—¶åŸ¹å…»å›¢é˜Ÿåˆä½œç²¾ç¥
ğŸ“Š è¡ŒåŠ¨ç»“æœï¼š20ä½å­¦å‘˜å­¦ä¼šäº†èš¯èš“å…»æ®–æŠ€æœ¯ï¼Œå¤§å®¶äº’ç›¸å¸®åŠ©å’Œå…³æ€€
ğŸ’­ ä¸ªäººæ„Ÿæ‚Ÿï¼šé€šè¿‡åˆä½œï¼Œæˆ‘ä»¬ä¸ä»…ä¿æŠ¤äº†ç¯å¢ƒï¼Œæ›´é‡è¦çš„æ˜¯å»ºç«‹äº†æ·±åšçš„å‹è°Š`
                }
            };
            
            const example = examples[category] || examples['cleanup'];
            return `${example.title}ï¼š\n${example.content}`;
        }
        
        function generateEducationalGuidance(userContent, category) {
            // åˆ†æç”¨æˆ·å†…å®¹çš„ä¼˜ç‚¹å’Œæ”¹è¿›å»ºè®®
            const hasTimePlace = /åœ¨.*æ—¶å€™|åœ¨.*åœ°æ–¹|æ˜¨å¤©|ä»Šå¤©|ä¸Šå‘¨|å­¦æ ¡|å®¶é‡Œ|å…¬å›­|åŠå…¬å®¤|æ—¶é—´|åœ°ç‚¹/.test(userContent);
            const hasMotivation = /å› ä¸º|ä¸ºäº†|ç›®çš„|æ„ä¹‰|é‡è¦|åŸå› |åŠ¨æœº/.test(userContent);
            const hasResult = /ç»“æœ|æ•ˆæœ|å½±å“|æ”¹å˜|æé«˜|å‡å°‘|èŠ‚çº¦|æˆæœ|æ”¶è·/.test(userContent);
            const hasReflection = /æ„Ÿåˆ°|è§‰å¾—|ä½“ä¼š|å­¦åˆ°|æ”¶è·|å¯å‘|æ„Ÿæƒ³|æ„Ÿæ‚Ÿ/.test(userContent);
            
            let guidance = `ğŸ“ ä¸ªäººè¡¨è¾¾å‡åæŒ‡å¯¼ï¼š\n\n`;
            
            // è¡¨æ‰¬å·²æœ‰çš„ä¼˜ç‚¹
            const strengths = [];
            if (hasTimePlace) strengths.push('âœ… æ—¶é—´åœ°ç‚¹æè¿°æ¸…æ¥š');
            if (hasMotivation) strengths.push('âœ… è¡ŒåŠ¨åŠ¨æœºè¡¨è¾¾æ˜ç¡®');
            if (hasResult) strengths.push('âœ… è¡ŒåŠ¨ç»“æœè®°å½•å®Œæ•´');
            if (hasReflection) strengths.push('âœ… ä¸ªäººæ„Ÿæ‚ŸçœŸè¯šæ·±åˆ»');
            
            if (strengths.length > 0) {
                guidance += `ğŸŒŸ æ‚¨çš„ä¼˜ç§€è¡¨ç°ï¼š\n${strengths.join('\n')}\n\n`;
            }
            
            // æä¾›è§‚å¯Ÿä½“éªŒçš„æ·±åŒ–å»ºè®®
            guidance += `ğŸ” è§‚å¯Ÿä½“éªŒæ·±åŒ–å»ºè®®ï¼š\n`;
            guidance += `â€¢ ç¯ä¿è¡ŒåŠ¨ä¸­çš„ç»†èŠ‚è§‚å¯Ÿï¼ˆå·¥å…·ä½¿ç”¨ã€è¿‡ç¨‹å˜åŒ–ï¼‰\n`;
            guidance += `â€¢ å›¢é˜Ÿåˆä½œçš„æ¸©æš–æ—¶åˆ»ï¼ˆäº’åŠ©ã€å…³æ€€ã€å…±åŒåŠªåŠ›ï¼‰\n`;
            guidance += `â€¢ ç¯å¢ƒå˜åŒ–çš„å…·ä½“æ„Ÿå—ï¼ˆå‰åå¯¹æ¯”ã€æ”¹å–„æ•ˆæœï¼‰\n`;
            guidance += `â€¢ å†…å¿ƒæˆé•¿çš„çœŸå®ä½“éªŒï¼ˆè´£ä»»æ„Ÿã€æˆå°±æ„Ÿã€ä½¿å‘½æ„Ÿï¼‰\n\n`;
            
            guidance += `ğŸ’¡ è¡¨è¾¾æŠ€å·§æå‡ï¼š\n`;
            guidance += `â€¢ ç”¨å…·ä½“çš„æ•°å­—å’Œäº‹å®è¯´è¯\n`;
            guidance += `â€¢ æè¿°æ„Ÿå®˜ä½“éªŒï¼ˆçœ‹åˆ°ã€å¬åˆ°ã€æ„Ÿå—åˆ°ï¼‰\n`;
            guidance += `â€¢ è¿æ¥ä¸ªäººæˆé•¿ä¸ç¯ä¿æ„ä¹‰\n`;
            guidance += `â€¢ å±•ç°å¯¹æœªæ¥ç¯ä¿è¡ŒåŠ¨çš„è®¡åˆ’`;
            
            return guidance;
        }
        
        // å­¦æ ¡5å¤§ç»¿è‰²è¡ŒåŠ¨å¤šæ ·æ€§æ£€æŸ¥
        const schoolGreenActions = {}; // å­˜å‚¨å„å­¦æ ¡çš„è¡ŒåŠ¨ç±»å‹ç»Ÿè®¡
        
        function checkGreenActionDiversity(schoolName, newCategory) {
            if (!schoolName) return '';
            
            // åˆå§‹åŒ–å­¦æ ¡è®°å½•
            if (!schoolGreenActions[schoolName]) {
                schoolGreenActions[schoolName] = {
                    recycling: 0,
                    planting: 0,
                    cleanup: 0,
                    conservation: 0,
                    transport: 0,
                    education: 0,
                    innovation: 0,
                    togetherness: 0 // åˆä½œå…³æ€€è¡ŒåŠ¨
                };
            }
            
            // æ›´æ–°ç»Ÿè®¡
            schoolGreenActions[schoolName][newCategory]++;
            
            const actions = schoolGreenActions[schoolName];
            const totalActions = Object.values(actions).reduce((sum, count) => sum + count, 0);
            const diversityCount = Object.values(actions).filter(count => count > 0).length;
            
            let diversityMessage = `\nğŸ† ${schoolName} ç»¿è‰²è¡ŒåŠ¨å¤šæ ·æ€§ç»Ÿè®¡ï¼š\n`;
            diversityMessage += `ğŸ“Š æ€»å‚ä¸æ¬¡æ•°ï¼š${totalActions} æ¬¡\n`;
            diversityMessage += `ğŸŒˆ è¡ŒåŠ¨ç±»å‹è¦†ç›–ï¼š${diversityCount}/8 ç§\n\n`;
            
            // æ˜¾ç¤ºå„ç±»å‹å‚ä¸æƒ…å†µ
            const actionNames = {
                recycling: 'â™»ï¸ åºŸç‰©åˆ†ç±»å›æ”¶',
                planting: 'ğŸŒ± æ¤æ ‘ç§æ¤',
                cleanup: 'ğŸ§¹ ç¯å¢ƒæ¸…æ´',
                conservation: 'ğŸ’¡ èŠ‚èƒ½èŠ‚æ°´',
                transport: 'ğŸš² ç»¿è‰²å‡ºè¡Œ',
                education: 'ğŸ“š ç¯ä¿æ•™è‚²',
                innovation: 'ğŸ”¬ ç”Ÿæ€åˆ›æ–°',
                togetherness: 'ğŸ¤ åˆä½œå…³æ€€'
            };
            
            Object.entries(actions).forEach(([key, count]) => {
                if (count > 0) {
                    diversityMessage += `${actionNames[key]}ï¼š${count} æ¬¡\n`;
                }
            });
            
            // å¤šæ ·æ€§è¯„ä»·å’Œå»ºè®®
            if (diversityCount >= 5) {
                diversityMessage += `\nğŸ‰ ä¼˜ç§€ï¼æ‚¨çš„å­¦æ ¡å±•ç°äº†å…¨é¢çš„ç¯ä¿è¡ŒåŠ¨å¤šæ ·æ€§ï¼`;
                diversityMessage += `\nğŸ… ç¯ç¯ç›¸æ‰£çš„ç»¿è‰²è¡ŒåŠ¨ä½“ç°äº†çœŸæ­£çš„ç”Ÿæ€æ–‡æ˜ç†å¿µï¼`;
            } else if (diversityCount >= 3) {
                diversityMessage += `\nğŸ‘ å¾ˆå¥½ï¼ç»§ç»­æ¢ç´¢æ›´å¤šç±»å‹çš„ç¯ä¿è¡ŒåŠ¨ï¼`;
                diversityMessage += `\nğŸ’¡ å»ºè®®ï¼šå°è¯•æ›´å¤šåˆä½œå…³æ€€ç±»çš„å›¢é˜Ÿç¯ä¿æ´»åŠ¨ï¼`;
            } else {
                diversityMessage += `\nğŸŒ± èµ·æ­¥é˜¶æ®µï¼Œå»ºè®®å°è¯•ä¸åŒç±»å‹çš„ç¯ä¿è¡ŒåŠ¨ï¼`;
                diversityMessage += `\nğŸ¤ ç‰¹åˆ«æ¨èï¼šå›¢é˜Ÿåˆä½œçš„ç¯ä¿é¡¹ç›®èƒ½åŸ¹å…»å…³æ€€ç²¾ç¥ï¼`;
            }
            
            return diversityMessage;
        }

        // Emoji to Image replacement system
        const emojiImageMap = {
            // Header and navigation emojis
            'ğŸŒ': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f30d.png',
            'ğŸ“š': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4da.png',
            'ğŸ«': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f3eb.png',
            'ğŸ“·': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4f7.png',
            
            // Action category emojis
            'ğŸ“': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4dd.png',
            'ğŸ“': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f393.png',
            'ğŸŒŸ': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f31f.png',
            'ğŸ¯': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f3af.png',
            
            // Environmental action emojis
            'â™»ï¸': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/267e.png',
            'ğŸŒ±': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f331.png',
            'ğŸ§¹': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f9f9.png',
            'ğŸ’¡': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4a1.png',
            'ğŸš²': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f6b2.png',
            'ğŸ”¬': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f52c.png',
            'ğŸ¤': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f91d.png',
            
            // Award and ranking emojis
            'ğŸ¥‡': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f947.png',
            'ğŸ¥ˆ': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f948.png',
            'ğŸ¥‰': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f949.png',
            'ğŸ†': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f3c6.png',
            'ğŸ‘‘': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f451.png',
            'ğŸ’š': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f49a.png',
            
            // Interface and feedback emojis
            'âœ…': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/2705.png',
            'âš ï¸': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/26a0.png',
            'ğŸš«': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f6ab.png',
            'ğŸ‰': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f389.png',
            'ğŸ’¡': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4a1.png',
            'ğŸ”': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f50d.png',
            'ğŸ“Š': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4ca.png',
            'ğŸ“ˆ': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4c8.png',
            'ğŸ¤–': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f916.png',
            
            // Magazine and reading emojis
            'ğŸ“–': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4d6.png',
            'âœï¸': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/270d.png',
            'ğŸ“…': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4c5.png',
            'ğŸ”—': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f517.png',
            
            // Sponsor and partnership emojis
            'ğŸ¢': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f3e2.png',
            'âš¡': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/26a1.png',
            'ğŸ—ï¸': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f3d7.png',
            
            // Photo and upload emojis
            'ğŸ“¸': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4f8.png',
            'ğŸ›¡ï¸': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f6e1.png',
            'ğŸš¨': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f6a8.png',
            'ğŸ—‘ï¸': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f5d1.png',
            
            // Logo editor emojis
            'ğŸ¨': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f3a8.png',
            'ğŸ“': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4cf.png',
            'ğŸ”²': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f532.png',
            'ğŸ”§': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f527.png'
        };

        // Function to replace emojis with images (simplified and safe)
        function replaceEmojisWithImages() {
            // Only replace emojis in specific safe containers to avoid breaking the layout
            const safeContainers = document.querySelectorAll('.card-hover, .sponsor-card, .bg-gradient-to-br');
            
            safeContainers.forEach(container => {
                replaceEmojisInElement(container);
            });
        }

        // Function to escape special regex characters
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Enhanced emoji replacement for specific large emojis (like in cards)
        function replaceLargeEmojis() {
            // Replace large emojis in cards and prominent positions
            const largeEmojiSelectors = [
                '.text-5xl', '.text-6xl', '.text-4xl', '.text-3xl', '.text-2xl'
            ];

            largeEmojiSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    Object.entries(emojiImageMap).forEach(([emoji, imageUrl]) => {
                        if (element.textContent.includes(emoji)) {
                            const size = getSizeFromClass(element.className);
                            element.innerHTML = element.innerHTML.replace(
                                new RegExp(escapeRegExp(emoji), 'g'),
                                `<img src="${imageUrl}" alt="${emoji}" class="emoji-image inline-block ${size}" style="vertical-align: middle;" onerror="this.style.display='none'; this.parentNode.innerHTML='${emoji}';">`
                            );
                        }
                    });
                });
            });
        }

        // Get appropriate size class for large emojis
        function getSizeFromClass(className) {
            if (className.includes('text-6xl')) return 'w-16 h-16';
            if (className.includes('text-5xl')) return 'w-14 h-14';
            if (className.includes('text-4xl')) return 'w-12 h-12';
            if (className.includes('text-3xl')) return 'w-10 h-10';
            if (className.includes('text-2xl')) return 'w-8 h-8';
            return 'w-6 h-6';
        }

        // Function to add emoji replacement for dynamically added content (safe version)
        function replaceEmojisInElement(element) {
            // Simple and safe emoji replacement - only replace in innerHTML of specific elements
            if (!element || !element.innerHTML) return;
            
            let html = element.innerHTML;
            let hasChanges = false;
            
            // Only replace a few key emojis to avoid breaking the layout
            const safeEmojis = {
                'ğŸŒ±': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f331.png',
                'ğŸ“š': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4da.png',
                'âš¡': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/26a1.png',
                'ğŸ—ï¸': 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f3d7.png'
            };
            
            Object.entries(safeEmojis).forEach(([emoji, imageUrl]) => {
                if (html.includes(emoji)) {
                    const regex = new RegExp(escapeRegExp(emoji), 'g');
                    html = html.replace(regex, 
                        `<img src="${imageUrl}" alt="${emoji}" class="emoji-image inline-block w-6 h-6" style="vertical-align: middle;" onerror="this.outerHTML='${emoji}';">`
                    );
                    hasChanges = true;
                }
            });
            
            if (hasChanges) {
                element.innerHTML = html;
            }
        }

        // Background image management
        let currentButtonType = '';
        let currentBannerType = '';
        let uploadedBackgroundImage = '';
        let backgroundSettings = {
            greenMovement: { type: 'gradient', value: 'bg-gradient-to-br from-green-500 to-green-600' },
            eMagazine: { type: 'gradient', value: 'bg-gradient-to-br from-orange-500 to-orange-600' },
            studentReg: { type: 'gradient', value: 'bg-gradient-to-br from-blue-500 to-blue-600' },
            greenMover: { type: 'gradient', value: 'bg-gradient-to-br from-purple-500 to-purple-600' }
        };
        
        // Banner background settings
        let bannerSettings = {
            header: { type: 'gradient', value: 'bg-gradient-to-r from-green-600 to-blue-600' },
            hero: { type: 'gradient', value: 'bg-gradient-to-br from-blue-500 to-purple-600' },
            coreFeatures: { type: 'gradient', value: 'bg-gradient-to-br from-green-100 to-blue-100' },
            competition: { type: 'gradient', value: 'bg-gradient-to-br from-purple-200 to-pink-200' },
            partnership: { type: 'gradient', value: 'bg-gradient-to-br from-gray-100 to-blue-100' }
        };

        // Button configuration
        const buttonConfig = {
            greenMovement: { name: 'My Green Movement', icon: 'ğŸ“', color: 'green' },
            eMagazine: { name: 'E-Magazine', icon: 'ğŸ“š', color: 'orange' },
            studentReg: { name: 'Student Registration', icon: 'ğŸ“', color: 'blue' },
            greenMover: { name: 'Green Mover', icon: 'ğŸŒŸ', color: 'purple' }
        };
        
        // Banner configuration
        const bannerConfig = {
            header: { name: 'Header Banner', icon: 'ğŸ ', description: 'Top navigation header background' },
            hero: { name: 'Hero Section', icon: 'ğŸŒŸ', description: 'Main hero section background' },
            coreFeatures: { name: 'Core Features', icon: 'ğŸ¯', description: 'Core features section background' },
            competition: { name: 'Competition Rankings', icon: 'ğŸ†', description: 'Competition rankings section background' },
            partnership: { name: 'Enterprise Partners', icon: 'ğŸ¤', description: 'Partnership section background' }
        };

        // Logo upload and editing functions
        let logoEditorVisible = false;
        
        function triggerLogoUpload() {
            document.getElementById('logoUpload').click();
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Check if it's an image file
                if (!file.type.startsWith('image/')) {
                    showToast('âš ï¸ è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼ˆJPG, PNG, SVGç­‰æ ¼å¼ï¼‰');
                    return;
                }
                
                // Check file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('âš ï¸ å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©å°äº5MBçš„æ–‡ä»¶');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const mecccLogo = document.getElementById('mecccLogo');
                    const logoPlaceholder = document.getElementById('logoPlaceholder');
                    
                    mecccLogo.src = e.target.result;
                    mecccLogo.classList.remove('hidden');
                    logoPlaceholder.classList.add('hidden');
                    
                    // Store logo and settings in localStorage for persistence
                    const logoSettings = {
                        src: e.target.result,
                        size: 64,
                        shape: 'rounded-lg',
                        background: 'bg-white bg-opacity-20'
                    };
                    localStorage.setItem('mecccLogoSettings', JSON.stringify(logoSettings));
                    
                    showToast('âœ… MECCC logoå·²æˆåŠŸä¸Šä¼ ï¼ç‚¹å‡»logoå¯ä»¥ç¼–è¾‘æ ·å¼ã€‚');
                };
                reader.readAsDataURL(file);
            }
        }

        function toggleLogoEditor() {
            const logoEditor = document.getElementById('logoEditor');
            logoEditorVisible = !logoEditorVisible;
            
            if (logoEditorVisible) {
                logoEditor.classList.add('show');
                // Load current settings
                loadLogoSettings();
            } else {
                logoEditor.classList.remove('show');
            }
        }

        function adjustLogoSize(size) {
            const mecccLogo = document.getElementById('mecccLogo');
            const sizeDisplay = document.getElementById('sizeDisplay');
            
            mecccLogo.style.width = size + 'px';
            mecccLogo.style.height = size + 'px';
            sizeDisplay.textContent = size + 'px';
            
            // Save settings
            saveLogoSettings();
        }

        function setLogoShape(shape) {
            const mecccLogo = document.getElementById('mecccLogo');
            
            // Remove existing shape classes
            mecccLogo.classList.remove('rounded-lg', 'rounded-full', 'rounded-none');
            mecccLogo.classList.add(shape);
            
            // Save settings
            saveLogoSettings();
            showToast(`âœ¨ Logoå½¢çŠ¶å·²æ›´æ–°ä¸º${getShapeName(shape)}`);
        }

        function setLogoBg(bgClass) {
            const mecccLogo = document.getElementById('mecccLogo');
            
            // Remove existing background classes
            mecccLogo.classList.remove('bg-white', 'bg-opacity-20', 'bg-green-100', 'bg-blue-100');
            
            // Add new background classes
            const classes = bgClass.split(' ');
            classes.forEach(cls => mecccLogo.classList.add(cls));
            
            // Save settings
            saveLogoSettings();
            showToast(`ğŸ¨ LogoèƒŒæ™¯å·²æ›´æ–°`);
        }

        function removeLogo() {
            const mecccLogo = document.getElementById('mecccLogo');
            const logoPlaceholder = document.getElementById('logoPlaceholder');
            const logoEditor = document.getElementById('logoEditor');
            
            mecccLogo.classList.add('hidden');
            logoPlaceholder.classList.remove('hidden');
            logoEditor.classList.remove('show');
            logoEditorVisible = false;
            
            // Clear localStorage
            localStorage.removeItem('mecccLogoSettings');
            
            showToast('ğŸ—‘ï¸ Logoå·²åˆ é™¤');
        }

        function saveLogoSettings() {
            const mecccLogo = document.getElementById('mecccLogo');
            const logoSizeSlider = document.getElementById('logoSizeSlider');
            
            if (mecccLogo.src) {
                const logoSettings = {
                    src: mecccLogo.src,
                    size: logoSizeSlider.value,
                    shape: getLogoShape(mecccLogo),
                    background: getLogoBackground(mecccLogo)
                };
                localStorage.setItem('mecccLogoSettings', JSON.stringify(logoSettings));
            }
        }

        function loadLogoSettings() {
            const savedSettings = localStorage.getItem('mecccLogoSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                const logoSizeSlider = document.getElementById('logoSizeSlider');
                const sizeDisplay = document.getElementById('sizeDisplay');
                
                logoSizeSlider.value = settings.size;
                sizeDisplay.textContent = settings.size + 'px';
            }
        }

        function getLogoShape(logoElement) {
            if (logoElement.classList.contains('rounded-full')) return 'rounded-full';
            if (logoElement.classList.contains('rounded-none')) return 'rounded-none';
            return 'rounded-lg';
        }

        function getLogoBackground(logoElement) {
            if (logoElement.classList.contains('bg-green-100')) return 'bg-green-100';
            if (logoElement.classList.contains('bg-blue-100')) return 'bg-blue-100';
            if (logoElement.classList.contains('bg-white') && !logoElement.classList.contains('bg-opacity-20')) return 'bg-white';
            return 'bg-white bg-opacity-20';
        }

        function getShapeName(shape) {
            switch(shape) {
                case 'rounded-full': return 'åœ†å½¢';
                case 'rounded-none': return 'æ–¹å½¢';
                default: return 'åœ†è§’';
            }
        }

        // Load saved logo on page load
        function loadSavedLogo() {
            const savedSettings = localStorage.getItem('mecccLogoSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                const mecccLogo = document.getElementById('mecccLogo');
                const logoPlaceholder = document.getElementById('logoPlaceholder');
                
                mecccLogo.src = settings.src;
                mecccLogo.style.width = settings.size + 'px';
                mecccLogo.style.height = settings.size + 'px';
                
                // Apply shape
                mecccLogo.classList.remove('rounded-lg', 'rounded-full', 'rounded-none');
                mecccLogo.classList.add(settings.shape);
                
                // Apply background
                mecccLogo.classList.remove('bg-white', 'bg-opacity-20', 'bg-green-100', 'bg-blue-100');
                const bgClasses = settings.background.split(' ');
                bgClasses.forEach(cls => mecccLogo.classList.add(cls));
                
                mecccLogo.classList.remove('hidden');
                logoPlaceholder.classList.add('hidden');
            }
        }

        // Background image functions
        function changeButtonBackground(buttonType) {
            currentButtonType = buttonType;
            currentBannerType = '';
            const config = buttonConfig[buttonType];
            
            // Update modal content
            document.getElementById('currentButtonIcon').textContent = config.icon;
            document.getElementById('currentButtonName').textContent = config.name;
            document.getElementById('previewIcon').textContent = config.icon;
            document.getElementById('previewTitle').textContent = config.name;
            
            // Reset form
            document.getElementById('backgroundImageUpload').value = '';
            document.getElementById('backgroundPreview').classList.add('hidden');
            document.getElementById('opacityControl').classList.add('hidden');
            document.getElementById('applyBackgroundBtn').disabled = true;
            document.getElementById('applyBackgroundBtn').className = 'flex-1 bg-gray-400 text-white py-3 px-4 rounded-lg font-semibold cursor-not-allowed';
            
            // Show modal
            document.getElementById('backgroundUploadModal').classList.remove('hidden');
        }
        
        // Banner background functions
        function changeBannerBackground(bannerType) {
            currentBannerType = bannerType;
            currentButtonType = '';
            const config = bannerConfig[bannerType];
            
            // Update modal content for banner
            document.getElementById('currentButtonIcon').textContent = config.icon;
            document.getElementById('currentButtonName').textContent = config.name;
            document.getElementById('previewIcon').textContent = config.icon;
            document.getElementById('previewTitle').textContent = config.name;
            
            // Reset form
            document.getElementById('backgroundImageUpload').value = '';
            document.getElementById('backgroundPreview').classList.add('hidden');
            document.getElementById('opacityControl').classList.add('hidden');
            document.getElementById('applyBackgroundBtn').disabled = true;
            document.getElementById('applyBackgroundBtn').className = 'flex-1 bg-gray-400 text-white py-3 px-4 rounded-lg font-semibold cursor-not-allowed';
            
            // Show modal
            document.getElementById('backgroundUploadModal').classList.remove('hidden');
        }

        function closeBackgroundUploadModal() {
            document.getElementById('backgroundUploadModal').classList.add('hidden');
            currentButtonType = '';
            currentBannerType = '';
            uploadedBackgroundImage = '';
        }

        function handleBackgroundImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Check if it's an image file
                if (!file.type.startsWith('image/')) {
                    showToast('âš ï¸ è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼ˆJPG, PNG, WebPç­‰æ ¼å¼ï¼‰');
                    return;
                }
                
                // Check file size (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    showToast('âš ï¸ å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©å°äº10MBçš„æ–‡ä»¶');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedBackgroundImage = e.target.result;
                    
                    // Show preview
                    const previewBackground = document.getElementById('previewBackground');
                    previewBackground.style.backgroundImage = `url(${uploadedBackgroundImage})`;
                    
                    document.getElementById('backgroundPreview').classList.remove('hidden');
                    document.getElementById('opacityControl').classList.remove('hidden');
                    
                    // Enable apply button
                    const applyBtn = document.getElementById('applyBackgroundBtn');
                    applyBtn.disabled = false;
                    applyBtn.className = 'flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold';
                    
                    showToast('âœ… å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼æ‚¨å¯ä»¥è°ƒæ•´é€æ˜åº¦å¹¶é¢„è§ˆæ•ˆæœã€‚');
                };
                reader.readAsDataURL(file);
            }
        }

        function updateBackgroundOpacity(opacity) {
            const previewBackground = document.getElementById('previewBackground');
            previewBackground.style.opacity = opacity;
        }

        function applyBackgroundImage() {
            if ((!currentButtonType && !currentBannerType) || !uploadedBackgroundImage) return;
            
            const opacity = document.getElementById('backgroundOpacity').value;
            const targetName = currentButtonType ? buttonConfig[currentButtonType].name : bannerConfig[currentBannerType].name;
            
            showConfirmation(
                `æ‚¨ç¡®å®šè¦æ›´æ¢${targetName}çš„èƒŒæ™¯å›¾ç‰‡å—ï¼Ÿ`,
                `æ–°èƒŒæ™¯ï¼šè‡ªå®šä¹‰å›¾ç‰‡\né€æ˜åº¦ï¼š${Math.round(opacity * 100)}%\næ­¤æ“ä½œå°†æ›¿æ¢å½“å‰èƒŒæ™¯è®¾ç½®ã€‚`,
                'ğŸ–¼ï¸',
                () => {
                    if (currentButtonType) {
                        // Handle button background
                        const backgroundElement = document.getElementById(currentButtonType + 'Bg');
                        const oldSettings = backgroundSettings[currentButtonType];
                        
                        // ä¿å­˜åˆ°å†å²è®°å½•
                        saveToHistory(
                            CHANGE_TYPES.BACKGROUND_CHANGE,
                            currentButtonType + 'Bg',
                            oldSettings,
                            {
                                type: 'image',
                                value: uploadedBackgroundImage,
                                opacity: opacity
                            },
                            { backgroundId: currentButtonType + 'Bg' }
                        );
                        
                        backgroundElement.style.backgroundImage = `url(${uploadedBackgroundImage})`;
                        backgroundElement.style.opacity = opacity;
                        
                        // Update settings
                        backgroundSettings[currentButtonType] = {
                            type: 'image',
                            value: uploadedBackgroundImage,
                            opacity: opacity
                        };
                        
                        // Save to localStorage
                        localStorage.setItem('buttonBackgroundSettings', JSON.stringify(backgroundSettings));
                        showToast(`ğŸ‰ ${buttonConfig[currentButtonType].name} èƒŒæ™¯å·²æ›´æ–°ï¼`);
                        
                    } else if (currentBannerType) {
                        // Handle banner background
                        const backgroundElement = document.getElementById(currentBannerType + 'Bg');
                        const oldSettings = bannerSettings[currentBannerType];
                        
                        // ä¿å­˜åˆ°å†å²è®°å½•
                        saveToHistory(
                            CHANGE_TYPES.BACKGROUND_CHANGE,
                            currentBannerType + 'Bg',
                            oldSettings,
                            {
                                type: 'image',
                                value: uploadedBackgroundImage,
                                opacity: opacity
                            },
                            { backgroundId: currentBannerType + 'Bg' }
                        );
                        
                        backgroundElement.style.backgroundImage = `url(${uploadedBackgroundImage})`;
                        backgroundElement.style.opacity = opacity;
                        
                        // Update settings
                        bannerSettings[currentBannerType] = {
                            type: 'image',
                            value: uploadedBackgroundImage,
                            opacity: opacity
                        };
                        
                        // Save to localStorage
                        localStorage.setItem('bannerBackgroundSettings', JSON.stringify(bannerSettings));
                        showToast(`ğŸ‰ ${bannerConfig[currentBannerType].name} èƒŒæ™¯å·²æ›´æ–°ï¼`);
                    }
                    
                    closeBackgroundUploadModal();
                }
            );
        }

        function resetToGradient() {
            if (!currentButtonType && !currentBannerType) return;
            
            if (currentButtonType) {
                // Handle button reset
                const backgroundElement = document.getElementById(currentButtonType + 'Bg');
                const config = buttonConfig[currentButtonType];
                
                // Reset to original gradient
                const gradientClass = `bg-gradient-to-br from-${config.color}-500 to-${config.color}-600`;
                backgroundElement.style.backgroundImage = '';
                backgroundElement.style.opacity = '1';
                backgroundElement.className = `absolute inset-0 ${gradientClass} hover:from-${config.color}-600 hover:to-${config.color}-700 transition-all bg-cover bg-center`;
                
                // Update settings
                backgroundSettings[currentButtonType] = {
                    type: 'gradient',
                    value: gradientClass
                };
                
                // Save to localStorage
                localStorage.setItem('buttonBackgroundSettings', JSON.stringify(backgroundSettings));
                showToast(`ğŸ”„ ${buttonConfig[currentButtonType].name} å·²æ¢å¤ä¸ºæ¸å˜èƒŒæ™¯ï¼`);
                
            } else if (currentBannerType) {
                // Handle banner reset
                const backgroundElement = document.getElementById(currentBannerType + 'Bg');
                const originalGradient = bannerSettings[currentBannerType].value;
                
                // Reset to original gradient
                backgroundElement.style.backgroundImage = '';
                backgroundElement.style.opacity = '1';
                backgroundElement.className = `absolute inset-0 ${originalGradient}`;
                
                // Update settings
                bannerSettings[currentBannerType] = {
                    type: 'gradient',
                    value: originalGradient
                };
                
                // Save to localStorage
                localStorage.setItem('bannerBackgroundSettings', JSON.stringify(bannerSettings));
                showToast(`ğŸ”„ ${bannerConfig[currentBannerType].name} å·²æ¢å¤ä¸ºæ¸å˜èƒŒæ™¯ï¼`);
            }
            
            closeBackgroundUploadModal();
        }

        function applyPresetBackground(presetType) {
            if (!currentButtonType && !currentBannerType) return;
            
            let presetStyle = '';
            
            switch(presetType) {
                case 'nature':
                    presetStyle = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%), url("data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%2310b981\' fill-opacity=\'0.1\'%3E%3Ccircle cx=\'30\' cy=\'30\' r=\'4\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")';
                    break;
                case 'ocean':
                    presetStyle = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    break;
                case 'sunset':
                    presetStyle = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                    break;
                case 'forest':
                    presetStyle = 'linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%)';
                    break;
                case 'sky':
                    presetStyle = 'linear-gradient(135deg, #87CEEB 0%, #4682B4 100%)';
                    break;
                case 'earth':
                    presetStyle = 'linear-gradient(135deg, #D2691E 0%, #8B4513 100%)';
                    break;
            }
            
            const presetNames = {
                nature: 'è‡ªç„¶',
                ocean: 'æµ·æ´‹',
                sunset: 'æ—¥è½',
                forest: 'æ£®æ—',
                sky: 'å¤©ç©º',
                earth: 'å¤§åœ°'
            };
            
            if (currentButtonType) {
                // Handle button preset
                const backgroundElement = document.getElementById(currentButtonType + 'Bg');
                backgroundElement.style.backgroundImage = presetStyle;
                backgroundElement.style.opacity = '1';
                
                // Update settings
                backgroundSettings[currentButtonType] = {
                    type: 'preset',
                    value: presetStyle,
                    preset: presetType
                };
                
                // Save to localStorage
                localStorage.setItem('buttonBackgroundSettings', JSON.stringify(backgroundSettings));
                showToast(`ğŸ¨ ${buttonConfig[currentButtonType].name} å·²åº”ç”¨${presetNames[presetType]}èƒŒæ™¯ï¼`);
                
            } else if (currentBannerType) {
                // Handle banner preset
                const backgroundElement = document.getElementById(currentBannerType + 'Bg');
                backgroundElement.style.backgroundImage = presetStyle;
                backgroundElement.style.opacity = '1';
                
                // Update settings
                bannerSettings[currentBannerType] = {
                    type: 'preset',
                    value: presetStyle,
                    preset: presetType
                };
                
                // Save to localStorage
                localStorage.setItem('bannerBackgroundSettings', JSON.stringify(bannerSettings));
                showToast(`ğŸ¨ ${bannerConfig[currentBannerType].name} å·²åº”ç”¨${presetNames[presetType]}èƒŒæ™¯ï¼`);
            }
            
            closeBackgroundUploadModal();
        }

        // Load saved background settings
        function loadSavedBackgrounds() {
            // Load button backgrounds
            const savedButtonSettings = localStorage.getItem('buttonBackgroundSettings');
            if (savedButtonSettings) {
                const settings = JSON.parse(savedButtonSettings);
                
                Object.entries(settings).forEach(([buttonType, setting]) => {
                    const backgroundElement = document.getElementById(buttonType + 'Bg');
                    if (backgroundElement) {
                        if (setting.type === 'image') {
                            backgroundElement.style.backgroundImage = `url(${setting.value})`;
                            backgroundElement.style.opacity = setting.opacity || '1';
                        } else if (setting.type === 'preset') {
                            backgroundElement.style.backgroundImage = setting.value;
                            backgroundElement.style.opacity = '1';
                        }
                        // Gradient backgrounds are already set by default
                    }
                });
                
                backgroundSettings = { ...backgroundSettings, ...settings };
            }
            
            // Load banner backgrounds
            const savedBannerSettings = localStorage.getItem('bannerBackgroundSettings');
            if (savedBannerSettings) {
                const settings = JSON.parse(savedBannerSettings);
                
                Object.entries(settings).forEach(([bannerType, setting]) => {
                    const backgroundElement = document.getElementById(bannerType + 'Bg');
                    if (backgroundElement) {
                        if (setting.type === 'image') {
                            backgroundElement.style.backgroundImage = `url(${setting.value})`;
                            backgroundElement.style.opacity = setting.opacity || '1';
                        } else if (setting.type === 'preset') {
                            backgroundElement.style.backgroundImage = setting.value;
                            backgroundElement.style.opacity = '1';
                        }
                        // Gradient backgrounds are already set by default
                    }
                });
                
                bannerSettings = { ...bannerSettings, ...settings };
            }
        }

        // Close logo editor when clicking outside
        document.addEventListener('click', function(event) {
            const logoContainer = document.getElementById('logoContainer');
            const logoEditor = document.getElementById('logoEditor');
            
            if (logoEditorVisible && !logoContainer.contains(event.target)) {
                logoEditor.classList.remove('show');
                logoEditorVisible = false;
            }
        });

        // Text editing system
        let isTextEditMode = false;
        let selectedTextElement = null;
        let currentlyEditing = null;
        
        // Undo/Redo system
        let changeHistory = [];
        let currentHistoryIndex = -1;
        const MAX_HISTORY = 50; // æœ€å¤šä¿å­˜50ä¸ªå†å²è®°å½•
        
        // Change types
        const CHANGE_TYPES = {
            TEXT_EDIT: 'text_edit',
            FONT_SIZE: 'font_size',
            FONT_STYLE: 'font_style',
            TEXT_ADD: 'text_add',
            TEXT_DELETE: 'text_delete',
            BACKGROUND_CHANGE: 'background_change',
            LOGO_CHANGE: 'logo_change'
        };
        
        // Emoji collections for picker
        const emojiCollections = {
            nature: ['ğŸŒ±', 'ğŸŒ¿', 'ğŸŒ³', 'ğŸŒ²', 'ğŸŒ´', 'ğŸŒµ', 'ğŸŒ¾', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸŒ¸', 'ğŸŒ¼', 'ğŸŒ™', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'â˜€ï¸', 'ğŸŒ¤ï¸', 'â›…', 'ğŸŒ¦ï¸', 'ğŸŒ§ï¸', 'â›ˆï¸', 'ğŸŒ©ï¸', 'â„ï¸', 'â˜ƒï¸', 'â›„', 'ğŸŒŠ', 'ğŸ’§', 'ğŸ”¥', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ'],
            objects: ['ğŸ“š', 'ğŸ“–', 'ğŸ“', 'âœï¸', 'ğŸ–Šï¸', 'ğŸ–ï¸', 'ğŸ“„', 'ğŸ“ƒ', 'ğŸ“‹', 'ğŸ“Š', 'ğŸ“ˆ', 'ğŸ“‰', 'ğŸ“Œ', 'ğŸ“', 'ğŸ“', 'ğŸ–‡ï¸', 'ğŸ“', 'ğŸ“', 'ğŸ”', 'ğŸ”', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ•¯ï¸', 'ğŸª”', 'ğŸ”‹', 'ğŸ”Œ', 'ğŸ’»', 'ğŸ–¥ï¸', 'ğŸ–¨ï¸', 'âŒ¨ï¸', 'ğŸ–±ï¸', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€'],
            symbols: ['âœ…', 'âŒ', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'âœ¨', 'ğŸ¯', 'ğŸª', 'ğŸ¨', 'ğŸ­', 'ğŸª', 'ğŸ¡', 'ğŸ¢', 'ğŸ ', 'ğŸ°', 'ğŸƒ', 'ğŸ²', 'ğŸ®', 'ğŸ•¹ï¸', 'ğŸ¸', 'ğŸº', 'ğŸ·', 'ğŸ»', 'ğŸ¥', 'ğŸ¤', 'ğŸ§', 'ğŸµ', 'ğŸ¶', 'ğŸ¼', 'ğŸ¹', 'ğŸ†', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'],
            faces: ['ğŸ˜Š', 'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ¤£', 'ğŸ˜‚', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ˜', 'ğŸ˜’', 'ğŸ˜']
        };
        
        // Undo/Redo system functions
        let pendingAction = null; // å­˜å‚¨å¾…ç¡®è®¤çš„æ“ä½œ
        
        function saveToHistory(changeType, elementId, oldValue, newValue, additionalData = {}) {
            // æ¸…é™¤å½“å‰ä½ç½®ä¹‹åçš„å†å²è®°å½•ï¼ˆå¦‚æœç”¨æˆ·åœ¨å†å²ä¸­é—´è¿›è¡Œäº†æ–°æ“ä½œï¼‰
            if (currentHistoryIndex < changeHistory.length - 1) {
                changeHistory = changeHistory.slice(0, currentHistoryIndex + 1);
            }
            
            const change = {
                id: Date.now() + Math.random(), // å”¯ä¸€ID
                timestamp: Date.now(),
                type: changeType,
                elementId: elementId,
                oldValue: oldValue,
                newValue: newValue,
                ...additionalData
            };
            
            changeHistory.push(change);
            currentHistoryIndex = changeHistory.length - 1;
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡
            if (changeHistory.length > MAX_HISTORY) {
                changeHistory.shift();
                currentHistoryIndex--;
            }
            
            updateHistoryButtons();
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('changeHistory', JSON.stringify(changeHistory));
            localStorage.setItem('currentHistoryIndex', currentHistoryIndex.toString());
        }
        
        function updateHistoryButtons() {
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            const historyStatus = document.getElementById('historyStatus');
            
            // æ›´æ–°æ’¤é”€æŒ‰é’®
            if (currentHistoryIndex >= 0) {
                undoBtn.disabled = false;
                undoBtn.className = 'bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs';
            } else {
                undoBtn.disabled = true;
                undoBtn.className = 'bg-gray-400 text-white px-3 py-1 rounded text-xs cursor-not-allowed';
            }
            
            // æ›´æ–°é‡åšæŒ‰é’®
            if (currentHistoryIndex < changeHistory.length - 1) {
                redoBtn.disabled = false;
                redoBtn.className = 'bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs';
            } else {
                redoBtn.disabled = true;
                redoBtn.className = 'bg-gray-400 text-white px-3 py-1 rounded text-xs cursor-not-allowed';
            }
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            if (changeHistory.length === 0) {
                historyStatus.textContent = 'æ— å†å²è®°å½•';
            } else {
                historyStatus.textContent = `${currentHistoryIndex + 1}/${changeHistory.length} æ­¥æ“ä½œ`;
            }
        }
        
        function undoChange() {
            if (currentHistoryIndex < 0) return;
            
            const change = changeHistory[currentHistoryIndex];
            applyChange(change, true); // trueè¡¨ç¤ºæ’¤é”€
            currentHistoryIndex--;
            updateHistoryButtons();
            
            showToast(`â†©ï¸ å·²æ’¤é”€ï¼š${getChangeDescription(change)}`);
        }
        
        function redoChange() {
            if (currentHistoryIndex >= changeHistory.length - 1) return;
            
            currentHistoryIndex++;
            const change = changeHistory[currentHistoryIndex];
            applyChange(change, false); // falseè¡¨ç¤ºé‡åš
            updateHistoryButtons();
            
            showToast(`â†ªï¸ å·²é‡åšï¼š${getChangeDescription(change)}`);
        }
        
        function applyChange(change, isUndo) {
            const element = document.getElementById(change.elementId) || 
                           document.querySelector(`[data-element-id="${change.elementId}"]`);
            
            switch (change.type) {
                case CHANGE_TYPES.TEXT_EDIT:
                    if (element) {
                        element.textContent = isUndo ? change.oldValue : change.newValue;
                    }
                    break;
                    
                case CHANGE_TYPES.FONT_SIZE:
                    if (element) {
                        element.style.fontSize = isUndo ? change.oldValue : change.newValue;
                    }
                    break;
                    
                case CHANGE_TYPES.FONT_STYLE:
                    if (element) {
                        const property = change.property;
                        element.style[property] = isUndo ? change.oldValue : change.newValue;
                    }
                    break;
                    
                case CHANGE_TYPES.TEXT_ADD:
                    if (isUndo && element) {
                        element.remove();
                    } else if (!isUndo && !element) {
                        // é‡æ–°åˆ›å»ºå…ƒç´ 
                        recreateTextElement(change);
                    }
                    break;
                    
                case CHANGE_TYPES.TEXT_DELETE:
                    if (isUndo && !element) {
                        // é‡æ–°åˆ›å»ºè¢«åˆ é™¤çš„å…ƒç´ 
                        recreateTextElement(change);
                    } else if (!isUndo && element) {
                        element.remove();
                    }
                    break;
                    
                case CHANGE_TYPES.BACKGROUND_CHANGE:
                    applyBackgroundChange(change, isUndo);
                    break;
                    
                case CHANGE_TYPES.LOGO_CHANGE:
                    applyLogoChange(change, isUndo);
                    break;
            }
        }
        
        function recreateTextElement(change) {
            const container = document.querySelector(change.containerSelector);
            if (container) {
                const element = document.createElement('div');
                element.className = change.className;
                element.textContent = change.textContent;
                element.setAttribute('data-element-id', change.elementId);
                container.appendChild(element);
                
                // å¦‚æœåœ¨ç¼–è¾‘æ¨¡å¼ï¼Œæ·»åŠ ç¼–è¾‘åŠŸèƒ½
                if (isTextEditMode) {
                    element.classList.add('editable-text');
                    element.addEventListener('click', handleTextElementClick);
                }
            }
        }
        
        function applyBackgroundChange(change, isUndo) {
            const element = document.getElementById(change.backgroundId);
            if (element) {
                const targetValue = isUndo ? change.oldValue : change.newValue;
                if (targetValue.type === 'image') {
                    element.style.backgroundImage = `url(${targetValue.value})`;
                    element.style.opacity = targetValue.opacity || '1';
                } else {
                    element.style.backgroundImage = '';
                    element.style.opacity = '1';
                    element.className = targetValue.className;
                }
            }
        }
        
        function applyLogoChange(change, isUndo) {
            const logo = document.getElementById('mecccLogo');
            const placeholder = document.getElementById('logoPlaceholder');
            const targetValue = isUndo ? change.oldValue : change.newValue;
            
            if (targetValue.src) {
                logo.src = targetValue.src;
                logo.style.width = targetValue.size + 'px';
                logo.style.height = targetValue.size + 'px';
                logo.className = targetValue.className;
                logo.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                logo.classList.add('hidden');
                placeholder.classList.remove('hidden');
            }
        }
        
        function getChangeDescription(change) {
            switch (change.type) {
                case CHANGE_TYPES.TEXT_EDIT:
                    return 'æ–‡å­—ç¼–è¾‘';
                case CHANGE_TYPES.FONT_SIZE:
                    return 'å­—ä½“å¤§å°è°ƒæ•´';
                case CHANGE_TYPES.FONT_STYLE:
                    return 'å­—ä½“æ ·å¼ä¿®æ”¹';
                case CHANGE_TYPES.TEXT_ADD:
                    return 'æ·»åŠ æ–‡å­—å…ƒç´ ';
                case CHANGE_TYPES.TEXT_DELETE:
                    return 'åˆ é™¤æ–‡å­—å…ƒç´ ';
                case CHANGE_TYPES.BACKGROUND_CHANGE:
                    return 'èƒŒæ™¯ä¿®æ”¹';
                case CHANGE_TYPES.LOGO_CHANGE:
                    return 'Logoä¿®æ”¹';
                default:
                    return 'æœªçŸ¥æ“ä½œ';
            }
        }
        
        function showConfirmation(message, details, icon, action) {
            pendingAction = action;
            
            document.getElementById('confirmationMessage').textContent = message;
            document.getElementById('changeDetails').textContent = details;
            document.getElementById('confirmationIcon').textContent = icon;
            document.getElementById('confirmationModal').classList.remove('hidden');
        }
        
        function closeConfirmationModal() {
            document.getElementById('confirmationModal').classList.add('hidden');
            pendingAction = null;
        }
        
        function confirmAction() {
            if (pendingAction) {
                pendingAction();
                pendingAction = null;
            }
            closeConfirmationModal();
        }
        
        // Load history from localStorage
        function loadChangeHistory() {
            const savedHistory = localStorage.getItem('changeHistory');
            const savedIndex = localStorage.getItem('currentHistoryIndex');
            
            if (savedHistory) {
                try {
                    changeHistory = JSON.parse(savedHistory);
                    currentHistoryIndex = savedIndex ? parseInt(savedIndex) : -1;
                    updateHistoryButtons();
                } catch (e) {
                    console.log('Failed to load change history');
                    changeHistory = [];
                    currentHistoryIndex = -1;
                }
            }
        }

        // Admin access functions
        const ADMIN_PASSWORD = "admin2024"; // å¯ä»¥æ›´æ”¹ä¸ºæ›´å¤æ‚çš„å¯†ç 
        let adminAccessAttempts = 0;
        const MAX_ATTEMPTS = 3;
        
        function showAdminAccessModal() {
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¯ç®¡ç†å‘˜æ¨¡å¼
            if (isAdminMode) {
                // å¦‚æœå·²ç»æ˜¯ç®¡ç†å‘˜æ¨¡å¼ï¼Œç›´æ¥é€€å‡º
                exitAdminMode();
                return;
            }
            
            // æ£€æŸ¥å°è¯•æ¬¡æ•°
            if (adminAccessAttempts >= MAX_ATTEMPTS) {
                showToast('ğŸš« è®¿é—®å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•ã€‚');
                return;
            }
            
            document.getElementById('adminAccessModal').classList.remove('hidden');
            document.getElementById('adminAccessPassword').focus();
        }
        
        function closeAdminAccessModal() {
            document.getElementById('adminAccessModal').classList.add('hidden');
            document.getElementById('adminAccessPassword').value = '';
        }
        
        function verifyAdminAccess(event) {
            event.preventDefault();
            const password = document.getElementById('adminAccessPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                // å¯†ç æ­£ç¡®ï¼Œè¿›å…¥ç®¡ç†å‘˜æ¨¡å¼
                enterAdminMode();
                closeAdminAccessModal();
                adminAccessAttempts = 0; // é‡ç½®å°è¯•æ¬¡æ•°
            } else {
                // å¯†ç é”™è¯¯
                adminAccessAttempts++;
                const remainingAttempts = MAX_ATTEMPTS - adminAccessAttempts;
                
                if (remainingAttempts > 0) {
                    showToast(`âŒ å¯†ç é”™è¯¯ï¼è¿˜æœ‰ ${remainingAttempts} æ¬¡å°è¯•æœºä¼šã€‚`);
                    document.getElementById('adminAccessPassword').value = '';
                    document.getElementById('adminAccessPassword').focus();
                } else {
                    showToast('ğŸš« å¯†ç é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼Œè®¿é—®å·²è¢«æš‚æ—¶é”å®šã€‚');
                    closeAdminAccessModal();
                    
                    // 5åˆ†é’Ÿåé‡ç½®å°è¯•æ¬¡æ•°
                    setTimeout(() => {
                        adminAccessAttempts = 0;
                        showToast('ğŸ”“ ç®¡ç†å‘˜è®¿é—®å·²è§£é”ï¼Œå¯ä»¥é‡æ–°å°è¯•ã€‚');
                    }, 300000); // 5åˆ†é’Ÿ
                }
            }
        }
        
        function enterAdminMode() {
            isAdminMode = true;
            const adminElements = document.querySelectorAll('.admin-only');
            const adminModeText = document.getElementById('adminModeText');
            
            // Show admin controls
            adminElements.forEach(element => {
                element.classList.remove('hidden');
            });
            adminModeText.innerHTML = 'ğŸšª é€€å‡ºç®¡ç†å‘˜æ¨¡å¼';
            
            // Save admin mode state
            localStorage.setItem('adminModeEnabled', 'true');
            localStorage.setItem('adminModeTimestamp', Date.now().toString());
            
            showToast('ğŸ”§ ç®¡ç†å‘˜æ¨¡å¼å·²å¯ç”¨ï¼ç°åœ¨å¯ä»¥è‡ªå®šä¹‰æ‰€æœ‰èƒŒæ™¯å’ŒLogoã€‚ç‚¹å‡»å³ä¸Šè§’æŒ‰é’®å¯é€€å‡ºã€‚');
            
            // è‡ªåŠ¨é€€å‡ºæœºåˆ¶ï¼š30åˆ†é’Ÿåè‡ªåŠ¨é€€å‡ºç®¡ç†å‘˜æ¨¡å¼
            setTimeout(() => {
                if (isAdminMode) {
                    exitAdminMode();
                    showToast('â° ç®¡ç†å‘˜æ¨¡å¼å·²è‡ªåŠ¨é€€å‡ºï¼ˆ30åˆ†é’Ÿè¶…æ—¶ï¼‰ã€‚');
                }
            }, 1800000); // 30åˆ†é’Ÿ
        }
        
        function exitAdminMode() {
            isAdminMode = false;
            const adminElements = document.querySelectorAll('.admin-only');
            const adminModeText = document.getElementById('adminModeText');
            
            // Hide admin controls
            adminElements.forEach(element => {
                element.classList.add('hidden');
            });
            adminModeText.innerHTML = 'ğŸ”§ Admin Access';
            
            // Clear admin mode state
            localStorage.removeItem('adminModeEnabled');
            localStorage.removeItem('adminModeTimestamp');
            
            showToast('ğŸ‘¤ å·²é€€å‡ºç®¡ç†å‘˜æ¨¡å¼ã€‚è‡ªå®šä¹‰åŠŸèƒ½å·²éšè—ã€‚');
        }
        
        // Load admin mode state on page load
        function loadAdminModeState() {
            const savedAdminMode = localStorage.getItem('adminModeEnabled');
            const savedTimestamp = localStorage.getItem('adminModeTimestamp');
            
            if (savedAdminMode === 'true' && savedTimestamp) {
                const currentTime = Date.now();
                const savedTime = parseInt(savedTimestamp);
                const timeDiff = currentTime - savedTime;
                
                // æ£€æŸ¥æ˜¯å¦è¶…è¿‡30åˆ†é’Ÿï¼ˆ1800000æ¯«ç§’ï¼‰
                if (timeDiff < 1800000) {
                    // æœªè¶…æ—¶ï¼Œæ¢å¤ç®¡ç†å‘˜æ¨¡å¼
                    isAdminMode = true;
                    const adminElements = document.querySelectorAll('.admin-only');
                    const adminModeText = document.getElementById('adminModeText');
                    
                    adminElements.forEach(element => {
                        element.classList.remove('hidden');
                    });
                    adminModeText.innerHTML = 'ğŸšª é€€å‡ºç®¡ç†å‘˜æ¨¡å¼';
                    
                    // è®¡ç®—å‰©ä½™æ—¶é—´å¹¶è®¾ç½®è‡ªåŠ¨é€€å‡º
                    const remainingTime = 1800000 - timeDiff;
                    setTimeout(() => {
                        if (isAdminMode) {
                            exitAdminMode();
                            showToast('â° ç®¡ç†å‘˜æ¨¡å¼å·²è‡ªåŠ¨é€€å‡ºï¼ˆ30åˆ†é’Ÿè¶…æ—¶ï¼‰ã€‚');
                        }
                    }, remainingTime);
                    
                    showToast(`ğŸ”§ ç®¡ç†å‘˜æ¨¡å¼å·²æ¢å¤ã€‚å°†åœ¨ ${Math.ceil(remainingTime / 60000)} åˆ†é’Ÿåè‡ªåŠ¨é€€å‡ºã€‚`);
                } else {
                    // å·²è¶…æ—¶ï¼Œæ¸…é™¤çŠ¶æ€
                    localStorage.removeItem('adminModeEnabled');
                    localStorage.removeItem('adminModeTimestamp');
                }
            }
        }

        // Toolbar dragging functionality
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let isToolbarCollapsed = false;
        
        function initializeToolbarDragging() {
            const toolbar = document.getElementById('textEditToolbar');
            const header = document.getElementById('toolbarHeader');
            
            header.addEventListener('mousedown', function(e) {
                isDragging = true;
                const rect = toolbar.getBoundingClientRect();
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;
                
                document.addEventListener('mousemove', handleToolbarDrag);
                document.addEventListener('mouseup', stopToolbarDrag);
                
                // Prevent text selection while dragging
                e.preventDefault();
            });
        }
        
        function handleToolbarDrag(e) {
            if (!isDragging) return;
            
            const toolbar = document.getElementById('textEditToolbar');
            const newX = e.clientX - dragOffset.x;
            const newY = e.clientY - dragOffset.y;
            
            // Keep toolbar within viewport bounds
            const maxX = window.innerWidth - toolbar.offsetWidth;
            const maxY = window.innerHeight - toolbar.offsetHeight;
            
            const constrainedX = Math.max(0, Math.min(newX, maxX));
            const constrainedY = Math.max(0, Math.min(newY, maxY));
            
            toolbar.style.left = constrainedX + 'px';
            toolbar.style.top = constrainedY + 'px';
            toolbar.style.right = 'auto'; // Remove right positioning
        }
        
        function stopToolbarDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', handleToolbarDrag);
            document.removeEventListener('mouseup', stopToolbarDrag);
        }
        
        function toggleToolbarCollapse() {
            const toolbarContent = document.getElementById('toolbarContent');
            const collapseBtn = document.getElementById('collapseBtn');
            
            isToolbarCollapsed = !isToolbarCollapsed;
            
            if (isToolbarCollapsed) {
                toolbarContent.style.display = 'none';
                collapseBtn.textContent = 'â•';
                collapseBtn.title = 'å±•å¼€å·¥å…·æ ';
            } else {
                toolbarContent.style.display = 'block';
                collapseBtn.textContent = 'â–';
                collapseBtn.title = 'æŠ˜å å·¥å…·æ ';
            }
        }

        // Text editing functions
        function toggleTextEditMode() {
            isTextEditMode = !isTextEditMode;
            const textEditModeText = document.getElementById('textEditModeText');
            const textEditToolbar = document.getElementById('textEditToolbar');
            const body = document.body;
            
            if (isTextEditMode) {
                // Enter text edit mode
                body.classList.add('text-edit-mode');
                textEditModeText.textContent = 'ğŸšª é€€å‡ºæ–‡å­—ç¼–è¾‘';
                textEditToolbar.classList.remove('hidden');
                
                // Initialize dragging functionality
                initializeToolbarDragging();
                
                // Make text elements editable
                makeTextElementsEditable();
                
                showToast('âœï¸ æ–‡å­—ç¼–è¾‘æ¨¡å¼å·²å¯ç”¨ï¼å·¥å…·æ å¯æ‹–æ‹½å’ŒæŠ˜å ã€‚ç‚¹å‡»æ–‡å­—ç›´æ¥ç¼–è¾‘ï¼ŒEnterä¿å­˜ï¼ŒEscå–æ¶ˆã€‚');
            } else {
                // Exit text edit mode
                body.classList.remove('text-edit-mode');
                textEditModeText.textContent = 'âœï¸ æ–‡å­—ç¼–è¾‘æ¨¡å¼';
                textEditToolbar.classList.add('hidden');
                
                // Remove editable classes
                removeTextEditability();
                
                // Clear selection
                clearSelection();
                
                showToast('ğŸ‘¤ å·²é€€å‡ºæ–‡å­—ç¼–è¾‘æ¨¡å¼ã€‚æ‰€æœ‰ç¼–è¾‘åŠŸèƒ½å·²å…³é—­ã€‚');
            }
        }
        
        function makeTextElementsEditable() {
            // Find all text elements that can be edited
            const textSelectors = [
                'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'span', 'div', 'button', 'a', 'li'
            ];
            
            textSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    // Skip elements that are part of the editing interface
                    if (element.closest('#textEditToolbar') || 
                        element.closest('#emojiPickerModal') || 
                        element.closest('#textInputModal') ||
                        element.closest('#toast') ||
                        element.classList.contains('admin-only')) {
                        return;
                    }
                    
                    // Skip elements that contain only other elements (no direct text)
                    if (element.children.length > 0 && !hasDirectTextContent(element)) {
                        return;
                    }
                    
                    element.classList.add('editable-text');
                    
                    // ä½¿ç”¨æ•è·é˜¶æ®µçš„äº‹ä»¶ç›‘å¬å™¨ï¼Œç¡®ä¿ä¼˜å…ˆå¤„ç†
                    element.addEventListener('click', handleTextElementClick, true);
                    
                    // å¦‚æœæ˜¯æŒ‰é’®å†…çš„æ–‡å­—ï¼Œæ·»åŠ é¢å¤–çš„ä¿æŠ¤
                    if (element.closest('button')) {
                        element.addEventListener('mousedown', function(e) {
                            if (isTextEditMode) {
                                e.preventDefault();
                                e.stopPropagation();
                                e.stopImmediatePropagation();
                            }
                        }, true);
                        
                        element.addEventListener('mouseup', function(e) {
                            if (isTextEditMode) {
                                e.preventDefault();
                                e.stopPropagation();
                                e.stopImmediatePropagation();
                            }
                        }, true);
                    }
                });
            });
        }
        
        function hasDirectTextContent(element) {
            for (let node of element.childNodes) {
                if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
                    return true;
                }
            }
            return false;
        }
        
        function removeTextEditability() {
            const editableElements = document.querySelectorAll('.editable-text');
            editableElements.forEach(element => {
                element.classList.remove('editable-text', 'selected', 'editing');
                element.removeEventListener('click', handleTextElementClick);
            });
        }
        
        function handleTextElementClick(event) {
            if (!isTextEditMode) return;
            
            // å¼ºåˆ¶é˜»æ­¢æ‰€æœ‰äº‹ä»¶ä¼ æ’­å’Œé»˜è®¤è¡Œä¸º
            event.preventDefault();
            event.stopPropagation();
            event.stopImmediatePropagation();
            
            // é˜²æ­¢åœ¨è¡¨æ ¼ã€æ¨¡æ€æ¡†ç­‰ç‰¹æ®ŠåŒºåŸŸè¿›è¡Œç¼–è¾‘
            const element = event.target;
            if (element.closest('table') || 
                element.closest('.modal-backdrop') || 
                element.closest('#textEditToolbar') ||
                element.closest('.edit-controls') ||
                element.classList.contains('inline-editor')) {
                showToast('âš ï¸ æ­¤åŒºåŸŸä¸æ”¯æŒæ–‡å­—ç¼–è¾‘');
                return false;
            }
            
            // ç‰¹åˆ«æ£€æŸ¥æ˜¯å¦åœ¨æŒ‰é’®å†…éƒ¨
            const parentButton = element.closest('button');
            if (parentButton) {
                // å¦‚æœåœ¨æŒ‰é’®å†…éƒ¨ï¼Œä¸´æ—¶ç¦ç”¨æŒ‰é’®åŠŸèƒ½
                const originalOnClick = parentButton.onclick;
                const originalHref = parentButton.getAttribute('onclick');
                
                // ä¸´æ—¶ç§»é™¤æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                parentButton.onclick = null;
                parentButton.removeAttribute('onclick');
                parentButton.style.pointerEvents = 'none';
                
                // åœ¨ç¼–è¾‘å®Œæˆåæ¢å¤æŒ‰é’®åŠŸèƒ½
                const restoreButton = () => {
                    if (originalOnClick) {
                        parentButton.onclick = originalOnClick;
                    }
                    if (originalHref) {
                        parentButton.setAttribute('onclick', originalHref);
                    }
                    parentButton.style.pointerEvents = '';
                };
                
                // å­˜å‚¨æ¢å¤å‡½æ•°ä»¥ä¾¿åç»­ä½¿ç”¨
                element.restoreParentButton = restoreButton;
            }
            
            // Clear previous selection
            clearSelection();
            
            // Select current element
            selectedTextElement = element;
            selectedTextElement.classList.add('selected');
            
            // Update selection info
            updateSelectionInfo();
            
            // Start inline editing with delay to ensure proper focus
            setTimeout(() => {
                startInlineEditing(selectedTextElement);
            }, 100);
            
            return false;
        }
        
        function clearSelection() {
            if (selectedTextElement) {
                // æ¢å¤çˆ¶æŒ‰é’®åŠŸèƒ½
                if (selectedTextElement.restoreParentButton) {
                    selectedTextElement.restoreParentButton();
                    delete selectedTextElement.restoreParentButton;
                }
                
                selectedTextElement.classList.remove('selected', 'editing');
                selectedTextElement = null;
            }
            
            // Hide selection info
            document.getElementById('selectionInfo').classList.add('hidden');
            
            // Clear any existing inline editors
            const existingEditors = document.querySelectorAll('.inline-editor');
            existingEditors.forEach(editor => {
                const parent = editor.parentNode.parentNode; // å› ä¸ºæœ‰wrapper
                if (parent && parent.restoreParentButton) {
                    parent.restoreParentButton();
                    delete parent.restoreParentButton;
                }
                
                const originalContent = editor.originalHTML || editor.originalText || editor.value;
                if (parent) {
                    parent.innerHTML = originalContent;
                    parent.classList.remove('editing');
                }
            });
            
            currentlyEditing = null;
        }
        
        function updateSelectionInfo() {
            const selectionInfo = document.getElementById('selectionInfo');
            const selectedElementInfo = document.getElementById('selectedElementInfo');
            
            if (selectedTextElement) {
                const tagName = selectedTextElement.tagName.toLowerCase();
                const textContent = selectedTextElement.textContent.substring(0, 30) + '...';
                selectedElementInfo.textContent = `${tagName}: "${textContent}"`;
                selectionInfo.classList.remove('hidden');
            }
        }
        
        function startInlineEditing(element) {
            if (currentlyEditing) return;
            
            currentlyEditing = element;
            element.classList.add('editing');
            
            const originalText = element.textContent.trim();
            const isMultiline = originalText.length > 50 || originalText.includes('\n');
            
            // Create editor with better visibility
            const editor = document.createElement(isMultiline ? 'textarea' : 'input');
            editor.className = 'inline-editor';
            editor.value = originalText;
            
            if (isMultiline) {
                editor.rows = Math.min(Math.max(3, originalText.split('\n').length), 8);
            } else {
                editor.type = 'text';
            }
            
            // Store original content and replace element content directly
            const originalHTML = element.innerHTML;
            element.innerHTML = '';
            element.appendChild(editor);
            
            // Focus and select with delay
            setTimeout(() => {
                editor.focus();
                editor.select();
            }, 50);
            
            // ç®€åŒ–çš„äº‹ä»¶å¤„ç† - åªå¤„ç†å¿…è¦çš„é”®ç›˜äº‹ä»¶
            editor.addEventListener('keydown', function(e) {
                e.stopPropagation();
                e.stopImmediatePropagation();
                
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveInlineEdit(); // Enteré”®ç›´æ¥ä¿å­˜
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelInlineEdit(); // Escé”®å–æ¶ˆ
                }
            }, true);
            
            // å¤±å»ç„¦ç‚¹æ—¶è‡ªåŠ¨ä¿å­˜
            editor.addEventListener('blur', function(e) {
                // å»¶è¿Ÿæ£€æŸ¥ï¼Œé¿å…ç‚¹å‡»å…¶ä»–å…ƒç´ æ—¶è¯¯è§¦å‘
                setTimeout(() => {
                    if (currentlyEditing && document.querySelector('.inline-editor')) {
                        saveInlineEdit();
                    }
                }, 100);
            });
            
            // é˜»æ­¢äº‹ä»¶ä¼ æ’­
            ['keyup', 'keypress', 'input', 'paste', 'cut', 'copy', 'click'].forEach(eventType => {
                editor.addEventListener(eventType, function(e) {
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                }, true);
            });
            
            // Store original data for cancel
            editor.originalText = originalText;
            editor.originalHTML = originalHTML;
        }
        
        function saveInlineEdit() {
            if (!currentlyEditing) return;
            
            const editor = currentlyEditing.querySelector('.inline-editor');
            if (!editor) return;
            
            const newText = editor.value.trim();
            const oldText = editor.originalText || '';
            
            // ç«‹å³æ›´æ–°æ˜¾ç¤ºå†…å®¹
            currentlyEditing.innerHTML = newText || oldText;
            
            if (newText && newText !== oldText) {
                // ä¿å­˜åˆ°å†å²è®°å½•
                const elementId = currentlyEditing.id || `element_${Date.now()}`;
                if (!currentlyEditing.id) {
                    currentlyEditing.id = elementId;
                }
                
                saveToHistory(
                    CHANGE_TYPES.TEXT_EDIT,
                    elementId,
                    oldText,
                    newText
                );
                
                showToast('âœ… æ–‡å­—å·²ä¿å­˜ï¼ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ');
            } else if (!newText) {
                // å¦‚æœå†…å®¹ä¸ºç©ºï¼Œæ¢å¤åŸæ–‡
                currentlyEditing.innerHTML = oldText;
                showToast('âš ï¸ å†…å®¹ä¸ºç©ºï¼Œå·²æ¢å¤åŸæ–‡');
            } else {
                showToast('ğŸ’¡ æ–‡å­—å†…å®¹æœªæ”¹å˜');
            }
            
            // æ¸…ç†ç¼–è¾‘çŠ¶æ€
            finishEditing();
        }
        
        function finishEditing() {
            if (!currentlyEditing) return;
            
            // æ¢å¤çˆ¶æŒ‰é’®åŠŸèƒ½
            if (currentlyEditing.restoreParentButton) {
                setTimeout(() => {
                    currentlyEditing.restoreParentButton();
                    delete currentlyEditing.restoreParentButton;
                }, 50);
            }
            
            // æ¸…ç†ç¼–è¾‘çŠ¶æ€
            currentlyEditing.classList.remove('editing');
            
            // å¦‚æœä»åœ¨æ–‡å­—ç¼–è¾‘æ¨¡å¼ï¼Œä¿æŒé€‰ä¸­çŠ¶æ€
            if (isTextEditMode) {
                currentlyEditing.classList.add('selected');
                selectedTextElement = currentlyEditing;
                updateSelectionInfo();
            } else {
                currentlyEditing.classList.remove('selected');
                selectedTextElement = null;
            }
            
            currentlyEditing = null;
        }
        
        function cancelInlineEdit() {
            if (!currentlyEditing) return;
            
            const editor = currentlyEditing.querySelector('.inline-editor');
            const originalText = editor ? editor.originalText : '';
            const originalHTML = editor ? editor.originalHTML : '';
            
            // ç«‹å³æ¢å¤åŸå§‹å†…å®¹
            if (originalHTML) {
                currentlyEditing.innerHTML = originalHTML;
            } else if (originalText) {
                currentlyEditing.textContent = originalText;
            }
            
            showToast('âŒ ç¼–è¾‘å·²å–æ¶ˆï¼Œå†…å®¹å·²æ¢å¤');
            
            // æ¸…ç†ç¼–è¾‘çŠ¶æ€
            finishEditing();
        }
        
        // Font size functions
        function changeFontSize(direction) {
            if (!selectedTextElement) {
                showToast('âš ï¸ è¯·å…ˆé€‰æ‹©è¦ä¿®æ”¹çš„æ–‡å­—å…ƒç´ ');
                return;
            }
            
            const element = selectedTextElement;
            const currentSize = window.getComputedStyle(element).fontSize;
            const currentSizePx = parseFloat(currentSize);
            
            let newSize;
            if (direction === 'larger') {
                newSize = Math.min(currentSizePx * 1.2, 72); // Max 72px
            } else {
                newSize = Math.max(currentSizePx * 0.8, 10); // Min 10px
            }
            
            const actionText = direction === 'larger' ? 'å¢å¤§' : 'å‡å°';
            const message = `æ‚¨ç¡®å®šè¦${actionText}é€‰ä¸­æ–‡å­—çš„å­—ä½“å¤§å°å—ï¼Ÿ`;
            const details = `å½“å‰å¤§å°ï¼š${Math.round(currentSizePx)}px â†’ æ–°å¤§å°ï¼š${Math.round(newSize)}px`;
            
            showConfirmation(message, details, 'ğŸ“', () => {
                // ä¿å­˜åˆ°å†å²è®°å½•
                const elementId = element.id || `element_${Date.now()}`;
                if (!element.id) {
                    element.id = elementId;
                }
                
                saveToHistory(
                    CHANGE_TYPES.FONT_SIZE,
                    elementId,
                    currentSize,
                    newSize + 'px'
                );
                
                element.style.fontSize = newSize + 'px';
                showToast(`ğŸ“ å­—ä½“å¤§å°å·²è°ƒæ•´ä¸º ${Math.round(newSize)}px`);
            });
        }
        
        function resetFontSize() {
            if (!selectedTextElement) {
                showToast('âš ï¸ è¯·å…ˆé€‰æ‹©è¦é‡ç½®çš„æ–‡å­—å…ƒç´ ');
                return;
            }
            
            selectedTextElement.style.fontSize = '';
            showToast('ğŸ”„ å­—ä½“å¤§å°å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
        }
        
        // Text style functions
        function toggleBold() {
            if (!selectedTextElement) {
                showToast('âš ï¸ è¯·å…ˆé€‰æ‹©è¦ä¿®æ”¹çš„æ–‡å­—å…ƒç´ ');
                return;
            }
            
            const element = selectedTextElement;
            const currentWeight = window.getComputedStyle(element).fontWeight;
            const isBold = currentWeight === 'bold' || parseInt(currentWeight) >= 600;
            const newWeight = isBold ? 'normal' : 'bold';
            const actionText = isBold ? 'å–æ¶ˆç²—ä½“' : 'è®¾ç½®ä¸ºç²—ä½“';
            
            showConfirmation(
                `æ‚¨ç¡®å®šè¦${actionText}å—ï¼Ÿ`,
                `å½“å‰çŠ¶æ€ï¼š${isBold ? 'ç²—ä½“' : 'æ­£å¸¸'} â†’ æ–°çŠ¶æ€ï¼š${isBold ? 'æ­£å¸¸' : 'ç²—ä½“'}`,
                'ğŸ“',
                () => {
                    const elementId = element.id || `element_${Date.now()}`;
                    if (!element.id) {
                        element.id = elementId;
                    }
                    
                    saveToHistory(
                        CHANGE_TYPES.FONT_STYLE,
                        elementId,
                        currentWeight,
                        newWeight,
                        { property: 'fontWeight' }
                    );
                    
                    element.style.fontWeight = newWeight;
                    showToast(`ğŸ“ å·²${actionText}`);
                }
            );
        }
        
        function toggleItalic() {
            if (!selectedTextElement) {
                showToast('âš ï¸ è¯·å…ˆé€‰æ‹©è¦ä¿®æ”¹çš„æ–‡å­—å…ƒç´ ');
                return;
            }
            
            const element = selectedTextElement;
            const currentStyle = window.getComputedStyle(element).fontStyle;
            const isItalic = currentStyle === 'italic';
            const newStyle = isItalic ? 'normal' : 'italic';
            const actionText = isItalic ? 'å–æ¶ˆæ–œä½“' : 'è®¾ç½®ä¸ºæ–œä½“';
            
            showConfirmation(
                `æ‚¨ç¡®å®šè¦${actionText}å—ï¼Ÿ`,
                `å½“å‰çŠ¶æ€ï¼š${isItalic ? 'æ–œä½“' : 'æ­£å¸¸'} â†’ æ–°çŠ¶æ€ï¼š${isItalic ? 'æ­£å¸¸' : 'æ–œä½“'}`,
                'ğŸ“',
                () => {
                    const elementId = element.id || `element_${Date.now()}`;
                    if (!element.id) {
                        element.id = elementId;
                    }
                    
                    saveToHistory(
                        CHANGE_TYPES.FONT_STYLE,
                        elementId,
                        currentStyle,
                        newStyle,
                        { property: 'fontStyle' }
                    );
                    
                    element.style.fontStyle = newStyle;
                    showToast(`ğŸ“ å·²${actionText}`);
                }
            );
        }
        
        // Emoji functions
        function insertEmoji(emoji) {
            if (!selectedTextElement) {
                showToast('âš ï¸ è¯·å…ˆé€‰æ‹©è¦æ’å…¥è¡¨æƒ…çš„æ–‡å­—å…ƒç´ ');
                return;
            }
            
            const element = selectedTextElement;
            element.textContent = element.textContent + emoji;
            showToast(`ğŸ˜Š å·²æ’å…¥è¡¨æƒ…ï¼š${emoji}`);
        }
        
        function showEmojiPicker() {
            document.getElementById('emojiPickerModal').classList.remove('hidden');
            showEmojiCategory('nature'); // Default to nature category
        }
        
        function closeEmojiPicker() {
            document.getElementById('emojiPickerModal').classList.add('hidden');
        }
        
        function showEmojiCategory(category) {
            const emojiGrid = document.getElementById('emojiGrid');
            const emojis = emojiCollections[category] || emojiCollections.nature;
            
            emojiGrid.innerHTML = '';
            emojis.forEach(emoji => {
                const button = document.createElement('button');
                button.textContent = emoji;
                button.className = 'hover:bg-gray-100 rounded p-2 transition-colors';
                button.onclick = () => {
                    insertEmoji(emoji);
                    closeEmojiPicker();
                };
                emojiGrid.appendChild(button);
            });
        }
        
        // Text management functions
        function addTextElement() {
            document.getElementById('textInputModal').classList.remove('hidden');
        }
        
        function closeTextInputModal() {
            document.getElementById('textInputModal').classList.add('hidden');
            document.getElementById('newTextContent').value = '';
        }
        
        function createNewTextElement(event) {
            event.preventDefault();
            
            const content = document.getElementById('newTextContent').value;
            const size = document.getElementById('textSize').value;
            const color = document.getElementById('textColor').value;
            const position = document.getElementById('textPosition').value;
            
            // Create new text element
            const textElement = document.createElement('div');
            textElement.className = `custom-text-element ${size} ${color} font-medium`;
            textElement.textContent = content;
            
            // Find target container
            let targetContainer;
            switch(position) {
                case 'header':
                    targetContainer = document.querySelector('header .max-w-7xl');
                    break;
                case 'hero':
                    targetContainer = document.querySelector('.hero-bg .max-w-7xl');
                    break;
                case 'features':
                    targetContainer = document.querySelector('.glass-effect .max-w-7xl');
                    break;
                case 'competition':
                    targetContainer = document.querySelector('.section-bg .max-w-7xl');
                    break;
                case 'partnership':
                    targetContainer = document.querySelector('.py-16.glass-effect .max-w-7xl');
                    break;
                default:
                    targetContainer = document.querySelector('.hero-bg .max-w-7xl');
            }
            
            if (targetContainer) {
                targetContainer.appendChild(textElement);
                
                // If in edit mode, make it editable
                if (isTextEditMode) {
                    textElement.classList.add('editable-text');
                    textElement.addEventListener('click', handleTextElementClick);
                }
                
                showToast(`âœ… æ–°æ–‡å­—å·²æ·»åŠ åˆ°${getPositionName(position)}ï¼`);
            } else {
                showToast('âŒ æ— æ³•æ‰¾åˆ°ç›®æ ‡ä½ç½®ï¼Œæ–‡å­—æ·»åŠ å¤±è´¥');
            }
            
            closeTextInputModal();
        }
        
        function getPositionName(position) {
            const names = {
                header: 'HeaderåŒºåŸŸ',
                hero: 'HeroåŒºåŸŸ',
                features: 'åŠŸèƒ½åŒºåŸŸ',
                competition: 'ç«èµ›åŒºåŸŸ',
                partnership: 'åˆä½œåŒºåŸŸ'
            };
            return names[position] || 'HeroåŒºåŸŸ';
        }
        
        function deleteSelectedText() {
            if (!selectedTextElement) {
                showToast('âš ï¸ è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ–‡å­—å…ƒç´ ');
                return;
            }
            
            const element = selectedTextElement;
            const isCustomElement = element.classList.contains('custom-text-element');
            const actionText = isCustomElement ? 'å®Œå…¨åˆ é™¤æ­¤è‡ªå®šä¹‰æ–‡å­—å…ƒç´ ' : 'æ¸…ç©ºæ­¤ç³»ç»Ÿæ–‡å­—çš„å†…å®¹';
            const warningText = isCustomElement ? 'åˆ é™¤åæ— æ³•ç›´æ¥æ¢å¤ï¼Œä½†å¯ä»¥é€šè¿‡æ’¤é”€åŠŸèƒ½æ¢å¤ã€‚' : 'ç³»ç»Ÿæ–‡å­—ä¸èƒ½å®Œå…¨åˆ é™¤ï¼Œåªèƒ½æ¸…ç©ºå†…å®¹ã€‚';
            
            showConfirmation(
                `æ‚¨ç¡®å®šè¦${actionText}å—ï¼Ÿ`,
                `${warningText}\nå½“å‰æ–‡å­—ï¼š${element.textContent.substring(0, 30)}${element.textContent.length > 30 ? '...' : ''}`,
                'ğŸ—‘ï¸',
                () => {
                    const elementId = element.id || `element_${Date.now()}`;
                    if (!element.id) {
                        element.id = elementId;
                    }
                    
                    if (isCustomElement) {
                        // ä¿å­˜å®Œæ•´çš„å…ƒç´ ä¿¡æ¯ä»¥ä¾¿æ¢å¤
                        const containerSelector = getContainerSelector(element);
                        
                        saveToHistory(
                            CHANGE_TYPES.TEXT_DELETE,
                            elementId,
                            {
                                exists: true,
                                textContent: element.textContent,
                                className: element.className,
                                containerSelector: containerSelector
                            },
                            { exists: false },
                            {
                                textContent: element.textContent,
                                className: element.className,
                                containerSelector: containerSelector
                            }
                        );
                        
                        element.remove();
                        selectedTextElement = null;
                        document.getElementById('selectionInfo').classList.add('hidden');
                        showToast('ğŸ—‘ï¸ è‡ªå®šä¹‰æ–‡å­—å·²åˆ é™¤');
                    } else {
                        // ç³»ç»Ÿæ–‡å­—åªæ¸…ç©ºå†…å®¹
                        const oldContent = element.textContent;
                        
                        saveToHistory(
                            CHANGE_TYPES.TEXT_EDIT,
                            elementId,
                            oldContent,
                            ''
                        );
                        
                        element.textContent = '';
                        showToast('ğŸ—‘ï¸ æ–‡å­—å†…å®¹å·²æ¸…ç©ºï¼ˆç³»ç»Ÿæ–‡å­—ä¸èƒ½å®Œå…¨åˆ é™¤ï¼‰');
                    }
                }
            );
        }
        
        function getContainerSelector(element) {
            const container = element.parentElement;
            if (!container) return 'body';
            
            // å°è¯•æ‰¾åˆ°ä¸€ä¸ªå”¯ä¸€çš„é€‰æ‹©å™¨
            if (container.id) {
                return `#${container.id}`;
            }
            
            // æŸ¥æ‰¾å…·æœ‰ç‰¹å®šç±»çš„å®¹å™¨
            const specificClasses = ['max-w-7xl', 'hero-bg', 'glass-effect', 'section-bg'];
            for (let cls of specificClasses) {
                if (container.classList.contains(cls) || container.querySelector(`.${cls}`)) {
                    return `.${cls}`;
                }
            }
            
            return 'body'; // é»˜è®¤è¿”å›body
        }

        // Toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            
            toast.classList.remove('translate-x-full');
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 4000);
        }

        // ç»ˆæç©ºæ ¼é”®é˜»æ­¢ç³»ç»Ÿ - å¤šå±‚é˜²æŠ¤
        let ultimateSpaceBlocker = null;
        let isBlockingSpace = false;
        
        function setupUltimateSpaceProtection() {
            // ç§»é™¤æ—§çš„å¤„ç†å™¨
            if (ultimateSpaceBlocker) {
                document.removeEventListener('keydown', ultimateSpaceBlocker, true);
                document.removeEventListener('keyup', ultimateSpaceBlocker, true);
                document.removeEventListener('keypress', ultimateSpaceBlocker, true);
                window.removeEventListener('keydown', ultimateSpaceBlocker, true);
                window.removeEventListener('keyup', ultimateSpaceBlocker, true);
                window.removeEventListener('keypress', ultimateSpaceBlocker, true);
            }
            
            // åˆ›å»ºç»ˆæç©ºæ ¼é˜»æ­¢å™¨
            ultimateSpaceBlocker = function(event) {
                // æ£€æŸ¥æ˜¯å¦æ­£åœ¨ç¼–è¾‘æ–‡å­—
                const isEditing = currentlyEditing && document.querySelector('.inline-editor');
                const activeEditor = document.querySelector('.inline-editor');
                const isInTextarea = event.target && (event.target.tagName === 'TEXTAREA' || event.target.tagName === 'INPUT');
                const isInModal = event.target && event.target.closest('.modal-backdrop');
                
                // å¦‚æœæ­£åœ¨ç¼–è¾‘æ–‡å­—ï¼Œç‰¹æ®Šå¤„ç†
                if (isEditing || isInTextarea || isInModal) {
                    // åªå…è®¸ç¼–è¾‘å™¨å†…çš„ç©ºæ ¼é”®
                    if (event.key === ' ' || event.code === 'Space' || event.keyCode === 32) {
                        if (event.target === activeEditor || isInTextarea || isInModal) {
                            // å…è®¸åœ¨ç¼–è¾‘å™¨ã€è¾“å…¥æ¡†æˆ–æ¨¡æ€æ¡†ä¸­ä½¿ç”¨ç©ºæ ¼
                            return true;
                        } else {
                            // å®Œå…¨é˜»æ­¢å…¶ä»–åœ°æ–¹çš„ç©ºæ ¼é”®
                            event.preventDefault();
                            event.stopPropagation();
                            event.stopImmediatePropagation();
                            isBlockingSpace = true;
                            
                            // å¼ºåˆ¶ç„¦ç‚¹å›åˆ°ç¼–è¾‘å™¨
                            if (activeEditor) {
                                setTimeout(() => {
                                    activeEditor.focus();
                                    isBlockingSpace = false;
                                }, 0);
                            }
                            return false;
                        }
                    }
                }
                
                // å…¨å±€ç©ºæ ¼é”®é˜»æ­¢ï¼ˆå½“ä¸åœ¨ç¼–è¾‘çŠ¶æ€æ—¶ï¼‰
                if (event.key === ' ' || event.code === 'Space' || event.keyCode === 32) {
                    // æ£€æŸ¥æ˜¯å¦åœ¨å¯è¾“å…¥å…ƒç´ ä¸­
                    const isInputElement = event.target && (
                        event.target.tagName === 'INPUT' || 
                        event.target.tagName === 'TEXTAREA' || 
                        event.target.contentEditable === 'true' ||
                        event.target.classList.contains('inline-editor')
                    );
                    
                    if (!isInputElement) {
                        // ä¸åœ¨è¾“å…¥å…ƒç´ ä¸­ï¼Œé˜»æ­¢ç©ºæ ¼é”®
                        event.preventDefault();
                        event.stopPropagation();
                        event.stopImmediatePropagation();
                        console.log('Space key completely blocked');
                        return false;
                    }
                }
                
                // å…¶ä»–å¿«æ·é”®å¤„ç†
                if (isTextEditMode && !isEditing) {
                    // Ctrl+Z for undo
                    if (event.ctrlKey && event.key === 'z' && !event.shiftKey) {
                        event.preventDefault();
                        undoChange();
                        return false;
                    }
                    
                    // Ctrl+Shift+Z or Ctrl+Y for redo
                    if ((event.ctrlKey && event.shiftKey && event.key === 'Z') || 
                        (event.ctrlKey && event.key === 'y')) {
                        event.preventDefault();
                        redoChange();
                        return false;
                    }
                }
                
                return true;
            };
            
            // å¤šå±‚äº‹ä»¶ç›‘å¬ - ç¡®ä¿å®Œå…¨æ‹¦æˆª
            document.addEventListener('keydown', ultimateSpaceBlocker, true);
            document.addEventListener('keyup', ultimateSpaceBlocker, true);
            document.addEventListener('keypress', ultimateSpaceBlocker, true);
            window.addEventListener('keydown', ultimateSpaceBlocker, true);
            window.addEventListener('keyup', ultimateSpaceBlocker, true);
            window.addEventListener('keypress', ultimateSpaceBlocker, true);
            
            // é¢å¤–çš„ç©ºæ ¼é”®ä¸“ç”¨é˜»æ­¢å™¨
            const spaceOnlyBlocker = function(event) {
                if ((event.key === ' ' || event.code === 'Space' || event.keyCode === 32) && !isBlockingSpace) {
                    const isInputElement = event.target && (
                        event.target.tagName === 'INPUT' || 
                        event.target.tagName === 'TEXTAREA' || 
                        event.target.contentEditable === 'true' ||
                        event.target.classList.contains('inline-editor') ||
                        event.target.closest('.modal-backdrop')
                    );
                    
                    if (!isInputElement) {
                        event.preventDefault();
                        event.stopPropagation();
                        event.stopImmediatePropagation();
                        return false;
                    }
                }
            };
            
            // åœ¨æ‰€æœ‰å¯èƒ½çš„é˜¶æ®µéƒ½æ·»åŠ ç©ºæ ¼é˜»æ­¢å™¨
            document.addEventListener('keydown', spaceOnlyBlocker, true);
            document.addEventListener('keypress', spaceOnlyBlocker, true);
            window.addEventListener('keydown', spaceOnlyBlocker, true);
            window.addEventListener('keypress', spaceOnlyBlocker, true);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåç«‹å³åˆå§‹åŒ–
        setupUltimateSpaceProtection();
        
        // ç¡®ä¿åœ¨DOMå®Œå…¨åŠ è½½åå†æ¬¡åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', setupUltimateSpaceProtection);
        
        // é¡µé¢è·å¾—ç„¦ç‚¹æ—¶é‡æ–°åˆå§‹åŒ–
        window.addEventListener('focus', setupUltimateSpaceProtection);

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal-backdrop')) {
                event.target.classList.add('hidden');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'994802feb38897fa',t:'MTc2MTQ2MTM0NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
